import{_ as de}from"./Icon-caaa25f5.js";import{g as ue,S as _e}from"./view-8fc5f1fb.js";import{_ as pe}from"./LayoutHeader-2c6fb6af.js";import{D as fe}from"./DetailsIcon-f1678fde.js";import{P as ge}from"./PhoneIcon-abde0c26.js";import{C as ye}from"./CameraIcon-7d6927da.js";import{D as he}from"./DealsIcon-dcb19b30.js";import{_ as be}from"./DealsListView-e52e17c4.js";import{b as O,f as ve,t as we,a as U,v as Ce}from"./index-9b4a43f5.js";import{u as ke,s as xe,a as De,_ as Ie}from"./modals-8694ff32.js";import{g as ze}from"./settings-979c7d03.js";import{g as Se}from"./global-675ae1af.js";import{V as Me,W as Pe,$ as Ae,x as g,l as Ve,Z as $e,T as L,r as P,b as r,c as y,u as o,g as u,w as h,A as c,d as _,F as qe,a1 as k,a0 as x,e as d,I as Be,a2 as A,t as D,n as Q,Q as W}from"./index-2806a214.js";import{o as Fe}from"./organizations-cb476899.js";import{s as Ne}from"./statuses-ec284dd7.js";import{c as Z}from"./DragVerticalIcon-c67f7b20.js";import{u as Re}from"./pageMeta-ec5fe886.js";import{_ as je}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-3225a656.js";import{D as Ee}from"./dayjs-40d38903.js";import{F as Te}from"./FileUploader-44c6d7a3.js";import"./FadedScrollableDiv-c128293b.js";import"./ArrowUpRightIcon-7aa2e409.js";import"./Link-472bc4cc.js";import"./ListBulkActions-4a774f9d.js";import"./DeleteLinkedDocModal-e4ce4082.js";import"./ListView-e7793134.js";import"./MultipleAvatar-f547d53d.js";import"./IndicatorIcon-69bb1f75.js";import"./ListFooter-8e8d28aa.js";import"./TabButtons-1c70c2d8.js";import"./description-6463fb61.js";import"./plus-ad0e20b1.js";import"./fileUploadHandler-0b2042a3.js";const Oe={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Ue={key:1,class:"flex flex-col h-full overflow-hidden"},Le={class:"flex flex-col items-start justify-start gap-4 p-4"},Qe={class:"flex gap-4 items-center"},We={class:"group relative h-14.5 w-14.5"},Ze={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ge={class:"flex flex-col gap-2 truncate"},He={class:"truncate text-lg font-medium text-ink-gray-9"},Je={key:0},Ke={class:"flex items-center gap-1.5"},Xe={key:0},Ye={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},ea={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},aa={class:"flex flex-col items-center justify-center space-y-3"},Ba={__name:"MobileContact",props:{contactId:{type:String,required:!0}},setup(G){const{brand:H}=ze(),{$dialog:J,makeCall:K}=Se(),{getUser:V}=Me(),{getOrganization:$}=Fe(),{getDealStatus:X}=Ne(),{doctypeMeta:Y}=O("Contact"),b=G,v=Pe(),ee=Ae(),{document:a,permissions:ae}=ke("Contact",b.contactId),te=g(()=>{var e,t;return((t=(e=ae.data)==null?void 0:e.permissions)==null?void 0:t.delete)||!1}),oe=g(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(v.query.view||v.query.viewType){let t=ue(v.query.view,v.query.viewType,"Contact");t&&e.push({label:__(t.label),icon:t.icon,route:{name:"Contacts",params:{viewType:v.query.viewType},query:{view:v.query.view}}})}return e.push({label:q.value,route:{name:"Contact",params:{contactId:b.contactId}}}),e}),q=g(()=>{var t,i;let e=((t=Y.Contact)==null?void 0:t.title_field)||"name";return((i=a.doc)==null?void 0:i[e])||b.contactId});Re(()=>({title:q.value,icon:H.favicon}));function B(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{k.success(__("Contact image updated"))}})}async function se(){J({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await x("frappe.client.delete",{doctype:"Contact",name:b.contactId}),e(),ee.push({name:"Contacts"})}}]})}const F=Ve(0),ne=[{name:"Details",label:__("Details"),icon:fe},{name:"Deals",label:__("Deals"),icon:$e(he,{class:"h-4 w-4"}),count:g(()=>{var e;return(e=I.data)==null?void 0:e.length})}],I=L({url:"crm.api.contact.get_linked_deals",cache:["deals",b.contactId],params:{contact:b.contactId},auto:!0}),z=g(()=>!I.data||I.data==[]?[]:I.data.map(e=>ce(e))),S=L({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0,transform:e=>g(()=>le(e))});function le(e){return e.map(t=>(t.columns=t.columns.map(i=>(i.fields=i.fields.map(m=>{var w,s,p,C;return m.fieldname==="email_id"?{...m,type:"dropdown",options:((s=(w=a.doc)==null?void 0:w.email_ids)==null?void 0:s.map(l=>({name:l.name,value:l.email_id,selected:l.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>{N("email",l.email_id)},onSave:(n,f)=>{f?R("email",n.value):j("Contact Email",n.name,"email_id",n.value)},onDelete:async(n,f)=>{a.doc.email_ids=a.doc.email_ids.filter(M=>M.name!==n.name),!f&&await E("Contact Email",n.name)}})))||[],create:()=>{var l,n;(n=(l=a.doc)==null?void 0:l.email_ids)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:m.name==="mobile_no"?{...m,read_only:!1,fieldtype:"dropdown",options:((C=(p=a.doc)==null?void 0:p.phone_nos)==null?void 0:C.map(l=>({name:l.name,value:l.phone,selected:l.phone===a.doc.mobile_no,onClick:()=>{N("mobile_no",l.phone)},onSave:(n,f)=>{f?R("phone",n.value):j("Contact Phone",n.name,"phone",n.value)},onDelete:async(n,f)=>{a.doc.phone_nos=a.doc.phone_nos.filter(M=>M.name!==n.name),!f&&await E("Contact Phone",n.name)}})))||[],create:()=>{var l,n;(n=(l=a.doc)==null?void 0:l.phone_nos)==null||n.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:m.name==="address"?{...m,create:(l,n)=>{T(),n()},edit:l=>T(l)}:m}),i)),t))}async function N(e,t){await x("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:t})&&(a.reload(),k.success(___("Contact updated")))}async function R(e,t){if(!t)return;await x("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:t})&&(a.reload(),k.success(__("Contact updated")))}async function j(e,t,i,m){await x("frappe.client.set_value",{doctype:e,name:t,fieldname:i,value:m})&&(a.reload(),k.success(__("Contact updated")))}async function E(e,t){await x("frappe.client.delete",{doctype:e,name:t}),await a.reload(),k.success(__("Contact updated"))}const{getFormattedCurrency:ie}=O("CRM Deal"),re=g(()=>me);function ce(e){var t,i;return{name:e.name,organization:{label:e.organization,logo:(t=$(e.organization))==null?void 0:t.organization_logo},annual_revenue:ie("annual_revenue",e),status:{label:e.status,color:(i=X(e.status))==null?void 0:i.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&V(e.deal_owner).full_name,...e.deal_owner&&V(e.deal_owner)},modified:{label:ve(e.modified),timeAgo:__(we(e.modified))}}}const me=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function T(e){xe.value=!0,De.value={doctype:"Address",address:e}}return(e,t)=>{const i=P("Button"),m=P("ErrorMessage"),w=P("Badge");return r(),y(qe,null,[o(a).doc?(r(),u(pe,{key:0},{default:h(()=>[d("header",Oe,[_(o(je),{items:oe.value},{prefix:h(({item:s})=>[s.icon?(r(),u(de,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):c("",!0)]),_:1},8,["items"])])]),_:1})):c("",!0),o(a).doc?(r(),y("div",Ue,[_(o(Te),{onSuccess:B,validateFile:o(Ce)},{default:h(({openFileSelector:s,error:p})=>{var C;return[d("div",Le,[d("div",Qe,[d("div",We,[_(o(U),{size:"3xl",class:"h-14.5 w-14.5",label:o(a).doc.full_name,image:o(a).doc.image},null,8,["label","image"]),(r(),u(A(o(a).doc.image?o(Ee):"div"),Be(o(a).doc.image?{options:[{icon:"upload",label:o(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>B("")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:h(()=>[d("div",Ze,[_(ye,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),d("div",Ge,[d("div",He,[o(a).doc.salutation?(r(),y("span",Je,D(o(a).doc.salutation+". "),1)):c("",!0),d("span",null,D(o(a).doc.full_name),1)]),d("div",Ke,[o(Z)&&o(a).doc.mobile_no?(r(),u(i,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:ge,onClick:t[0]||(t[0]=l=>o(Z)&&o(K)(o(a).doc.mobile_no))},null,8,["label"])):c("",!0),te.value?(r(),u(i,{key:1,label:e.__("Delete"),theme:"red",size:"sm","icon-left":"trash-2",onClick:se},null,8,["label"])):c("",!0),o(a).doc.company_name?(r(),u(o(U),{key:2,size:"md",label:o(a).doc.company_name,image:(C=o($)(o(a).doc.company_name))==null?void 0:C.organization_logo},null,8,["label","image"])):c("",!0)]),_(m,{message:e.__(p)},null,8,["message"])])])])]}),_:1},8,["validateFile"]),_(o(Ie),{as:"div",modelValue:F.value,"onUpdate:modelValue":t[1]||(t[1]=s=>F.value=s),tabs:ne,class:"flex flex-1 overflow-auto flex-col [&_[role='tablist']]:gap-3 [&_[role='tablist']]:px-4 [&_[role='tabpanel']:not([hidden])]:flex [&_[role='tabpanel']:not([hidden])]:grow"},{"tab-item":h(({tab:s,selected:p})=>[s.name=="Deals"?(r(),y("button",{key:0,class:Q(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9 !px-4",{"text-ink-gray-9":p}])},[s.icon?(r(),u(A(s.icon),{key:0,class:"h-5"})):c("",!0),W(" "+D(e.__(s.label))+" ",1),_(w,{class:Q(["group-hover:bg-surface-gray-7",[p?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:h(()=>[W(D(s.count),1)]),_:2},1032,["class"])],2)):c("",!0)]),"tab-panel":h(({tab:s})=>[s.name=="Details"?(r(),y("div",Xe,[o(S).data?(r(),y("div",Ye,[_(_e,{sections:o(S).data,doctype:"Contact",docname:o(a).doc.name,onReload:o(S).reload},null,8,["sections","docname","onReload"])])):c("",!0)])):s.label==="Deals"&&z.value.length?(r(),u(be,{key:1,class:"mt-4",rows:z.value,columns:re.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):c("",!0),s.label==="Deals"&&!z.value.length?(r(),y("div",ea,[d("div",aa,[(r(),u(A(s.icon),{class:"!h-10 !w-10"})),d("div",null,D(e.__("No {0} Found",[e.__(s.label)])),1)])])):c("",!0)]),_:1},8,["modelValue"])])):c("",!0)],64)}}};export{Ba as default};
//# sourceMappingURL=MobileContact-636b9b63.js.map

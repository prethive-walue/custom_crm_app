import{i as D,E as I}from"./DragVerticalIcon-c67f7b20.js";import{F as O}from"./FieldLayout-eb509c1d.js";import{L as Q,X as q,V as F,M as T,$ as A,l as h,x as U,T as M,a as $,r as _,b as d,g as c,w as z,e as n,t as P,u as r,A as v,d as w,aj as W,E as X}from"./index-2806a214.js";import{s as G}from"./statuses-ec284dd7.js";import{u as H,c as J,q as K}from"./modals-8694ff32.js";import{u as Y}from"./onboarding-d2b14cdb.js";const Z={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},ee={class:"mb-5 flex items-center justify-between"},ae={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},se={class:"flex items-center gap-1"},te={class:"px-4 pb-7 pt-4 sm:px-6"},oe={class:"flex flex-row-reverse gap-2"},ce={__name:"LeadModal",props:Q({defaults:Object},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const E=b,{user:k}=q(),{getUser:x,isManager:L}=F(),{getLeadStatus:C,statusOptions:S}=G(),{updateOnboardingStep:V}=Y("frappecrm"),u=T(b,"modelValue"),N=A(),s=h(null),i=h(!1),{document:e,triggerOnBeforeCreate:m}=H("CRM Lead"),p=U(()=>{var t;let a=S("lead");return e.doc.status||(e.doc.status=(t=a==null?void 0:a[0])==null?void 0:t.value),a}),g=M({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Lead"],params:{doctype:"CRM Lead",type:"Quick Entry"},auto:!0,transform:a=>a.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(f=>{f.fields.forEach(l=>{l.fieldname=="status"&&(l.fieldtype="Select",l.options=p.value,l.prefix=C(e.doc.status).color),l.fieldtype==="Table"&&(e.doc[l.fieldname]=[])})})})})}),R=M({url:"frappe.client.insert"});async function j(){e.doc.website&&!e.doc.website.startsWith("http")&&(e.doc.website="https://"+e.doc.website),await(m==null?void 0:m()),R.submit({doc:{doctype:"CRM Lead",...e.doc}},{validate(){if(s.value=null,!e.doc.first_name)return s.value=__("First Name is mandatory"),s.value;if(e.doc.annual_revenue){if(typeof e.doc.annual_revenue=="string")e.doc.annual_revenue=e.doc.annual_revenue.replace(/,/g,"");else if(isNaN(e.doc.annual_revenue))return s.value=__("Annual Revenue should be a number"),s.value}if(e.doc.mobile_no&&isNaN(e.doc.mobile_no.replace(/[-+() ]/g,"")))return s.value=__("Mobile No should be a number"),s.value;if(e.doc.email&&!e.doc.email.includes("@"))return s.value=__("Invalid Email"),s.value;if(!e.doc.status)return s.value=__("Status is required"),s.value;i.value=!0},onSuccess(a){W("lead_created"),i.value=!1,u.value=!1,N.push({name:"Lead",params:{leadId:a.name}}),V("create_first_lead",!0,!1,()=>{localStorage.setItem("firstLead"+k,a.name)})},onError(a){if(i.value=!1,!a.messages){s.value=a.message;return}s.value=a.messages.join(`
`)}})}function B(){J.value=!0,K.value={doctype:"CRM Lead"},X(()=>u.value=!1)}return $(()=>{var a,t,o;e.doc={no_of_employees:"1-10"},Object.assign(e.doc,E.defaults),(a=e.doc)!=null&&a.lead_owner||(e.doc.lead_owner=x().name),!((t=e.doc)!=null&&t.status)&&((o=p.value[0])!=null&&o.value)&&(e.doc.status=p.value[0].value)}),(a,t)=>{const o=_("Button"),f=_("ErrorMessage"),l=_("Dialog");return d(),c(l,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=y=>u.value=y),options:{size:"3xl"}},{body:z(()=>[n("div",Z,[n("div",ee,[n("div",null,[n("h3",ae,P(a.__("Create Lead")),1)]),n("div",se,[r(L)()&&!r(D)?(d(),c(o,{key:0,variant:"ghost",class:"w-7",tooltip:a.__("Edit fields layout"),icon:I,onClick:B},null,8,["tooltip"])):v("",!0),w(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=y=>u.value=!1),icon:"x"})])]),n("div",null,[r(g).data?(d(),c(O,{key:0,tabs:r(g).data,data:r(e).doc},null,8,["tabs","data"])):v("",!0),s.value?(d(),c(f,{key:1,class:"mt-4",message:a.__(s.value)},null,8,["message"])):v("",!0)])]),n("div",te,[n("div",oe,[w(o,{variant:"solid",label:a.__("Create"),loading:i.value,onClick:j},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}};export{ce as _};
//# sourceMappingURL=LeadModal-b841ea0a.js.map

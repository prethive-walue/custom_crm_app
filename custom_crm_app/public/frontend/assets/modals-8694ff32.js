import{j as K,bL as ce,x as F,bM as we,a as de,ay as Ce,b,g as R,w as k,d as V,u as l,bN as U,z as D,bO as xe,bP as ke,E as ne,bQ as Se,H as fe,bR as $e,bS as J,bT as Ie,l as I,bU as Re,B as Me,A as E,bV as De,y as Ae,bW as Te,I as H,Y as ee,aL as te,m as se,c as M,e as q,L as Ve,M as qe,Z as Be,n as j,f as re,a2 as oe,Q as pe,t as Z,F as ae,r as ve,O as ie,P as le,J as he,K as ge,bw as Fe,ah as Oe,U as Pe,R as Ee,a3 as ze,aV as je,p as me,ag as Le,a1 as z,bv as Ke,a0 as Ne,br as He,T as ue}from"./index-2806a214.js";import{i as Ue,R as Qe}from"./dayjs-40d38903.js";import{g as ye}from"./global-675ae1af.js";import{b as W,H as Ye,I as Ge,J as Je}from"./index-9b4a43f5.js";import{s as We,a as Ze}from"./DragVerticalIcon-c67f7b20.js";var Xe=K({__name:"RovingFocusItem",props:{tabStopId:{type:String,required:!1},focusable:{type:Boolean,required:!1,default:!0},active:{type:Boolean,required:!1},allowShiftKey:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){const t=e,a=Ue(),r=ce(),p=F(()=>t.tabStopId||r),u=F(()=>a.currentTabStopId.value===p.value),{getItems:c,CollectionItem:d}=we();de(()=>{t.focusable&&a.onFocusableItemAdd()}),Ce(()=>{t.focusable&&a.onFocusableItemRemove()});function y(v){if(v.key==="Tab"&&v.shiftKey){a.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const i=xe(v,a.orientation.value,a.dir.value);if(i!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||!t.allowShiftKey&&v.shiftKey)return;v.preventDefault();let s=[...c().map(g=>g.ref).filter(g=>g.dataset.disabled!=="")];if(i==="last")s.reverse();else if(i==="prev"||i==="next"){i==="prev"&&s.reverse();const g=s.indexOf(v.currentTarget);s=a.loop.value?ke(s,g+1):s.slice(g+1)}ne(()=>Se(s))}}return(v,i)=>(b(),R(l(d),null,{default:k(()=>[V(l(U),{tabindex:u.value?0:-1,"data-orientation":l(a).orientation.value,"data-active":v.active?"":void 0,"data-disabled":v.focusable?void 0:"",as:v.as,"as-child":v.asChild,onMousedown:i[0]||(i[0]=s=>{v.focusable?l(a).onItemFocus(p.value):s.preventDefault()}),onFocus:i[1]||(i[1]=s=>l(a).onItemFocus(p.value)),onKeydown:y},{default:k(()=>[D(v.$slots,"default")]),_:3},8,["tabindex","data-orientation","data-active","data-disabled","as","as-child"])]),_:3}))}}),et=Xe;const[X,tt]=Re("TabsRoot");var at=K({__name:"TabsRoot",props:{defaultValue:{type:null,required:!1},orientation:{type:String,required:!1,default:"horizontal"},dir:{type:String,required:!1},activationMode:{type:String,required:!1,default:"automatic"},modelValue:{type:null,required:!1},unmountOnHide:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,r=t,{orientation:p,unmountOnHide:u,dir:c}=fe(a),d=$e(c);J();const y=Ie(a,"modelValue",r,{defaultValue:a.defaultValue,passive:a.modelValue===void 0}),v=I();return tt({modelValue:y,changeModelValue:i=>{y.value=i},orientation:p,dir:d,unmountOnHide:u,activationMode:a.activationMode,baseId:ce(void 0,"reka-tabs"),tabsList:v}),(i,s)=>(b(),R(l(U),{dir:l(d),"data-orientation":l(p),"as-child":i.asChild,as:i.as},{default:k(()=>[D(i.$slots,"default",{modelValue:l(y)})]),_:3},8,["dir","data-orientation","as-child","as"]))}}),nt=at;function be(e,t){return`${e}-trigger-${t}`}function _e(e,t){return`${e}-content-${t}`}var st=K({__name:"TabsContent",props:{value:{type:[String,Number],required:!0},forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const t=e,{forwardRef:a}=J(),r=X(),p=F(()=>be(r.baseId,t.value)),u=F(()=>_e(r.baseId,t.value)),c=F(()=>t.value===r.modelValue.value),d=I(c.value);return de(()=>{requestAnimationFrame(()=>{d.value=!1})}),(y,v)=>(b(),R(l(De),{present:y.forceMount||c.value,"force-mount":""},{default:k(({present:i})=>[V(l(U),{id:u.value,ref:l(a),"as-child":y.asChild,as:y.as,role:"tabpanel","data-state":c.value?"active":"inactive","data-orientation":l(r).orientation.value,"aria-labelledby":p.value,hidden:!i,tabindex:"0",style:Me({animationDuration:d.value?"0s":void 0})},{default:k(()=>[!l(r).unmountOnHide.value||i?D(y.$slots,"default",{key:0}):E("v-if",!0)]),_:2},1032,["id","as-child","as","data-state","data-orientation","aria-labelledby","hidden","style"])]),_:3},8,["present"]))}}),rt=st,ot=K({__name:"TabsIndicator",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const t=e,a=X();J();const r=I(),p=I({size:null,position:null});Ae(()=>[a.modelValue.value,a==null?void 0:a.dir.value],async()=>{await ne(),u()},{immediate:!0}),Te([a.tabsList,r],u);function u(){var c;r.value=(c=a.tabsList.value)==null?void 0:c.querySelector('[role="tab"][data-state="active"]'),r.value&&(a.orientation.value==="horizontal"?p.value={size:r.value.offsetWidth,position:r.value.offsetLeft}:p.value={size:r.value.offsetHeight,position:r.value.offsetTop})}return(c,d)=>typeof p.value.size=="number"?(b(),R(l(U),H({key:0},t,{style:{"--reka-tabs-indicator-size":`${p.value.size}px`,"--reka-tabs-indicator-position":`${p.value.position}px`}}),{default:k(()=>[D(c.$slots,"default")]),_:3},16,["style"])):E("v-if",!0)}}),it=ot,lt=K({__name:"TabsList",props:{loop:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(e){const t=e,{loop:a}=fe(t),{forwardRef:r,currentElement:p}=J(),u=X();return u.tabsList=p,(c,d)=>(b(),R(l(Qe),{"as-child":"",orientation:l(u).orientation.value,dir:l(u).dir.value,loop:l(a)},{default:k(()=>[V(l(U),{ref:l(r),role:"tablist","as-child":c.asChild,as:c.as,"aria-orientation":l(u).orientation.value},{default:k(()=>[D(c.$slots,"default")]),_:3},8,["as-child","as","aria-orientation"])]),_:3},8,["orientation","dir","loop"]))}}),ut=lt,ct=K({__name:"TabsTrigger",props:{value:{type:[String,Number],required:!0},disabled:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(e){const t=e,{forwardRef:a}=J(),r=X(),p=F(()=>be(r.baseId,t.value)),u=F(()=>_e(r.baseId,t.value)),c=F(()=>t.value===r.modelValue.value);return(d,y)=>(b(),R(l(et),{"as-child":"",focusable:!d.disabled,active:c.value},{default:k(()=>[V(l(U),{id:p.value,ref:l(a),role:"tab",type:d.as==="button"?"button":void 0,as:d.as,"as-child":d.asChild,"aria-selected":c.value?"true":"false","aria-controls":u.value,"data-state":c.value?"active":"inactive",disabled:d.disabled,"data-disabled":d.disabled?"":void 0,"data-orientation":l(r).orientation.value,onMousedown:y[0]||(y[0]=ee(v=>{!d.disabled&&v.ctrlKey===!1?l(r).changeModelValue(d.value):v.preventDefault()},["left"])),onKeydown:y[1]||(y[1]=te(v=>l(r).changeModelValue(d.value),["enter","space"])),onFocus:y[2]||(y[2]=()=>{const v=l(r).activationMode!=="manual";!c.value&&!d.disabled&&v&&l(r).changeModelValue(d.value)})},{default:k(()=>[D(d.$slots,"default")]),_:3},8,["id","type","as","as-child","aria-selected","aria-controls","data-state","disabled","data-disabled","data-orientation"])]),_:3},8,["focusable","active"]))}}),dt=ct;const ft={class:"lucide lucide-command",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function pt(e,t){return b(),M("svg",ft,[...t[0]||(t[0]=[q("path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3"},null,-1)])])}const vt=se({name:"lucide-command",render:pt}),ht={class:"lucide lucide-arrow-big-up",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function gt(e,t){return b(),M("svg",ht,[...t[0]||(t[0]=[q("path",{d:"M9 13a1 1 0 0 0-1-1H5.061a1 1 0 0 1-.75-1.811l6.836-6.835a1.207 1.207 0 0 1 1.707 0l6.835 6.835a1 1 0 0 1-.75 1.811H16a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1z"},null,-1)])])}const mt=se({name:"lucide-arrow-big-up",render:gt}),yt={class:"lucide lucide-option",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function bt(e,t){return b(),M("svg",yt,[...t[0]||(t[0]=[q("path",{d:"M3 3h6l6 18h6"},null,-1),q("path",{d:"M14 3h7"},null,-1)])])}const _t=se({name:"lucide-option",render:bt}),wt=`left-0 bottom-0 h-[2px] w-[--reka-tabs-indicator-size] transition-[width,transform]
                          translate-x-[--reka-tabs-indicator-position] translate-y-[1px]`,Ct=`right-0 top-0 w-[2px] h-[--reka-tabs-indicator-size]
                       translate-y-[--reka-tabs-indicator-position] transition-[height,transform]`,Ot=K({__name:"Tabs",props:Ve({as:{},tabs:{},vertical:{type:Boolean}},{modelValue:{default:0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,a=qe(e,"modelValue"),r=Be("button");return(p,u)=>(b(),R(l(nt),{as:t.as,class:"flex flex-1 overflow-hidden flex-col data-[orientation=vertical]:flex-row",orientation:t.vertical?"vertical":"horizontal","default-value":t.tabs[0].label,modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=c=>a.value=c)},{default:k(()=>[V(l(ut),{class:j(["relative min-h-fit flex data-[orientation=vertical]:flex-col p-1 border-b data-[orientation=vertical]:border-r gap-5",{"overflow-x-auto overflow-y-hidden px-5":!t.vertical,"py-3":t.vertical}])},{default:k(()=>[V(l(it),{class:j(["absolute rounded-full duration-300",t.vertical?Ct:wt])},{default:k(()=>[...u[1]||(u[1]=[q("div",{class:"w-full h-full bg-surface-gray-7"},null,-1)])]),_:1},8,["class"]),(b(!0),M(ae,null,re(t.tabs,(c,d)=>(b(),R(l(dt),{as:"template",value:d},{default:k(()=>[D(p.$slots,"tab-item",H({ref_for:!0},{tab:c}),()=>[(b(),R(oe(c.route?"router-link":l(r)),{to:c.route,class:j(["flex items-center gap-1.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9 data-[state=active]:text-ink-gray-9",{"px-2.5":t.vertical,"py-2.5":!t.vertical}])},{default:k(()=>[c.icon?(b(),R(oe(c.icon),{key:0,class:"size-4"})):E("",!0),pe(" "+Z(c.label),1)]),_:2},1032,["to","class"]))])]),_:2},1032,["value"]))),256))]),_:3},8,["class"]),(b(!0),M(ae,null,re(t.tabs,(c,d)=>(b(),R(l(rt),{value:d,class:"flex flex-col overflow-auto"},{default:k(()=>[D(p.$slots,"tab-panel",H({ref_for:!0},{tab:c}))]),_:2},1032,["value"]))),256))]),_:3},8,["as","orientation","default-value","modelValue"]))}}),xt={inheritAttrs:!1},Pt=Object.assign(xt,{__name:"Section",props:{label:{type:String,default:""},hideLabel:{type:Boolean,default:!1},opened:{type:Boolean,default:!0},collapsible:{type:Boolean,default:!0},collapseIconPosition:{type:String,default:"left"},labelClass:{type:[String,Object,Array],default:""},headerClass:{type:[String,Object,Array],default:""}},setup(e){const t=e,a=I(t.hideLabel),r=I(t.opened);function p(){r.value=!r.value}function u(){r.value=!0}function c(){r.value=!1}return(d,y)=>{const v=ve("FeatherIcon");return b(),M("div",null,[D(d.$slots,"header",ie(le({opened:r.value,hide:a.value,open:u,close:c,toggle:p})),()=>[a.value?E("",!0):(b(),M("div",{key:0,class:j(["section-header flex items-center justify-between",e.headerClass])},[q("div",{class:j(["flex text-ink-gray-9 max-w-fit cursor-pointer items-center gap-2 text-base",e.labelClass]),onClick:y[0]||(y[0]=i=>e.collapsible&&p())},[e.collapsible&&e.collapseIconPosition==="left"?(b(),R(v,{key:0,name:"chevron-right",class:j(["h-4 transition-all duration-300 ease-in-out",{"rotate-90":r.value}])},null,8,["class"])):E("",!0),q("span",null,Z(d.__(e.label)||d.__("Untitled")),1),e.collapsible&&e.collapseIconPosition==="right"?(b(),R(v,{key:1,name:"chevron-right",class:j(["h-4 transition-all duration-300 ease-in-out",{"rotate-90":r.value}])},null,8,["class"])):E("",!0)],2),D(d.$slots,"actions")],2))]),V(Fe,{"enter-active-class":"duration-300 ease-in","leave-active-class":"duration-300 ease-[cubic-bezier(0, 1, 0.5, 1)]","enter-to-class":"max-h-[200px] overflow-hidden","leave-from-class":"max-h-[200px] overflow-hidden","enter-from-class":"max-h-0 overflow-hidden","leave-to-class":"max-h-0 overflow-hidden"},{default:k(()=>[he(q("div",H({class:"columns"},d.$attrs),[D(d.$slots,"default",ie(le({opened:r.value,open:u,close:c,toggle:p})))],16),[[ge,r.value]])]),_:3})])}}}),kt={key:0},St={key:1},$t={key:1},It={key:2},Rt={__name:"KeyboardShortcut",props:{meta:Boolean,ctrl:Boolean,shift:Boolean,alt:Boolean,shortcut:String,bg:Boolean},setup(e){const t=navigator.userAgent.includes("Mac");return(a,r)=>(b(),M("div",{class:j(["inline-flex items-center gap-0.5 text-sm",{"bg-surface-gray-2 rounded-sm text-ink-gray-5 py-0.5 px-1":e.bg,"text-ink-gray-4":!e.bg}])},[e.ctrl||e.meta?(b(),M("span",kt,[l(t)?(b(),R(l(vt),{key:0,class:"w-3 h-3"})):(b(),M("span",St,"Ctrl"))])):E("",!0),e.shift?(b(),M("span",$t,[V(l(mt),{class:"w-3 h-3"})])):E("",!0),e.alt?(b(),M("span",It,[V(l(_t),{class:"w-3 h-3"})])):E("",!0),D(a.$slots,"default")],2))}},Mt={class:"rounded bg-surface-gray-7 py-1.5 px-2 text-xs text-ink-white shadow-xl"},Dt={class:"flex items-center gap-1"},Et={__name:"Password",props:{modelValue:{type:[String,Number],default:""},value:{type:[String,Number],default:""}},setup(e){const t=e,a=I(!1),r=F(()=>{let p=t.modelValue||t.value;return!(p!=null&&p.includes("*"))});return(p,u)=>{const c=ve("FeatherIcon");return b(),R(l(Ee),H({type:a.value?"text":"password",value:e.modelValue||e.value},p.$attrs,{onKeydown:[u[1]||(u[1]=te(ee(d=>a.value=!a.value,["meta","prevent"]),["i"])),u[2]||(u[2]=te(ee(d=>a.value=!a.value,["ctrl","prevent"]),["i"]))]}),Oe({suffix:k(()=>[V(l(Pe),null,{body:k(()=>[q("div",Mt,[q("span",Dt,[pe(Z(a.value?p.__("Hide Password"):p.__("Show Password"))+" ",1),V(Rt,{bg:"",ctrl:"",class:"!bg-surface-gray-5 !text-ink-gray-2 px-1"},{default:k(()=>[...u[3]||(u[3]=[q("span",{class:"font-mono leading-none tracking-widest"},"+I",-1)])]),_:1})])])]),default:k(()=>[q("div",null,[he(V(c,{name:a.value?"eye-off":"eye",class:"h-3 cursor-pointer mr-1",onClick:u[0]||(u[0]=d=>a.value=!a.value)},null,8,["name"]),[[ge,r.value]])])]),_:1})]),_:2},[p.$slots.prefix?{name:"prefix",fn:k(()=>[D(p.$slots,"prefix")]),key:"0"}:void 0]),1040,["type","value"])}}},zt={__name:"FormattedInput",props:{value:{type:[String,Number],default:""},formattedValue:{type:[String,Number],default:""}},setup(e){const t=e,a=ze(),r=I(!1),p=I(null);function u(){r.value=!0,ne(()=>{var y;p.value&&((y=p.value.el)==null||y.select())})}const c=F(()=>r.value?t.value:t.formattedValue||t.value),d=F(()=>[{sm:"text-xs",md:"text-base"}[a.size||"sm"],"text-ink-gray-5"]);return(y,v)=>(b(),M(ae,null,[V(l(je),H({ref_key:"inputRef",ref:p,value:c.value,onFocus:u,onBlur:v[0]||(v[0]=i=>r.value=!1)},y.$attrs),null,16,["value"]),D(y.$slots,"description",{},()=>[l(a).description?(b(),M("p",{key:0,class:j(["mt-1.5",d.value])},Z(l(a).description),3)):E("",!0)])],64))}},Q=me({});function At(e,t="Form"){const a=Le({doctype:"CRM Form Script",cache:["Form Scripts",e,t],fields:["name","dt","view","script"],filters:{view:t,dt:e,enabled:1},onSuccess:i=>{for(let s of i)Q[e]||(Q[e]={}),Q[e][s.name]=s||{}},onError:i=>{console.error(`Error loading CRM Form Scripts for ${e} (view: ${t}):`,i)}});!Q[e]&&!a.loading&&a.fetch();async function r(i,s={}){await a.list.promise;let g=Q[e];if(!g||Object.keys(g).length===0)return null;const{$dialog:w,$socket:x}=ye();return s.createDialog=w,s.toast=z,s.socket=x,s.router=Ke,s.call=Ne,s.throwError=_=>{throw z.error(_||__("An error occurred")),new Error(_||__("An error occurred"))},p(g,i,s)}function p(i,s,g){var _;const w=[];let x=null;for(let C in i){let m=(_=i[C])==null?void 0:_.script;if(m)try{const A=d(m);if(!A)continue;A.forEach(O=>{const B=y(m,O,g);if(!B)return;let T=null,n=e.replace(/\s+/g,""),{doctypeMeta:h}=W(e),o=O!==n;if(o){if(!w.length){console.error(__("⚠️ No class found for doctype: {0}, it is mandatory to have a class for the parent doctype. it can be empty, but it should be present.",[e]));return}T=w[x]}else x=w.length||0;const f=u(B,h,s,T,o);w.push(f)})}catch(A){console.error(__("Failed to load form controller: {0}",[A]))}}return w}function u(i,s,g,w=null,x=!1){g.actions=g.actions||[],g.statuses=g.statuses||[];let _=new i;_._originalDocumentContext=g,_._isChildDoctype=x;for(const m in g)g.hasOwnProperty(m)&&(_[m]=g[m]);_.getMeta=async m=>(s[m]||await W(m),s[m]);const C=()=>g.doc;return x?(_.doc=v(C,w,_),w._childInstances||(w._childInstances=[]),w._childInstances.push(_)):_.doc=v(C,_),_}function c(i){typeof i.prototype.getRow!="function"&&(i.prototype.getRow=function(s,g){var _,C;g=g||this.currentRowIdx;let w=null;if(this instanceof Array){const{getFields:m}=W(this.doc.doctype);let O=m().find(B=>B.fieldname===s);w=(_=O==null?void 0:O.options)==null?void 0:_.replace(/\s+/g,""),!g&&w&&(g=(C=this.find(B=>B.constructor.name===w))==null?void 0:C.currentRowIdx)}if(!this.doc[s])return console.warn(__("⚠️ No data found for parent field: {0}",[s])),null;const x=this.doc[s].find(m=>m.idx===g);return x?(x.parent=x.parent||this.doc.name,this instanceof Array&&w?v(x,this.find(m=>m.constructor.name===w)):v(x,this)):(console.warn(__("⚠️ No row found for idx: {0} in parent field: {1}",[g,s])),null)}),Object.prototype.hasOwnProperty.call(i.prototype,"actions")||Object.defineProperty(i.prototype,"actions",{configurable:!0,enumerable:!0,get(){return this._originalDocumentContext?this._originalDocumentContext.actions:(console.warn("CRM Script: _originalDocumentContext not found on instance for actions getter."),[])},set(s){if(!this._originalDocumentContext){console.warn("CRM Script: _originalDocumentContext not found on instance for actions setter.");return}if(!Array.isArray(s)){console.warn('CRM Script: "actions" property must be an array. Value was not set.',s),this._originalDocumentContext.actions=[];return}this._originalDocumentContext.actions=s}}),Object.prototype.hasOwnProperty.call(i.prototype,"statuses")||Object.defineProperty(i.prototype,"statuses",{configurable:!0,enumerable:!0,get(){return this._originalDocumentContext?this._originalDocumentContext.statuses:(console.warn("CRM Script: _originalDocumentContext not found on instance for statuses getter."),[])},set(s){if(!this._originalDocumentContext){console.warn("CRM Script: _originalDocumentContext not found on instance for statuses setter.");return}if(!Array.isArray(s)){console.warn('CRM Script: "statuses" property must be an array. Value was not set.',s),this._originalDocumentContext.statuses=[];return}this._originalDocumentContext.statuses=s}})}function d(i){return[...i.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").matchAll(/class\s+([A-Za-z0-9_]+)/g)].map(g=>g[1])||[]}function y(i,s,g={}){const w=Object.keys(g),x=Object.values(g),_=`
		${i}
		return ${s};
	`,C=new Function(...w,_)(...x);return c(C),C}function v(i,s,g=null){const w=typeof i=="function",x=()=>w?i():i;return new Proxy({},{get(_,C){const m=x();if(m)return C==="trigger"?(m&&"trigger"in m&&console.warn(__('⚠️ Avoid using "trigger" as a field name — it conflicts with the built-in trigger() method.')),(A,...O)=>{const B=s[A];if(typeof B=="function")return B.apply(s,O);console.warn(__('⚠️ Method "{0}" not found in class.',[A]))}):C==="getRow"?s.getRow.bind(g||s._childInstances||s):m[C]},set(_,C,m){const A=x();return A?(A[C]=m,!0):!1},has(_,C){const m=x();return m?C in m:!1},ownKeys(_){const C=x();return C?Reflect.ownKeys(C):[]},getOwnPropertyDescriptor(_,C){const m=x();if(m)return Reflect.getOwnPropertyDescriptor(m,C)}})}return{scripts:a,setupScript:r,setupFormController:u}}const P={},L={},Y={},G={};function jt(e,t,a={}){const{setupScript:r,scripts:p}=At(e),u=W(e);P[e]=P[e]||{};const c=I("");P[e][t||""]||(t?P[e][t]=He({doctype:e,name:t,onSuccess:async()=>await d(),onError:n=>{c.value=n,n.exc_type==="DoesNotExistError"&&z.error(__(n.messages[0]||"Document does not exist")),n.exc_type==="PermissionError"&&z.error(__(n.messages[0]||"You do not have permission to access this document"))},setValue:{validate:v,onSuccess:()=>{w(),z.success(__("Document updated successfully"))},onError:n=>{var h,o;if(x(),n.exc_type=="MandatoryError"){const f=n.messages.map(S=>{let $=S.split(": ");return $[$.length-1].trim()}).join(", ");z.error(__("Mandatory field error: {0}",[f]));return}(h=n.messages)==null||h.forEach(f=>{z.error(f)}),((o=n.messages)==null?void 0:o.length)===0&&z.error(__("An error occurred while updating the document")),console.error(n)}},...a}):(P[e][""]=me({doc:{}}),d())),Y[e]=Y[e]||{},Y[e][t||""]||(Y[e][t||""]=ue({url:"crm.api.doc.get_assigned_users",cache:`assignees:${e}:${t}`,auto:!!t,params:{doctype:e,name:t},transform:n=>Ye(n)})),G[e]=G[e]||{},G[e][t||""]||(G[e][t||""]=ue({url:"frappe.client.get_doc_permissions",cache:`permissions:${e}:${t}`,auto:!!t,params:{doctype:e,docname:t},initialData:{permissions:{}}}));async function d(){if(L[e]&&typeof L[e][t||""]=="object")return;L[e]||(L[e]={}),L[e][t||""]={};const{makeCall:n}=ye();let h={};h.crm={makePhoneCall:n,openSettings:S=>{We.value=!0,Ze.value=S}};const o=await r(P[e][t||""],h);if(!o||o.length===0)return;const f={};for(const S of o){const $=S.constructor.name;f[$]||(f[$]=[]),f[$].push(S)}L[e][t||""]=f,s()}function y(n=null){var S;const o=((n==null?void 0:n.doctype)||e).replace(/\s+/g,""),f=(S=L[e])==null?void 0:S[t||""];return typeof f=="object"&&f!==null&&!Array.isArray(f)?f[o]||[]:[]}function v(n){i(n.doc||n.fieldname)}function i(n){let h=(u==null?void 0:u.getFields())||[];if(!h||h.length===0)return;let o=[];if(h.forEach(f=>{var $;let S=(($=u==null?void 0:u.doctypeMeta)==null?void 0:$[f.parent])||null;if(Ge(f.mandatory_depends_on,n,S)){const N=n[f.fieldname];(N==null||typeof N=="string"&&N.trim()===""||Array.isArray(N)&&N.length===0)&&o.push(f.label||f.fieldname)}}),o.length>0)throw z.error(__("Mandatory fields required: {0}",[o.join(", ")])),new Error(__("Mandatory fields required: {0}",[o.join(", ")]))}async function s(){await T(async function(){var h,o,f;await(((h=this.onLoad)==null?void 0:h.call(this))||((o=this.on_load)==null?void 0:o.call(this))||((f=this.onload)==null?void 0:f.call(this)))})}async function g(){const n=Array.from(arguments);await T(async function(){var o,f;await(((o=this.onBeforeCreate)==null?void 0:o.call(this,...n))||((f=this.on_before_create)==null?void 0:f.call(this,...n)))})}async function w(){await T(async function(){var h,o;await(((h=this.onSave)==null?void 0:h.call(this))||((o=this.on_save)==null?void 0:o.call(this)))})}async function x(){await T(async function(){var h,o;await(((h=this.onError)==null?void 0:h.call(this))||((o=this.on_error)==null?void 0:o.call(this)))})}async function _(){await T(async function(){var h;await((h=this.refresh)==null?void 0:h.call(this))})}async function C(n,h,o){let f=null;o?(f=o[n],o[n]=h):(f=P[e][t||""].doc[n],P[e][t||""].doc[n]=h);const S=async function(){var $;this.value=h,this.oldValue=f,o&&(this.currentRowIdx=o.idx),await(($=this[n])==null?void 0:$.call(this))};try{await T(S,o)}catch($){throw o?o[n]=f:P[e][t||""].doc[n]=f,console.error(S),$}}async function m(n){await T(async function(){var o;this.currentRowIdx=n.idx,this.value=n,await((o=this[n.parentfield+"_add"])==null?void 0:o.call(this))},n)}async function A(n,h){await T(async function(){var f;if(n.size===1){const S=Array.from(n)[0];this.currentRowIdx=h.find($=>$.name===S).idx}else delete this.currentRowIdx;this.selectedRows=Array.from(n),this.rows=h,await((f=this[h[0].parentfield+"_remove"])==null?void 0:f.call(this))},h[0])}async function O(){const n=Array.from(arguments);await T(async function(){var o,f;await(((o=this.onCreateLead)==null?void 0:o.call(this,...n))||((f=this.on_create_lead)==null?void 0:f.call(this,...n)))})}async function B(){const n=Array.from(arguments);await T(async function(){var o,f;await(((o=this.convertToDeal)==null?void 0:o.call(this,...n))||((f=this.convert_to_deal)==null?void 0:f.call(this,...n)))})}async function T(n,h=null){const o=y(h);if(!o.length)return;const f=o.map(S=>async()=>await n.call(S));await Je(f)}return{document:P[e][t||""],assignees:Y[e][t||""],permissions:G[e][t||""],scripts:p,error:c,validate:v,getControllers:y,triggerOnLoad:s,triggerOnBeforeCreate:g,triggerOnSave:w,triggerOnError:x,triggerOnRefresh:_,triggerOnChange:C,triggerOnRowAdd:m,triggerOnRowRemove:A,setupFormScript:d,triggerOnCreateLead:O,triggerConvertToDeal:B}}const Lt=I(!1),Kt=I({}),Nt=I(!1),Ht=I({}),Ut=I(!1),Qt=I(!1);export{Ot as _,Ht as a,Pt as b,Lt as c,zt as d,Et as e,Qt as f,Ut as g,Kt as q,Nt as s,jt as u};
//# sourceMappingURL=modals-8694ff32.js.map

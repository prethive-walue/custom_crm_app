import{L as ie,W as _e,M as ue,x as ee,X as Ce,y as we,l as x,r as j,b as o,c as i,d as u,w as v,u as c,F as te,f as xe,g as k,n as S,A as p,U as se,e as V,t as L,Y as pe,V as Le,p as he,Z as G}from"./index-2806a214.js";import{_ as Ve}from"./ViewBreadcrumbs-210172f8.js";import{_ as me}from"./MultipleAvatar-f547d53d.js";import{_ as Me}from"./CustomActions-587c3ded.js";import{E as $e}from"./EmailAtIcon-01d2ed9e.js";import{P as le}from"./PhoneIcon-abde0c26.js";import{_ as ze,N as re}from"./NoteModal-f8390454.js";import{T as de}from"./TaskIcon-676b97ce.js";import{C as Ue}from"./CommentIcon-ee876368.js";import{I as Y}from"./IndicatorIcon-69bb1f75.js";import{L as Ae}from"./LeadsIcon-6ddbd86e.js";import{_ as Re}from"./LayoutHeader-2c6fb6af.js";import{H as ce,_ as Te}from"./ListBulkActions-4a774f9d.js";import{_ as De}from"./DeleteLinkedDocModal-e4ce4082.js";import{L as Be,a as Ie,b as Se,c as Pe,d as Ee}from"./ListView-e7793134.js";import{a as U,b as We,f as X,w as qe,t as N,d as je}from"./index-9b4a43f5.js";import{L as He}from"./ListFooter-8e8d28aa.js";import{D as fe}from"./dayjs-40d38903.js";import{_ as Ke}from"./KanbanView-47c56ae5.js";import{_ as Oe}from"./LeadModal-b841ea0a.js";import{T as Je}from"./TaskModal-52bcf7e2.js";import{_ as Ge}from"./ViewControls-96185e1e.js";import{g as Xe}from"./global-675ae1af.js";import{s as Ye}from"./statuses-ec284dd7.js";import{c as Ze}from"./DragVerticalIcon-c67f7b20.js";import"./Icon-caaa25f5.js";import"./ArrowUpRightIcon-7aa2e409.js";import"./onboarding-d2b14cdb.js";import"./settings-979c7d03.js";import"./plus-ad0e20b1.js";import"./Link-472bc4cc.js";import"./TabButtons-1c70c2d8.js";import"./description-6463fb61.js";import"./FieldLayout-eb509c1d.js";import"./modals-8694ff32.js";import"./FadedScrollableDiv-c128293b.js";import"./RefreshIcon-e544e61b.js";import"./IconPicker-b2b66c61.js";import"./PinIcon-1db1a299.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-9e05c0ee.js";import"./DetailsIcon-f1678fde.js";import"./pageMeta-ec5fe886.js";const Qe={key:0,class:"flex items-center"},Fe={key:0},Ne={key:1},et={key:2},tt={key:3},st=["onClick"],lt={key:1},ot={key:2,class:"truncate text-base"},at={key:3},nt=["onClick"],it={__name:"LeadsListView",props:ie({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:ie(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(g,{expose:Z,emit:Q}){const C=Q,H=_e(),M=ue(g,"modelValue"),D=ue(g,"list"),P=ee(()=>{var n,m;return!!((m=(n=D.value.params)==null?void 0:n.filters)!=null&&m._liked_by)}),{user:E}=Ce();function $(n){if(n)return JSON.parse(n).includes(E)}we(M,(n,m)=>{n!==m&&C("updatePageCount",n)});const B=x(null);return Z({customListActions:ee(()=>{var n;return(n=B.value)==null?void 0:n.customListActions})}),(n,m)=>{const A=j("Button"),W=j("Badge"),h=j("FormControl");return o(),i(te,null,[u(c(Ee),{class:S(n.$attrs.class),columns:g.columns,rows:g.rows,options:{getRowRoute:l=>({name:"Lead",params:{leadId:l.name},query:{view:c(H).query.view,viewType:c(H).params.viewType}}),selectable:g.options.selectable,showTooltip:g.options.showTooltip,resizeColumn:g.options.resizeColumn},"row-key":"name","onUpdate:selections":m[2]||(m[2]=l=>C("selectionsChanged",l))},{default:v(()=>[u(c(Be),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:m[1]||(m[1]=l=>C("columnWidthUpdated"))},{default:v(()=>[(o(!0),i(te,null,xe(g.columns,l=>(o(),k(c(Ie),{key:l.key,item:l,onColumnWidthUpdated:f=>C("columnWidthUpdated",l)},{default:v(()=>[l.key=="_liked_by"?(o(),k(A,{key:0,variant:"ghosted",class:S(["!h-4",P.value?"fill-red-500":"fill-white"]),onClick:m[0]||(m[0]=()=>C("applyLikeFilter"))},{default:v(()=>[u(ce,{class:"h-4 w-4"})]),_:1},8,["class"])):p("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),u(De,{rows:g.rows,doctype:"CRM Lead"},{default:v(({idx:l,column:f,item:_,row:F})=>[f.key==="_assign"?(o(),i("div",Qe,[u(me,{avatars:_,size:"sm",onClick:R=>C("applyFilter",{event:R,idx:l,column:f,item:_,firstColumn:g.columns[0]})},null,8,["avatars","onClick"])])):(o(),k(c(Se),{key:1,item:_,align:f.align},{prefix:v(()=>[f.key==="status"?(o(),i("div",Fe,[u(Y,{class:S(_.color)},null,8,["class"])])):f.key==="lead_name"?(o(),i("div",Ne,[_.label?(o(),k(c(U),{key:0,class:"flex items-center",image:_.image,label:_.image_label,size:"sm"},null,8,["image","label"])):p("",!0)])):f.key==="lead_owner"?(o(),i("div",et,[_.full_name?(o(),k(c(U),{key:0,class:"flex items-center",image:_.user_image,label:_.full_name,size:"sm"},null,8,["image","label"])):p("",!0)])):f.key==="mobile_no"?(o(),i("div",tt,[u(le,{class:"h-4 w-4"})])):p("",!0)]),default:v(({label:R})=>[["modified","creation","first_response_time","first_responded_on","response_by"].includes(f.key)?(o(),i("div",{key:0,class:"truncate text-base",onClick:T=>C("applyFilter",{event:T,idx:l,column:f,item:_,firstColumn:g.columns[0]})},[u(c(se),{text:_.label},{default:v(()=>[V("div",null,L(_.timeAgo),1)]),_:2},1032,["text"])],8,st)):f.key==="_liked_by"?(o(),i("div",lt,[f.key=="_liked_by"?(o(),k(A,{key:0,variant:"ghosted",class:S($(_)?"fill-red-500":"fill-white"),onClick:pe(()=>C("likeDoc",{name:F.name,liked:$(_)}),["stop","prevent"])},{default:v(()=>[u(ce,{class:"h-4 w-4"})]),_:1},8,["class","onClick"])):p("",!0)])):f.key==="sla_status"?(o(),i("div",ot,[_.value?(o(),k(W,{key:0,variant:"subtle",theme:_.color,size:"md",label:_.value,onClick:T=>C("applyFilter",{event:T,idx:l,column:f,item:_,firstColumn:g.columns[0]})},null,8,["theme","label","onClick"])):p("",!0)])):f.type==="Check"?(o(),i("div",at,[u(h,{type:"checkbox",modelValue:_,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):(o(),i("div",{key:4,class:"truncate text-base",onClick:T=>C("applyFilter",{event:T,idx:l,column:f,item:_,firstColumn:g.columns[0]})},L(R),9,nt))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),u(c(Pe),null,{actions:v(({selections:l,unselectAll:f})=>[u(c(fe),{options:B.value.bulkActions(l,f)},{default:v(()=>[u(A,{icon:"more-horizontal",variant:"ghost"})]),_:1},8,["options"])]),_:1})]),_:1},8,["class","columns","rows","options"]),M.value?(o(),k(c(He),{key:0,class:"border-t sm:px-5 px-3 py-2",modelValue:M.value,"onUpdate:modelValue":m[3]||(m[3]=l=>M.value=l),options:{rowCount:g.options.rowCount,totalCount:g.options.totalCount},onLoadMore:m[4]||(m[4]=l=>C("loadMore"))},null,8,["modelValue","options"])):p("",!0),u(Te,{ref_key:"listBulkActionsRef",ref:B,modelValue:D.value,"onUpdate:modelValue":m[5]||(m[5]=l=>D.value=l),doctype:"CRM Lead"},null,8,["modelValue"])],64)}}},ut={class:"flex items-center gap-2"},rt={key:0},dt={key:1},ct={key:2},_t={key:3},pt={key:4},mt={key:5,class:"truncate text-base"},ft={key:6,class:"truncate text-base"},vt={key:7,class:"truncate text-base"},yt={key:8,class:"text-ink-gray-4"},kt={key:0,class:"truncate flex items-center gap-2"},bt={key:0},gt={key:1},Ct={key:2},wt={key:3},xt={key:4,class:"truncate text-base"},Lt={key:5,class:"truncate text-base"},ht={key:6,class:"flex items-center"},Vt={key:7,class:"truncate text-base"},Mt={class:"flex gap-2 items-center justify-between"},$t={class:"text-ink-gray-5 flex items-center gap-1.5"},zt={key:0},Ut={key:1},At={key:2},Rt={key:3},Tt={key:2,class:"flex h-full items-center justify-center"},Dt={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},xs={__name:"Leads",setup(g){const{getFormattedPercent:Z,getFormattedFloat:Q,getFormattedCurrency:C}=We("CRM Lead"),{makeCall:H}=Xe(),{getUser:M}=Le(),{getLeadStatus:D}=Ye(),P=_e(),E=x(null),$=x(!1),B=he({}),n=x({}),m=x(1),A=x(1),W=x(20),h=x(null);function l(r,s){var y;function b(e){return e&&typeof e=="object"&&!Array.isArray(e)?e:{label:e}}return b((y=f.value)==null?void 0:y.find(e=>e.name==r)[s])}const f=ee(()=>{var r,s,b,y,e,t,d;return(s=(r=n.value)==null?void 0:r.data)!=null&&s.data?n.value.data.view_type==="group_by"?(y=(b=n.value)==null?void 0:b.data.group_by_field)!=null&&y.fieldname?_((e=n.value)==null?void 0:e.data.data,(t=n.value)==null?void 0:t.data.group_by_field,n.value.data.columns):[]:n.value.data.view_type==="kanban"?F(n.value.data.data,n.value.data.fields):R((d=n.value)==null?void 0:d.data.data,n.value.data.columns):[]});function _(r,s,b){var e;let y=[];return(e=s.options)==null||e.forEach(t=>{let d=[];t?d=r.filter(a=>a[s.fieldname]==t):d=r.filter(a=>!a[s.fieldname]);let q={label:s.label,group:t||__(" "),collapsed:!1,rows:R(d,b)};s.fieldname=="status"&&(q.icon=()=>{var a;return G(Y,{class:(a=D(t))==null?void 0:a.color})}),y.push(q)}),y||r}function F(r,s){let b=[];return r.forEach(y=>{var e;(e=y.data)==null||e.forEach(t=>{b.push(t)})}),R(b,s)}function R(r,s=[]){let b=n.value.data.view_type,y=b==="kanban"?"fieldname":"key",e=b==="kanban"?"fieldtype":"type";return r.map(t=>{var q;let d={};return(q=n.value)==null||q.data.rows.forEach(a=>{var oe,ae;d[a]=t[a];let z=(oe=s==null?void 0:s.find(w=>(w[y]||w.value)==a))==null?void 0:oe[e];if(z&&["Date","Datetime"].includes(z)&&!["modified","creation"].includes(a)&&(d[a]=X(t[a],"",!0,z=="Datetime")),z&&z=="Currency"&&(d[a]=C(a,t)),z&&z=="Float"&&(d[a]=Q(a,t)),z&&z=="Percent"&&(d[a]=Z(a,t)),a=="lead_name")d[a]={label:t.lead_name,image:t.image,image_label:t.first_name};else if(a=="organization")d[a]=t.organization;else if(a==="website")d[a]=qe(t.website);else if(a=="status")d[a]={label:t.status,color:(ae=D(t.status))==null?void 0:ae.color};else if(a=="sla_status"){let w=t.sla_status,I=w,ne=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";(w=="First Response Due"||w=="Rolling Response Due")&&(w=__(N(t.response_by)),I=X(t.response_by),new Date(t.response_by)<new Date&&(ne="red")),d[a]={label:I,value:w,color:ne}}else if(a=="lead_owner")d[a]={label:t.lead_owner&&M(t.lead_owner).full_name,...t.lead_owner&&M(t.lead_owner)};else if(a=="_assign"){let w=JSON.parse(t._assign||"[]");d[a]=w.map(I=>({name:I,image:M(I).user_image,label:M(I).full_name}))}else if(["modified","creation"].includes(a))d[a]={label:X(t[a]),timeAgo:__(N(t[a]))};else if(["first_response_time","first_responded_on","response_by"].includes(a)){let w=a=="response_by"?"response_by":"first_responded_on";d[a]={label:t[w]?X(t[w]):"",timeAgo:t[a]?a=="first_response_time"?je(t[a]):__(N(t[a])):""}}}),d._email_count=t._email_count,d._note_count=t._note_count,d._task_count=t._task_count,d._comment_count=t._comment_count,d})}function T(r){let s=n.value.params.column_field;s&&(B[s]=r.column.name),$.value=!0}function ve(r){var y;let s=((y=l(r,"mobile_no"))==null?void 0:y.label)||"";return[{icon:G(le,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>H(s),condition:()=>s&&Ze.value},{icon:G(re,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>ke(r)},{icon:G(de,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ge(r)}].filter(e=>e.condition?e.condition():!0)}const K=x(""),O=x(!1),ye=x({title:"",content:""});function ke(r){K.value=r,O.value=!0}const J=x(!1),be=x({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ge(r){K.value=r,J.value=!0}return(r,s)=>{const b=j("Button"),y=j("Badge");return o(),i(te,null,[u(Re,null,{"left-header":v(()=>[u(Ve,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=e=>h.value=e),routeName:"Leads"},null,8,["modelValue"])]),"right-header":v(()=>{var e;return[(e=E.value)!=null&&e.customListActions?(o(),k(Me,{key:0,actions:E.value.customListActions},null,8,["actions"])):p("",!0),u(b,{variant:"solid",label:r.__("Create"),iconLeft:"plus",onClick:s[1]||(s[1]=t=>$.value=!0)},null,8,["label"])]}),_:1}),u(Ge,{ref_key:"viewControls",ref:h,modelValue:n.value,"onUpdate:modelValue":s[2]||(s[2]=e=>n.value=e),loadMore:m.value,"onUpdate:loadMore":s[3]||(s[3]=e=>m.value=e),resizeColumn:A.value,"onUpdate:resizeColumn":s[4]||(s[4]=e=>A.value=e),updatedPageCount:W.value,"onUpdate:updatedPageCount":s[5]||(s[5]=e=>W.value=e),doctype:"CRM Lead",filters:{converted:0},options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),c(P).params.viewType=="kanban"?(o(),k(Ke,{key:0,modelValue:n.value,"onUpdate:modelValue":s[7]||(s[7]=e=>n.value=e),options:{getRoute:e=>({name:"Lead",params:{leadId:e.name},query:{view:c(P).query.view,viewType:c(P).params.viewType}}),onNewClick:e=>T(e)},onUpdate:s[8]||(s[8]=e=>h.value.updateKanbanSettings(e)),onLoadMore:s[9]||(s[9]=e=>h.value.loadMoreKanban(e))},{title:v(({titleField:e,itemName:t})=>[V("div",ut,[e==="status"?(o(),i("div",rt,[u(Y,{class:S(l(t,e).color)},null,8,["class"])])):e==="organization"&&l(t,e).label?(o(),i("div",dt,[u(c(U),{class:"flex items-center",image:l(t,e).logo,label:l(t,e).label,size:"sm"},null,8,["image","label"])])):e==="lead_name"&&l(t,e).label?(o(),i("div",ct,[u(c(U),{class:"flex items-center",image:l(t,e).image,label:l(t,e).image_label,size:"sm"},null,8,["image","label"])])):e==="lead_owner"&&l(t,e).full_name?(o(),i("div",_t,[u(c(U),{class:"flex items-center",image:l(t,e).user_image,label:l(t,e).full_name,size:"sm"},null,8,["image","label"])])):e==="mobile_no"?(o(),i("div",pt,[u(le,{class:"h-4 w-4"})])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(o(),i("div",mt,[u(c(se),{text:l(t,e).label},{default:v(()=>[V("div",null,L(l(t,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(o(),i("div",ft,[l(t,e).value?(o(),k(y,{key:0,variant:"subtle",theme:l(t,e).color,size:"md",label:l(t,e).value},null,8,["theme","label"])):p("",!0)])):l(t,e).label?(o(),i("div",vt,L(l(t,e).label),1)):(o(),i("div",yt,L(r.__("No Title")),1))])]),fields:v(({fieldName:e,itemName:t})=>[l(t,e).label?(o(),i("div",kt,[e==="status"?(o(),i("div",bt,[u(Y,{class:S(l(t,e).color)},null,8,["class"])])):e==="organization"&&l(t,e).label?(o(),i("div",gt,[u(c(U),{class:"flex items-center",image:l(t,e).logo,label:l(t,e).label,size:"xs"},null,8,["image","label"])])):e==="lead_name"?(o(),i("div",Ct,[l(t,e).label?(o(),k(c(U),{key:0,class:"flex items-center",image:l(t,e).image,label:l(t,e).image_label,size:"xs"},null,8,["image","label"])):p("",!0)])):e==="lead_owner"?(o(),i("div",wt,[l(t,e).full_name?(o(),k(c(U),{key:0,class:"flex items-center",image:l(t,e).user_image,label:l(t,e).full_name,size:"xs"},null,8,["image","label"])):p("",!0)])):p("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(o(),i("div",xt,[u(c(se),{text:l(t,e).label},{default:v(()=>[V("div",null,L(l(t,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(o(),i("div",Lt,[l(t,e).value?(o(),k(y,{key:0,variant:"subtle",theme:l(t,e).color,size:"md",label:l(t,e).value},null,8,["theme","label"])):p("",!0)])):e==="_assign"?(o(),i("div",ht,[u(me,{avatars:l(t,e).label,size:"xs"},null,8,["avatars"])])):(o(),i("div",Vt,L(l(t,e).label),1))])):p("",!0)]),actions:v(({itemName:e})=>[V("div",Mt,[V("div",$t,[u($e,{class:"h-4 w-4"}),l(e,"_email_count").label?(o(),i("span",zt,L(l(e,"_email_count").label),1)):p("",!0),s[23]||(s[23]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(re,{class:"h-4 w-4"}),l(e,"_note_count").label?(o(),i("span",Ut,L(l(e,"_note_count").label),1)):p("",!0),s[24]||(s[24]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(de,{class:"h-4 w-4"}),l(e,"_task_count").label?(o(),i("span",At,L(l(e,"_task_count").label),1)):p("",!0),s[25]||(s[25]=V("span",{class:"text-3xl leading-[0]"}," · ",-1)),u(Ue,{class:"h-4 w-4"}),l(e,"_comment_count").label?(o(),i("span",Rt,L(l(e,"_comment_count").label),1)):p("",!0)]),u(c(fe),{class:"flex items-center gap-2",options:ve(e),variant:"ghost",onClick:s[6]||(s[6]=pe(()=>{},["stop","prevent"]))},{default:v(()=>[u(b,{icon:"plus",variant:"ghost"})]),_:1},8,["options"])])]),_:1},8,["modelValue","options"])):n.value.data&&f.value.length?(o(),k(it,{key:1,ref_key:"leadsListView",ref:E,modelValue:n.value.data.page_length_count,"onUpdate:modelValue":s[10]||(s[10]=e=>n.value.data.page_length_count=e),list:n.value,"onUpdate:list":s[11]||(s[11]=e=>n.value=e),rows:f.value,columns:n.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:n.value.data.row_count,totalCount:n.value.data.total_count},onLoadMore:s[12]||(s[12]=()=>m.value++),onColumnWidthUpdated:s[13]||(s[13]=()=>A.value++),onUpdatePageCount:s[14]||(s[14]=e=>W.value=e),onApplyFilter:s[15]||(s[15]=e=>h.value.applyFilter(e)),onApplyLikeFilter:s[16]||(s[16]=e=>h.value.applyLikeFilter(e)),onLikeDoc:s[17]||(s[17]=e=>h.value.likeDoc(e)),onSelectionsChanged:s[18]||(s[18]=e=>h.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):n.value.data?(o(),i("div",Tt,[V("div",Dt,[u(Ae,{class:"h-10 w-10"}),V("span",null,L(r.__("No {0} Found",[r.__("Leads")])),1),u(b,{label:r.__("Create"),iconLeft:"plus",onClick:s[19]||(s[19]=e=>$.value=!0)},null,8,["label"])])])):p("",!0),$.value?(o(),k(Oe,{key:3,modelValue:$.value,"onUpdate:modelValue":s[20]||(s[20]=e=>$.value=e),defaults:B},null,8,["modelValue","defaults"])):p("",!0),O.value?(o(),k(ze,{key:4,modelValue:O.value,"onUpdate:modelValue":s[21]||(s[21]=e=>O.value=e),note:ye.value,doctype:"CRM Lead",doc:K.value},null,8,["modelValue","note","doc"])):p("",!0),J.value?(o(),k(Je,{key:5,modelValue:J.value,"onUpdate:modelValue":s[22]||(s[22]=e=>J.value=e),task:be.value,doctype:"CRM Lead",doc:K.value},null,8,["modelValue","task","doc"])):p("",!0)],64)}}};export{xs as default};
//# sourceMappingURL=Leads-8b3d6aa1.js.map

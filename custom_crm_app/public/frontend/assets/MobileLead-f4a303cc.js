import{a as de}from"./DeleteLinkedDocModal-fb988008.js";import{_ as ce}from"./ErrorPage-f35a514a.js";import{_ as me}from"./Icon-c9812454.js";import{D as j}from"./DetailsIcon-a948fc9a.js";import{u as ve,b as pe,A as _e,a as fe,S as be,c as ge}from"./useActiveTabManager-3a575a55.js";import{E as ye}from"./Popover-032f2850.js";import{C as he}from"./CommentIcon-3bc50e6d.js";import{P as Ce}from"./PhoneIcon-58ab8bcd.js";import{T as we}from"./TaskIcon-cff875a2.js";import{N as xe}from"./NoteModal-ca2fb0bc.js";import{W as ke}from"./WhatsAppIcon-3b99719c.js";import{I as Ie}from"./IndicatorIcon-6cac9012.js";import{O as Ve}from"./OrganizationsIcon-188615d7.js";import{C as Ae}from"./ContactsIcon-506159cf.js";import{_ as De}from"./LayoutHeader-14d19c20.js";import{_ as F}from"./Link-ce253979.js";import{g as Le,S as Me}from"./view-50c6be59.js";import{_ as W}from"./CustomActions-051df89f.js";import{b as Re,s as Se}from"./index-98a0eb06.js";import{g as Te}from"./settings-c75a63ab.js";import{g as Ee}from"./global-f8b0dbce.js";import{s as $e}from"./statuses-5a1a92aa.js";import{u as ze,_ as Oe}from"./modals-3c1f9e01.js";import{i as Ne,w as Ue}from"./DragVerticalIcon-cbd80dc8.js";import{W as qe,$ as Pe,l as v,x as S,y as G,T as Be,r as H,b as s,c as f,d as r,w as C,u as o,e as i,g as d,A as m,ah as J,F as je,a1 as A,a0 as K,ai as Fe,n as We,t as w}from"./index-a3e8239b.js";import{u as Ge}from"./pageMeta-155cb5a4.js";import{_ as He}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-5a4bffc5.js";import{D as Je,_ as Q}from"./dayjs-de744307.js";import"./ListView-b8b2188c.js";import"./Email2Icon-7c640630.js";import"./CalendarIcon-ddedd640.js";import"./CallLogModal-6ea74f2a.js";import"./ArrowUpRightIcon-afcc694f.js";import"./LeadsIcon-0c50d745.js";import"./DealsIcon-f2e9236f.js";import"./TaskModal-957b3e05.js";import"./onboarding-47f442cf.js";import"./FadedScrollableDiv-143e35ae.js";import"./FieldLayout-69566732.js";import"./MultipleAvatar-8af17d0d.js";import"./IconPicker-ae1e34a3.js";import"./FileUploader-3fdaa660.js";import"./fileUploadHandler-0b2042a3.js";import"../node_modules/frappe-ui/src/resources/listResource.js";import"./plus-d2d9d364.js";const Ke={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Qe={class:"absolute right-0"},Xe={key:0,class:"flex h-12 items-center justify-between gap-2 border-b px-3 py-2.5"},Ye={class:"flex items-center gap-2"},Ze={key:1,class:"flex h-full overflow-hidden"},ea={key:0},aa={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},ta={class:"mb-4 flex items-center gap-2 text-ink-gray-5"},oa={class:"block text-base"},sa={class:"ml-6"},la={class:"flex items-center justify-between text-base"},na={key:1,class:"mt-2.5 text-base"},ia={class:"mb-4 mt-6 flex items-center gap-2 text-ink-gray-5"},ra={class:"block text-base"},ua={class:"ml-6"},da={class:"flex items-center justify-between text-base"},ca={key:1,class:"mt-2.5 text-base"},ot={__name:"MobileLead",props:{leadId:{type:String,required:!0}},setup(x){const{brand:X}=Te(),{$dialog:Y,$socket:Z}=Ee(),{statusOptions:ee,getLeadStatus:ae}=$e(),{doctypeMeta:te}=Re("CRM Lead"),b=qe(),U=Pe(),D=x,L=v(""),T=v(""),M=v(!1),{triggerOnChange:oe,assignees:E,document:n,scripts:q,error:se}=ze("CRM Lead",D.leadId),l=S(()=>n.doc||{});G(se,a=>{var e;a?(L.value=__(a.exc_type=="DoesNotExistError"?"Document not found":"Error occurred"),T.value=__(((e=a.messages)==null?void 0:e[0])||"An error occurred")):(L.value="",T.value="")}),G(()=>n.doc,async a=>{var e;if((e=q.data)!=null&&e.length){let u=await Se(q.data,{doc:a,$dialog:Y,$socket:Z,router:U,toast:A,updateField:B,createToast:A.create,deleteDoc:ne,call:K});n._actions=u.actions||[],n._statuses=u.statuses||[]}},{once:!0});const $=v(!1),le=S(()=>{let a=[{label:__("Leads"),route:{name:"Leads"}}];if(b.query.view||b.query.viewType){let e=Le(b.query.view,b.query.viewType,"CRM Lead");e&&a.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:b.query.viewType},query:{view:b.query.view}}})}return a.push({label:P.value,route:{name:"Lead",params:{leadId:D.leadId}}}),a}),P=S(()=>{var e,u;let a=((e=te["CRM Lead"])==null?void 0:e.title_field)||"name";return((u=l.value)==null?void 0:u[a])||D.leadId});Ge(()=>({title:P.value,icon:X.favicon}));const z=S(()=>[{name:"Details",label:__("Details"),icon:j,condition:()=>Ne.value},{name:"Activity",label:__("Activity"),icon:_e},{name:"Emails",label:__("Emails"),icon:ye},{name:"Comments",label:__("Comments"),icon:he},{name:"Data",label:__("Data"),icon:j},{name:"Calls",label:__("Calls"),icon:Ce},{name:"Tasks",label:__("Tasks"),icon:we},{name:"Notes",label:__("Notes"),icon:xe},{name:"Attachments",label:__("Attachments"),icon:fe},{name:"WhatsApp",label:__("WhatsApp"),icon:ke,condition:()=>Ue.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:g}=ve(z,"lastLeadTab"),O=Be({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Lead"],params:{doctype:"CRM Lead"},auto:!0});function B(a,e){e=Array.isArray(a)?"":e;let u=Array.isArray(a)?{}:l.value[a];Array.isArray(a)?a.forEach(k=>l.value[k]=e):l.value[a]=e,n.save.submit(null,{onSuccess:()=>$.value=!0,onError:k=>{var I;Array.isArray(a)?a.forEach(V=>l.value[V]=u[V]):l.value[a]=u,A.error(((I=k.messages)==null?void 0:I[0])||__("Error updating field"))}})}function ne(){M.value=!0}const R=v(!1),y=v(!1),h=v(!1),p=v(""),_=v("");async function ie(){if(y.value&&!p.value){A.error(__("Please select an existing contact"));return}if(h.value&&!_.value){A.error(__("Please select an existing organization"));return}!y.value&&p.value&&(p.value=""),!h.value&&_.value&&(_.value="");let a=await K("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:D.leadId,deal:{},existing_contact:p.value,existing_organization:_.value});a&&(R.value=!1,y.value=!1,h.value=!1,p.value="",_.value="",Fe("convert_lead_to_deal"),U.push({name:"Deal",params:{dealId:a}}))}async function re(a){await oe("status",a),n.save.submit()}function ue(a){n.save.submit(null,{onSuccess:()=>N(a)})}function N(a){a!=null&&a.hasOwnProperty("lead_owner")&&E.reload()}return(a,e)=>{var I,V;const u=H("Button"),k=H("Dialog");return s(),f(je,null,[r(De,null,{default:C(()=>{var t;return[i("header",Ke,[r(o(He),{items:le.value},{prefix:C(({item:c})=>[c.icon?(s(),d(me,{key:0,icon:c.icon,class:"mr-2 h-4"},null,8,["icon"])):m("",!0)]),_:1},8,["items"]),i("div",Qe,[l.value?(s(),d(o(Je),{key:0,options:o(ee)("lead",(t=o(n).statuses)!=null&&t.length?o(n).statuses:o(n)._statuses,re)},{default:C(({open:c})=>[l.value.status?(s(),d(u,{key:0,label:l.value.status,iconRight:c?"chevron-up":"chevron-down"},{prefix:C(()=>[r(Ie,{class:We(o(ae)(l.value.status).color)},null,8,["class"])]),_:1},8,["label","iconRight"])):m("",!0)]),_:1},8,["options"])):m("",!0)])])]}),_:1}),l.value.name?(s(),f("div",Xe,[r(pe,{modelValue:o(E).data,"onUpdate:modelValue":e[0]||(e[0]=t=>o(E).data=t),doctype:"CRM Lead",docname:x.leadId},null,8,["modelValue","docname"]),i("div",Ye,[(I=o(n)._actions)!=null&&I.length?(s(),d(W,{key:0,actions:o(n)._actions},null,8,["actions"])):m("",!0),(V=o(n).actions)!=null&&V.length?(s(),d(W,{key:1,actions:o(n).actions},null,8,["actions"])):m("",!0),r(u,{label:a.__("Convert"),variant:"solid",onClick:e[1]||(e[1]=t=>R.value=!0)},null,8,["label"])])])):m("",!0),l.value.name?(s(),f("div",Ze,[r(o(Oe),{as:"div",modelValue:o(g),"onUpdate:modelValue":e[5]||(e[5]=t=>J(g)?g.value=t:null),tabs:z.value,class:"flex flex-1 overflow-auto flex-col [&_[role='tab']]:px-0 [&_[role='tablist']]:px-3 [&_[role='tablist']]:gap-7.5 [&_[role='tabpanel']:not([hidden])]:flex [&_[role='tabpanel']:not([hidden])]:grow"},{"tab-panel":C(({tab:t})=>[t.name=="Details"?(s(),f("div",ea,[l.value.sla_status?(s(),d(be,{key:0,modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=c=>l.value=c),onUpdateField:B},null,8,["modelValue"])):m("",!0),o(O).data?(s(),f("div",aa,[r(Me,{sections:o(O).data,doctype:"CRM Lead",docname:x.leadId,onReload:o(O).reload,onAfterFieldChange:N},null,8,["sections","docname","onReload"])])):m("",!0)])):(s(),d(ge,{key:1,doctype:"CRM Lead",docname:x.leadId,tabs:z.value,reload:$.value,"onUpdate:reload":e[3]||(e[3]=c=>$.value=c),tabIndex:o(g),"onUpdate:tabIndex":e[4]||(e[4]=c=>J(g)?g.value=c:null),onBeforeSave:ue,onAfterSave:N},null,8,["docname","tabs","reload","tabIndex"]))]),_:1},8,["modelValue","tabs"])])):L.value?(s(),d(ce,{key:2,errorTitle:L.value,errorMessage:T.value},null,8,["errorTitle","errorMessage"])):m("",!0),r(k,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=t=>R.value=t),options:{title:a.__("Convert to Deal"),size:"xl",actions:[{label:a.__("Convert"),variant:"solid",onClick:ie}]}},{"body-content":C(()=>[i("div",ta,[r(Ve,{class:"h-4 w-4"}),i("label",oa,w(a.__("Organization")),1)]),i("div",sa,[i("div",la,[i("div",null,w(a.__("Choose Existing")),1),r(o(Q),{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=t=>h.value=t)},null,8,["modelValue"])]),h.value?(s(),d(F,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:_.value,doctype:"CRM Organization",onChange:e[7]||(e[7]=t=>_.value=t)},null,8,["value"])):(s(),f("div",na,w(a.__("New organization will be created based on the data in details section")),1))]),i("div",ia,[r(Ae,{class:"h-4 w-4"}),i("label",ra,w(a.__("Contact")),1)]),i("div",ua,[i("div",da,[i("div",null,w(a.__("Choose Existing")),1),r(o(Q),{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=t=>y.value=t)},null,8,["modelValue"])]),y.value?(s(),d(F,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:p.value,doctype:"Contact",onChange:e[9]||(e[9]=t=>p.value=t)},null,8,["value"])):(s(),f("div",ca,w(a.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),M.value?(s(),d(de,{key:3,modelValue:M.value,"onUpdate:modelValue":e[11]||(e[11]=t=>M.value=t),doctype:"CRM Lead",docname:x.leadId,name:"Leads"},null,8,["modelValue","docname"])):m("",!0)],64)}}};export{ot as default};
//# sourceMappingURL=MobileLead-f4a303cc.js.map

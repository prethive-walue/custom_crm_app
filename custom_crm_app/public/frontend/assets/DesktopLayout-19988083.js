import{_ as X,S as Ae,a8 as G,r as T,b as s,g as S,w as j,e,c,A as $,d as r,I as wt,j as tl,l as D,y as pe,t as h,F as B,f as Z,n as K,a7 as ae,a2 as _e,u as t,a9 as Ve,Y as re,U as tt,L as Oe,M as Se,x as N,a as me,aV as lt,J as Ue,K as Pe,z as Me,Q as Y,T as ee,m as H,bq as ll,o as sl,aj as xe,V as ge,aL as dt,aO as $t,aP as St,aQ as Vt,aR as Lt,E as nl,a1 as F,a0 as he,ag as je,R as O,br as We,aU as de,k as Q,ak as Mt,aM as ct,ah as al,G as ue,ai as st,p as nt,bs as ol,bt as Dt,Z as ne,a6 as il,aN as rl,ad as De,aJ as ul,ay as dl,a5 as mt,bu as cl,aX as ml,aS as pl,X as _l,bv as oe}from"./index-2806a214.js";import{d as fl,a as Le,_ as gl,C as vl,b as hl,c as yl}from"./GlobalModals-39f03220.js";import{C as bl}from"./CommentIcon-ee876368.js";import{P as xl,a as kl,E as Cl}from"./Popover-50f212fc.js";import{u as we,_ as wl,f as $l,b as Sl}from"./modals-8694ff32.js";import{P as Vl}from"./PinIcon-1db1a299.js";import{L as He}from"./LeadsIcon-6ddbd86e.js";import{D as pt}from"./DealsIcon-dcb19b30.js";import{C as _t}from"./ContactsIcon-255a97c3.js";import{O as ft}from"./OrganizationsIcon-4a4bc3de.js";import{N as Ge}from"./NoteModal-f8390454.js";import{T as gt}from"./TaskIcon-676b97ce.js";import{P as Ke}from"./PhoneIcon-abde0c26.js";import{n as Rt,a as Ze,v as vt,N as At,u as Je}from"./notifications-204fb487.js";import{W as Ut}from"./WhatsAppIcon-7e1e6d5d.js";import{M as Ll}from"./MarkAsDoneIcon-6d5996e8.js";import{_ as jt,t as Ml,m as at,a as Ee,D as Ye,E as Dl,v as Rl,g as ve,b as Al,f as Ul,F as Qe,G as Te}from"./index-9b4a43f5.js";import{g as qe}from"./global-675ae1af.js";import{E as jl}from"./Email2Icon-946daaf6.js";import{a as $e,s as Ce,e as ke,d as El,_ as Il,f as Be,g as Tl}from"./DragVerticalIcon-c67f7b20.js";import{D as ce,_ as fe}from"./dayjs-40d38903.js";import{u as Ie,m as le,s as be}from"./onboarding-d2b14cdb.js";import{C as Bl}from"./CameraIcon-7d6927da.js";import{F as Et}from"./FileUploader-44c6d7a3.js";import{F as Xe,G as It}from"./FieldLayout-eb509c1d.js";import{_ as Ne}from"./Link-472bc4cc.js";import{d as Fl}from"./ListView-e7793134.js";import{D as Nl}from"./DetailsIcon-f1678fde.js";import{R as zl}from"./RefreshIcon-e544e61b.js";import{I as ht,g as ot,_ as Tt}from"./settings-979c7d03.js";import{_ as Ol}from"./DateRangePicker.vue_vue_type_script_setup_true_lang-9e05c0ee.js";import"./ArrowUpRightIcon-7aa2e409.js";import"./AvatarIcon-5772553d.js";import"./fileUploadHandler-0b2042a3.js";import"./IndicatorIcon-69bb1f75.js";import"./plus-ad0e20b1.js";const Pl={name:"ConfirmDialog",props:{title:{type:String},message:{type:String},onConfirm:{type:Function,default:null},onCancel:{type:Function,default:null}},expose:["show","hide"],components:{Dialog:Ae,Button:G},data(){return{showDialog:!0,isLoading:!1}},methods:{handleConfirmation(){var g;try{(g=this.onConfirm)==null||g.call(this,{hideDialog:this.hide})}finally{this.isLoading=!1}},show(){this.showDialog=!0},closeDialog(){var g;this.hide(),(g=this.onCancel)==null||g.call(this)},hide(){this.showDialog=!1}},computed:{primaryActionProps(){return{label:"Confirm",variant:"solid",loading:this.isLoading,onClick:this.handleConfirmation}}}},ql={class:"space-y-4"},Hl=["innerHTML"];function Gl(g,l,i,m,n,a){const o=T("Button"),v=T("Dialog");return s(),S(v,{modelValue:n.showDialog,"onUpdate:modelValue":l[0]||(l[0]=b=>n.showDialog=b),options:{title:i.title},onClose:a.closeDialog},{"body-content":j(()=>[e("div",ql,[i.message?(s(),c("p",{key:0,class:"text-p-base text-ink-gray-6",innerHTML:i.message},null,8,Hl)):$("",!0)])]),actions:j(()=>[r(o,wt({class:"w-full"},a.primaryActionProps),null,16)]),_:1},8,["modelValue","options","onClose"])}const Zl=X(Pl,[["render",Gl]]),Jl={class:"space-y-1"},Yl={key:0,class:"block text-xs text-ink-gray-5"},Wl={class:"flex text-center"},Kl=["onMouseover"],Ql=tl({__name:"Rating",props:{modelValue:{default:0},rating_from:{default:5},label:{},readonly:{type:Boolean,default:!1},size:{default:"md"}},emits:["update:modelValue"],setup(g,{emit:l}){const i=g,m=l,n=D(i.modelValue),a=D(0),o=u=>{let _=[{sm:"size-4",md:"size-5",lg:"size-6",xl:"size-7"}[i.size]];return u<=a.value&&u>n.value?_.push("!fill-yellow-200"):u<=n.value&&_.push("!fill-yellow-500"),i.readonly||_.push("cursor-pointer"),_.join(" ")},v=u=>{m("update:modelValue",u)},b=u=>{i.readonly||(v(u),n.value=u)};return pe(()=>i.modelValue,u=>{n.value=u}),(u,_)=>(s(),c("div",Jl,[u.label?(s(),c("label",Yl,h(u.label),1)):$("",!0),e("div",Wl,[(s(!0),c(B,null,Z(u.rating_from,p=>(s(),c("div",{key:p,onMouseover:()=>!u.readonly&&(a.value=p),onMouseleave:_[0]||(_[0]=()=>!u.readonly&&(a.value=0))},[r(ae,{name:"star",class:K(["fill-gray-300 text-transparent mr-0.5",o(p)]),onClick:C=>b(p)},null,8,["class","onClick"])],40,Kl))),128))])]))}});const Xl={},es={class:"spinner",viewBox:"0 0 50 50"};function ts(g,l){return s(),c("svg",es,[...l[0]||(l[0]=[e("defs",null,[e("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[e("stop",{offset:"0%","stop-color":"rgba(0,110,219,1)"}),e("stop",{offset:"100%","stop-color":"rgba(255,255,255,0)"})])],-1),e("circle",{stroke:"url(#gradient)",class:"spinner-path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"5"},null,-1)])])}const Bt=X(Xl,[["render",ts],["__scopeId","data-v-5c03f65e"]]),ls={},ss={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ns(g,l){return s(),c("svg",ss,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 6.5C9.10457 6.5 10 5.60457 10 4.5C10 3.39543 9.10457 2.5 8 2.5C6.89543 2.5 6 3.39543 6 4.5C6 5.60457 6.89543 6.5 8 6.5ZM8 7.5C9.65685 7.5 11 6.15685 11 4.5C11 2.84315 9.65685 1.5 8 1.5C6.34315 1.5 5 2.84315 5 4.5C5 6.15685 6.34315 7.5 8 7.5ZM12 13.5C13.1046 13.5 14 12.6046 14 11.5C14 10.3954 13.1046 9.5 12 9.5C10.8954 9.5 10 10.3954 10 11.5C10 12.6046 10.8954 13.5 12 13.5ZM12 14.5C13.6569 14.5 15 13.1569 15 11.5C15 9.84315 13.6569 8.5 12 8.5C10.3431 8.5 9 9.84315 9 11.5C9 13.1569 10.3431 14.5 12 14.5ZM6 11.5C6 12.6046 5.10457 13.5 4 13.5C2.89543 13.5 2 12.6046 2 11.5C2 10.3954 2.89543 9.5 4 9.5C5.10457 9.5 6 10.3954 6 11.5ZM7 11.5C7 13.1569 5.65685 14.5 4 14.5C2.34315 14.5 1 13.1569 1 11.5C1 9.84315 2.34315 8.5 4 8.5C5.65685 8.5 7 9.84315 7 11.5Z",fill:"currentColor"},null,-1)])])}const Re=X(ls,[["render",ns]]),as={},os={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-minimize-2"};function is(g,l){return s(),c("svg",os,[...l[0]||(l[0]=[e("polyline",{points:"4 14 10 14 10 20"},null,-1),e("polyline",{points:"20 10 14 10 14 4"},null,-1),e("line",{x1:"14",y1:"10",x2:"21",y2:"3"},null,-1),e("line",{x1:"3",y1:"21",x2:"10",y2:"14"},null,-1)])])}const rs=X(as,[["render",is]]),us={},ds={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-maximize-2"};function cs(g,l){return s(),c("svg",ds,[...l[0]||(l[0]=[e("polyline",{points:"15 3 21 3 21 9"},null,-1),e("polyline",{points:"9 21 3 21 3 15"},null,-1),e("line",{x1:"21",y1:"3",x2:"14",y2:"10"},null,-1),e("line",{x1:"3",y1:"21",x2:"10",y2:"14"},null,-1)])])}const ms=X(us,[["render",cs]]),ps={},_s={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function fs(g,l){return s(),c("svg",_s,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM7.37988 9.37695V9.44531H8.39062V9.37695C8.39062 9.10352 8.41992 8.88542 8.47852 8.72266C8.53711 8.55664 8.62826 8.41504 8.75195 8.29785C8.87891 8.18066 9.04329 8.06185 9.24512 7.94141C9.56087 7.74609 9.8099 7.51009 9.99219 7.2334C10.1745 6.95345 10.2656 6.61328 10.2656 6.21289C10.2656 5.82878 10.1745 5.49186 9.99219 5.20215C9.81315 4.91244 9.56087 4.6862 9.23535 4.52344C8.90983 4.36068 8.52734 4.2793 8.08789 4.2793C7.69401 4.2793 7.33268 4.35579 7.00391 4.50879C6.67513 4.65853 6.41146 4.88151 6.21289 5.17773C6.01432 5.4707 5.90853 5.82878 5.89551 6.25195H6.96973C6.986 6.0013 7.04948 5.79785 7.16016 5.6416C7.27083 5.4821 7.40755 5.36491 7.57031 5.29004C7.73633 5.21517 7.90885 5.17773 8.08789 5.17773C8.28971 5.17773 8.47363 5.22005 8.63965 5.30469C8.80892 5.38932 8.94075 5.50814 9.03516 5.66113C9.13281 5.81413 9.18164 5.99479 9.18164 6.20312C9.18164 6.47005 9.11003 6.69954 8.9668 6.8916C8.82357 7.0804 8.64453 7.23828 8.42969 7.36523C8.21159 7.50195 8.02279 7.64193 7.86328 7.78516C7.70703 7.92513 7.58659 8.11556 7.50195 8.35645C7.42057 8.59408 7.37988 8.93425 7.37988 9.37695ZM7.37988 11.5205C7.51986 11.654 7.69076 11.7207 7.89258 11.7207C8.09766 11.7207 8.26855 11.654 8.40527 11.5205C8.54525 11.3838 8.61523 11.2161 8.61523 11.0176C8.61523 10.8158 8.54525 10.6481 8.40527 10.5146C8.26855 10.3779 8.09766 10.3096 7.89258 10.3096C7.69076 10.3096 7.51986 10.3779 7.37988 10.5146C7.24316 10.6481 7.1748 10.8158 7.1748 11.0176C7.1748 11.2161 7.24316 11.3838 7.37988 11.5205Z",fill:"currentColor"},null,-1)])])}const gs=X(ps,[["render",fs]]),vs={class:"flex flex-col justify-center items-center gap-1 mt-4 mb-7"},hs={class:"text-base font-medium"},ys={class:"text-p-base font-normal"},bs={class:"flex flex-col gap-2.5 overflow-hidden"},xs={class:"flex justify-between items-center py-0.5"},ks={class:"flex"},Cs={class:"flex flex-col gap-1.5 overflow-y-auto"},ws=["onClick"],$s={__name:"OnboardingSteps",props:{appName:{type:String,default:"frappecrm"},title:{type:String,default:"Frappe CRM"},logo:{type:Object,required:!0},afterSkip:{type:Function,default:()=>{}},afterSkipAll:{type:Function,default:()=>{}},afterReset:{type:Function,default:()=>{}},afterResetAll:{type:Function,default:()=>{}}},setup(g){const l=g;function i(C){if(C.dependsOn&&!C.completed){const f=n.find(d=>d.name===C.dependsOn);if(f&&!f.completed)return!0}return!1}function m(C){if(C.dependsOn&&!C.completed){const f=n.find(d=>d.name===C.dependsOn);if(f&&!f.completed)return`You need to complete "${f.title}" first.`}return""}const{steps:n,stepsCompleted:a,totalSteps:o,completedPercentage:v,skip:b,skipAll:u,reset:_,resetAll:p}=Ie(l.appName);return(C,f)=>(s(),c(B,null,[e("div",vs,[(s(),S(_e(g.logo),{class:"size-10 shrink-0 rounded mb-4"})),e("div",hs,h("Welcome to "+g.title),1),e("div",ys,h(`${t(a)}/${t(o)} steps completed`),1)]),e("div",bs,[e("div",xs,[r(Ve,{label:`${t(v)}% completed`,theme:t(v)==100?"green":"orange",size:"lg"},null,8,["label","theme"]),e("div",ks,[t(v)!=0?(s(),S(G,{key:0,variant:"ghost",label:"Reset all",onClick:f[0]||(f[0]=()=>t(p)(g.afterResetAll))})):$("",!0),t(v)!=100?(s(),S(G,{key:1,variant:"ghost",label:"Skip all",onClick:f[1]||(f[1]=()=>t(u)(g.afterSkipAll))})):$("",!0)])]),e("div",Cs,[(s(!0),c(B,null,Z(t(n),d=>(s(),c("div",{key:d.title,class:"group w-full flex gap-2 justify-between items-center hover:bg-surface-gray-1 rounded px-2 py-1.5 cursor-pointer",onClick:re(()=>!d.completed&&!i(d)&&d.onClick(),["stop"])},[(s(),S(_e(i(d)?tt:"div"),{text:m(d)},{default:j(()=>[e("div",{class:K(["flex gap-2 items-center",[d.completed?"text-ink-gray-5":i(d)?"text-ink-gray-4":"text-ink-gray-8"]])},[(s(),S(_e(d.icon),{class:"h-4"})),e("div",{class:K(["text-base",{"line-through":d.completed}])},h(d.title),3)],2)]),_:2},1032,["text"])),!d.completed&&!i(d)?(s(),S(G,{key:0,label:"Skip",class:"!h-4 text-xs !text-ink-gray-6 hidden group-hover:flex",onClick:()=>t(b)(d.name,g.afterSkip)},null,8,["onClick"])):i(d)?$("",!0):(s(),S(G,{key:1,label:"Reset",class:"!h-4 text-xs !text-ink-gray-6 hidden group-hover:flex",onClick:re(()=>t(_)(d.name,g.afterReset),["stop"])},null,8,["onClick"]))],8,ws))),128))])])],64))}},Ss=$s,Vs={class:"flex flex-col gap-2 overflow-hidden"},Ls={class:"m-1"},Ms={class:"flex justify-between items-center text-base text-ink-gray-5 mx-2"},Ds={class:"flex flex-col gap-1.5 overflow-y-auto"},Rs=["onClick"],As={class:"flex items-center gap-2"},Us={class:"text-base text-ink-gray-8"},js={class:"flex flex-col gap-1.5 ml-5"},Es=["onClick"],Is={class:"flex items-center gap-2"},Ts={class:"text-base text-ink-gray-8"},Bs={__name:"HelpCenter",props:Oe({docsLink:{type:String,default:"https://docs.frappe.io/crm"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const l=g,i=D(null),m=D(""),n=Se(g,"modelValue"),a=N(()=>m.value?n.value.filter(b=>{const u=b.subArticles.filter(_=>_.title.toLowerCase().includes(m.value.toLowerCase()));return b.title.toLowerCase().includes(m.value.toLowerCase())||u.length>0?{...b,subArticles:u}:!1}):n.value);function o(){window.open(l.docsLink,"_blank")}function v(b){window.open(`${l.docsLink}/${b}`,"_blank")}return me(()=>{var b,u;(u=(b=i.value)==null?void 0:b.el)==null||u.focus()}),(b,u)=>(s(),c("div",Vs,[e("div",Ls,[r(lt,{ref_key:"searchInput",ref:i,placeholder:"Search articles...",modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=_=>m.value=_),debounce:300},{prefix:j(()=>[r(ae,{name:"search",class:"h-4 text-ink-gray-5"})]),_:1},8,["modelValue"])]),e("div",Ms,[u[1]||(u[1]=e("div",null,"All articles",-1)),r(G,{variant:"ghost",onClick:o},{default:j(()=>[r(ae,{name:"arrow-up-right",class:"h-4 text-ink-gray-5"})]),_:1})]),e("div",Ds,[(s(!0),c(B,null,Z(a.value,_=>(s(),c("div",{key:_.title,class:"flex flex-col gap-1.5"},[e("div",{class:"flex items-center justify-between p-1.5 hover:bg-surface-gray-1 rounded cursor-pointer",onClick:p=>_.opened=!_.opened},[e("div",As,[r(ae,{name:_.opened?"chevron-down":"chevron-right",class:"h-4 text-ink-gray-5"},null,8,["name"]),e("div",Us,h(_.title),1)])],8,Rs),Ue(e("div",js,[(s(!0),c(B,null,Z(_.subArticles,p=>(s(),c("div",{key:p.name,class:"group flex items-center justify-between gap-2 p-1.5 hover:bg-surface-gray-1 rounded cursor-pointer",onClick:()=>v(p.name)},[e("div",Is,[r(ae,{name:"file-text",class:"h-4 text-ink-gray-5"}),e("div",Ts,h(p.title),1)]),r(ae,{name:"arrow-up-right",class:"h-4 hidden group-hover:flex text-ink-gray-5"})],8,Es))),128))],512),[[Pe,_.opened]])]))),128))])]))}},Fs=Bs,ie=D(!1),Ns={class:"flex items-center justify-between px-2 py-1.5"},zs={class:"text-base font-medium"},Os={class:"flex gap-1"},Ps={class:"h-full overflow-hidden flex flex-col"},qs={class:"flex flex-col gap-1.5"},Hs=["onClick"],Gs={class:"text-base"},Zs={__name:"HelpModal",props:Oe({appName:{type:String,default:"frappecrm"},title:{type:String,default:"Frappe CRM"},logo:{type:Object,required:!0},afterSkip:{type:Function,default:()=>{}},afterSkipAll:{type:Function,default:()=>{}},afterReset:{type:Function,default:()=>{}},afterResetAll:{type:Function,default:()=>{}},docsLink:{type:String,default:"https://docs.frappe.io/crm"}},{modelValue:{},modelModifiers:{},articles:{},articlesModifiers:{}}),emits:["update:modelValue","update:articles"],setup(g){const l=g,{syncStatus:i,resetAll:m,isOnboardingStepsCompleted:n}=Ie(l.appName),a=Se(g,"modelValue"),o=Se(g,"articles"),v=N(()=>{if(!n.value&&!ie.value)return"Getting started";if(ie.value)return"Help center"}),b=N(()=>[{icon:Re,label:"Reset onboarding steps",onClick:_,condition:()=>ie.value&&n.value}].filter(C=>C.condition())),u=N(()=>[{icon:gs,label:"Help centre",onClick:()=>{i(),ie.value=!0},condition:!n.value&&!ie.value},{icon:Re,label:"Getting started",onClick:()=>ie.value=!1,condition:ie.value&&!n.value}].filter(C=>C.condition));function _(){m(),n.value=!1,ie.value=!1}return me(()=>{n.value&&(ie.value=!0)}),(p,C)=>Ue((s(),c("div",{class:K(["fixed z-50 right-0 w-80 h-[calc(100%_-_80px)] text-ink-gray-9 m-5 mt-[62px] p-3 flex gap-2 flex-col justify-between rounded-lg bg-surface-modal shadow-2xl",{"top-[calc(100%_-_120px)] border":t(le)}]),onClick:C[3]||(C[3]=re(()=>{},["stop"]))},[e("div",Ns,[e("div",zs,h(v.value),1),e("div",Os,[b.value.length?(s(),S(ce,{key:0,options:b.value},{default:j(()=>[r(G,{variant:"ghost",icon:"more-horizontal"})]),_:1},8,["options"])):$("",!0),r(G,{onClick:C[0]||(C[0]=f=>le.value=!t(le)),variant:"ghost"},{default:j(()=>[(s(),S(_e(t(le)?ms:rs),{class:"h-3.5"}))]),_:1}),r(G,{variant:"ghost",onClick:C[1]||(C[1]=f=>a.value=!1)},{default:j(()=>[r(ae,{name:"x",class:"h-3.5"})]),_:1})])]),e("div",Ps,[!t(n)&&!t(ie)?(s(),S(Ss,{key:0,title:g.title,logo:g.logo,afterSkip:g.afterSkip,afterSkipAll:g.afterSkipAll,afterReset:g.afterReset,afterResetAll:g.afterResetAll,appName:g.appName},null,8,["title","logo","afterSkip","afterSkipAll","afterReset","afterResetAll","appName"])):t(ie)?(s(),S(Fs,{key:1,modelValue:o.value,"onUpdate:modelValue":C[2]||(C[2]=f=>o.value=f),docsLink:g.docsLink},null,8,["modelValue","docsLink"])):$("",!0)]),(s(!0),c(B,null,Z(u.value,f=>(s(),c("div",qs,[e("div",{class:"w-full flex gap-2 items-center hover:bg-surface-gray-1 text-ink-gray-8 rounded px-2 py-1.5 cursor-pointer",onClick:f.onClick},[(s(),S(_e(f.icon),{class:"h-4"})),e("div",Gs,h(f.label),1)],8,Hs)]))),256))],2)),[[Pe,a.value]])}},Js=Zs,Ys={key:0,class:"flex flex-col gap-3 shadow-sm rounded-lg py-2.5 px-3 bg-surface-modal text-base"},Ws={key:0,class:"inline-flex text-ink-gray-9 gap-2"},Ks={class:"flex flex-col text-p-sm gap-0.5"},Qs={class:"text-ink-gray-7"},Xs={key:1,class:"flex flex-col gap-1"},en={class:"flex items-center justify-between gap-1"},tn={class:"flex items-center gap-2 shrink-0"},ln={__name:"GettingStartedBanner",props:{isSidebarCollapsed:{type:Boolean,default:!1},appName:{type:String,default:"frappecrm"}},setup(g){const l=g,{stepsCompleted:i,totalSteps:m,isOnboardingStepsCompleted:n}=Ie(l.appName),a=()=>{le.value=!1,be.value=!0};return(o,v)=>g.isSidebarCollapsed?t(i)!=t(m)?(s(),S(G,{key:1,onClick:a},{default:j(()=>[r(Re,{class:"h-4 my-0.5 shrink-0"})]),_:1})):$("",!0):(s(),c("div",Ys,[t(i)!=t(m)?(s(),c("div",Ws,[r(Re,{class:"h-4 my-0.5 shrink-0"}),e("div",Ks,[v[1]||(v[1]=e("div",{class:"font-medium"},h("Getting started"),-1)),e("div",Qs,h(`${t(i)}/${t(m)} steps`),1)])])):(s(),c("div",Xs,[e("div",en,[e("div",tn,[r(Re,{class:"h-4 my-0.5"}),v[2]||(v[2]=e("div",{class:"text-ink-gray-9 font-medium"},h("You are all set"),-1))]),r(ae,{name:"x",class:"h-4 cursor-pointer",onClick:v[0]||(v[0]=()=>{ie.value=!0,n.value=!0})})]),v[3]||(v[3]=e("div",{class:"text-p-sm text-ink-gray-7"},h("All steps are completed successfully"),-1))])),t(i)!=t(m)?(s(),S(G,{key:2,label:t(i)==0?"Start now":"Continue",theme:"blue",onClick:a},{prefix:j(()=>[r(ae,{name:"chevrons-right",class:"size-4"})]),_:1},8,["label"])):$("",!0)]))}},sn=ln,nn={class:"flex flex-col gap-2 text-ink-gray-9 text-base"},an={key:0},on={key:1,class:"w-full rounded",controls:"",autoplay:"",muted:""},rn=["src"],un={__name:"IntermediateStepModal",props:Oe({currentStep:{type:Object,default:{title:"Title",message:"Message",videoURL:"",buttonLabel:"Button Label",onClick:()=>{}}},dialogOptions:{type:Object,default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const l=g,i=Se(g,"modelValue"),m=N(()=>l.dialogOptions&&Object.keys(l.dialogOptions).length?l.dialogOptions:{title:l.currentStep.title,size:"2xl",actions:[{label:l.currentStep.buttonLabel,variant:"solid",onClick:l.currentStep.onClick}]});return(n,a)=>(s(),S(t(Ae),{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=o=>i.value=o),options:m.value},{"boday-header":j(()=>[Me(n.$slots,"body-header")]),"body-content":j(()=>[Me(n.$slots,"default",{},()=>[e("div",nn,[g.currentStep.message?(s(),c("div",an,h(g.currentStep.message),1)):$("",!0),g.currentStep.videoURL?(s(),c("video",on,[e("source",{src:g.currentStep.videoURL,type:"video/mp4"},null,8,rn),a[1]||(a[1]=Y(" Your browser does not support the video tag. ",-1))])):$("",!0)])])]),actions:j(()=>[Me(n.$slots,"actions")]),_:3},8,["modelValue","options"]))}},dn=un,cn={},mn={width:"17",height:"16",viewBox:"0 0 17 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function pn(g,l){return s(),c("svg",mn,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M6.2641 1C5.5758 1 4.97583 1.46845 4.80889 2.1362L3.57555 7.06953C3.33887 8.01625 4.05491 8.93333 5.03077 8.93333H7.50682L6.72168 14.4293C6.68838 14.6624 6.82229 14.8872 7.04319 14.9689C7.26408 15.0507 7.51204 14.9671 7.63849 14.7684L13.2161 6.00354C13.6398 5.33782 13.1616 4.46667 12.3725 4.46667H9.59038L10.3017 1.62127C10.3391 1.4719 10.3055 1.31365 10.2108 1.19229C10.116 1.07094 9.97063 1 9.81666 1H6.2641ZM5.77903 2.37873C5.83468 2.15615 6.03467 2 6.2641 2H9.17627L8.46492 4.8454C8.42758 4.99477 8.46114 5.15302 8.55589 5.27437C8.65064 5.39573 8.79602 5.46667 8.94999 5.46667H12.3725L8.0395 12.2757L8.5783 8.50404C8.5988 8.36056 8.55602 8.21523 8.46105 8.10573C8.36608 7.99623 8.22827 7.93333 8.08332 7.93333H5.03077C4.70548 7.93333 4.4668 7.62764 4.5457 7.31207L5.77903 2.37873Z",fill:"currentColor"},null,-1)])])}const ze=X(cn,[["render",pn]]),_n={key:0,class:"flex flex-col gap-3 shadow-sm rounded-lg py-2.5 px-3 bg-surface-modal text-base"},fn={class:"flex flex-col gap-1"},gn={class:"inline-flex text-ink-gray-9 gap-2 items-center font-medium"},vn="Upgrade to a paid plan for uninterrupted services",hn={__name:"TrialBanner",props:{isSidebarCollapsed:{type:Boolean,default:!1},afterUpgrade:{type:Function,default:()=>{}}},setup(g){const l=g,i=D(0),m=D(!1),n=D("https://frappecloud.com"),a=D(""),o=N(()=>i.value>1?"Trial ends in "+i.value+" days":"Trial ends tomorrow");ee({url:"frappe.integrations.frappe_providers.frappecloud_billing.current_site_info",cache:"current_site_info_data",auto:!0,onSuccess:u=>{i.value=v(u.trial_end_date),n.value=u.base_url,a.value=u.site_name,m.value=u.plan.is_trial_plan&&i.value>0}});function v(u){if(!u)return 0;u=new Date(u);const p=u-new Date;return Math.ceil(p/(1e3*60*60*24))}function b(){var u;window.open(`${n.value}/dashboard/sites/${a.value}`,"_blank"),(u=l.afterUpgrade)==null||u.call(l)}return(u,_)=>!g.isSidebarCollapsed&&m.value?(s(),c("div",_n,[e("div",fn,[e("div",gn,[r(ae,{class:"h-4",name:"info"}),Y(" "+h(o.value),1)]),e("div",{class:"text-ink-gray-7 text-p-sm"},h(vn))]),r(t(G),{label:"Upgrade plan",theme:"blue",onClick:b},{prefix:j(()=>[r(ze,{class:"size-4"})]),_:1})])):g.isSidebarCollapsed&&m.value?(s(),S(t(G),{key:1,onClick:b},{default:j(()=>[r(ze,{class:"h-4 my-0.5 shrink-0"})]),_:1})):$("",!0)}},yn=hn,bn={key:0,class:"flex flex-col gap-3 shadow-sm rounded-lg py-2.5 px-3 bg-surface-white text-base"},xn={class:"flex flex-col gap-1"},kn={class:"inline-flex gap-2 items-center font-medium"},Cn={class:"text-ink-gray-7 text-p-sm"},wn={__name:"SignupBanner",props:{isSidebarCollapsed:{type:Boolean,default:!1},appName:{type:String,default:"Frappe CRM"},redirectURL:{type:String,default:"https://frappecloud.com/crm/signup"},afterSignup:{type:Function,default:()=>{}}},setup(g){const l=g;function i(){var m;window.open(l.redirectURL,"_blank"),(m=l.afterSignup)==null||m.call(l)}return(m,n)=>{const a=T("FeatherIcon"),o=T("Button");return g.isSidebarCollapsed?(s(),S(o,{key:1,onClick:i},{default:j(()=>[r(ze,{class:"h-4 my-0.5 shrink-0"})]),_:1})):(s(),c("div",bn,[e("div",xn,[Me(m.$slots,"default",{},()=>[e("div",kn,[r(a,{class:"h-4",name:"info"}),n[0]||(n[0]=Y(" Loved the demo? ",-1))]),e("div",Cn,h(`Try ${g.appName} for free with a 14-day trial.`),1)])]),r(o,{label:"Sign up now",theme:"blue",onClick:i},{prefix:j(()=>[r(ze,{class:"size-4"})]),_:1})]))}}},$n=wn,Sn={class:"lucide lucide-layout-dashboard",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function Vn(g,l){return s(),c("svg",Sn,[...l[0]||(l[0]=[e("rect",{width:"7",height:"9",x:"3",y:"3",rx:"1"},null,-1),e("rect",{width:"7",height:"5",x:"14",y:"3",rx:"1"},null,-1),e("rect",{width:"7",height:"9",x:"14",y:"12",rx:"1"},null,-1),e("rect",{width:"7",height:"5",x:"3",y:"16",rx:"1"},null,-1)])])}const Ln=H({name:"lucide-layout-dashboard",render:Vn}),Mn={},Dn={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Rn(g,l){return s(),c("svg",Dn,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M13.5 0C13.7761 0 14 0.223858 14 0.5V2H15.5C15.7761 2 16 2.22386 16 2.5C16 2.77614 15.7761 3 15.5 3H14V4.5C14 4.77614 13.7761 5 13.5 5C13.2239 5 13 4.77614 13 4.5V3H11.5C11.2239 3 11 2.77614 11 2.5C11 2.22386 11.2239 2 11.5 2H13V0.5C13 0.223858 13.2239 0 13.5 0ZM7.9998 2C4.6862 2 2 4.6862 2 7.9998C2 9.49431 2.54643 10.8612 3.45041 11.9116C4.18218 10.8499 5.63104 9.51974 7.99595 9.50011L8.0001 9.50008C9.89267 9.50009 11.5613 10.456 12.5506 11.91C13.4537 10.8598 13.9996 9.49355 13.9996 7.9998C13.9996 7.72366 14.2235 7.4998 14.4996 7.4998C14.7757 7.4998 14.9996 7.72366 14.9996 7.9998C14.9996 11.8657 11.8657 14.9996 7.9998 14.9996C4.13392 14.9996 1 11.8657 1 7.9998C1 4.13392 4.13392 1 7.9998 1C8.27594 1 8.4998 1.22386 8.4998 1.5C8.4998 1.77614 8.27594 2 7.9998 2ZM11.8227 12.6242C11.0281 11.3487 9.61378 10.5008 8.00216 10.5001C5.94811 10.518 4.73746 11.7366 4.17676 12.6241C5.21484 13.4833 6.54702 13.9996 7.9998 13.9996C9.45251 13.9996 10.7846 13.4833 11.8227 12.6242ZM8 4.5C7.0335 4.5 6.25 5.2835 6.25 6.25C6.25 7.2165 7.0335 8 8 8C8.9665 8 9.75 7.2165 9.75 6.25C9.75 5.2835 8.9665 4.5 8 4.5ZM5.25 6.25C5.25 4.73122 6.48122 3.5 8 3.5C9.51878 3.5 10.75 4.73122 10.75 6.25C10.75 7.76878 9.51878 9 8 9C6.48122 9 5.25 7.76878 5.25 6.25Z",fill:"currentColor"},null,-1)])])}const An=X(Mn,[["render",Rn]]),Un={},jn={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function En(g,l){return s(),c("svg",jn,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8.71639 1.68847C7.20728 1.49315 5.6781 1.84427 4.40534 2.67832C3.50159 3.27056 2.7695 4.07854 2.26943 5.02055C2.13995 5.26445 2.23271 5.56714 2.47662 5.69662C2.72052 5.8261 3.02321 5.73334 3.15269 5.48943C3.57431 4.69521 4.19153 4.01402 4.95345 3.51473C6.02649 2.81155 7.31573 2.51553 8.58803 2.6802C9.86034 2.84487 11.0317 3.45936 11.8904 4.41255C12.5455 5.13978 12.9856 6.02752 13.1713 6.97711L12.0682 6.38995C11.8245 6.2602 11.5217 6.35263 11.3919 6.59639C11.2622 6.84015 11.3546 7.14294 11.5984 7.27269L13.8052 8.44735C14.049 8.5771 14.3518 8.48468 14.4815 8.24091L15.6562 6.03407C15.7859 5.79031 15.6935 5.48752 15.4497 5.35777C15.206 5.22802 14.9032 5.32044 14.7734 5.5642L14.1448 6.74523C13.92 5.63395 13.4012 4.59563 12.6334 3.74325C11.6149 2.61265 10.2255 1.88379 8.71639 1.68847ZM7.51332 14.3501C9.0288 14.4875 10.5434 14.0781 11.7833 13.1959C12.5865 12.6244 13.2401 11.8789 13.7005 11.0233C13.8314 10.7801 13.7404 10.4769 13.4972 10.3461C13.254 10.2152 12.9508 10.3062 12.82 10.5494C12.4317 11.2708 11.8807 11.8993 11.2035 12.3811C10.1582 13.1249 8.88128 13.47 7.6036 13.3542C6.32592 13.2384 5.13186 12.6692 4.23732 11.7496C3.50475 10.9965 3.01266 10.0491 2.81428 9.02749L3.95178 9.68895C4.1905 9.82776 4.49655 9.74677 4.63536 9.50805C4.77417 9.26934 4.69318 8.96329 4.45447 8.82448L2.29329 7.56777C2.05458 7.42895 1.74853 7.50994 1.60972 7.74866L0.353003 9.90983C0.214191 10.1485 0.295179 10.4546 0.533896 10.5934C0.772613 10.7322 1.07866 10.6512 1.21747 10.4125L1.85313 9.31938C2.10072 10.4924 2.67584 11.5786 3.52051 12.4469C4.58154 13.5377 5.99784 14.2128 7.51332 14.3501Z",fill:"currentColor"},null,-1)])])}const In=X(Un,[["render",En]]),Tn={},Bn={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Fn(g,l){return s(),c("svg",Bn,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 6.5C9.10457 6.5 10 5.60457 10 4.5C10 3.39543 9.10457 2.5 8 2.5C6.89543 2.5 6 3.39543 6 4.5C6 5.60457 6.89543 6.5 8 6.5ZM8 7.5C9.65685 7.5 11 6.15685 11 4.5C11 2.84315 9.65685 1.5 8 1.5C6.34315 1.5 5 2.84315 5 4.5C5 6.15685 6.34315 7.5 8 7.5ZM12 13.5C13.1046 13.5 14 12.6046 14 11.5C14 10.3954 13.1046 9.5 12 9.5C10.8954 9.5 10 10.3954 10 11.5C10 12.6046 10.8954 13.5 12 13.5ZM12 14.5C13.6569 14.5 15 13.1569 15 11.5C15 9.84315 13.6569 8.5 12 8.5C10.3431 8.5 9 9.84315 9 11.5C9 13.1569 10.3431 14.5 12 14.5ZM6 11.5C6 12.6046 5.10457 13.5 4 13.5C2.89543 13.5 2 12.6046 2 11.5C2 10.3954 2.89543 9.5 4 9.5C5.10457 9.5 6 10.3954 6 11.5ZM7 11.5C7 13.1569 5.65685 14.5 4 14.5C2.34315 14.5 1 13.1569 1 11.5C1 9.84315 2.34315 8.5 4 8.5C5.65685 8.5 7 9.84315 7 11.5Z",fill:"currentColor"},null,-1)])])}const Nn=X(Tn,[["render",Fn]]),zn={},On={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-square-asterisk-icon lucide-square-asterisk"};function Pn(g,l){return s(),c("svg",On,[...l[0]||(l[0]=[e("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"},null,-1),e("path",{d:"M12 8v8"},null,-1),e("path",{d:"m8.5 14 7-4"},null,-1),e("path",{d:"m8.5 10 7 4"},null,-1)])])}const qn=X(zn,[["render",Pn]]),Hn={},Gn={xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function Zn(g,l){return s(),c("svg",Gn,[...l[0]||(l[0]=[e("path",{d:"M3 3v18h18"},null,-1),e("path",{d:"M18 17V9"},null,-1),e("path",{d:"M13 17V5"},null,-1),e("path",{d:"M8 17v-3"},null,-1)])])}const yt=X(Hn,[["render",Zn]]),Jn={},Yn={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Wn(g,l){return s(),c("svg",Yn,[...l[0]||(l[0]=[e("path",{d:"M10.875 9.06223L3 9.06232",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M6.74537 5.31699L3 9.06236L6.74527 12.8076",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),e("path",{d:"M14.1423 4L14.1423 14.125",stroke:"currentColor","stroke-linecap":"round"},null,-1)])])}const Kn=X(Jn,[["render",Wn]]),Qn={},Xn={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ea(g,l){return s(),c("svg",Xn,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM7.37988 9.37695V9.44531H8.39062V9.37695C8.39062 9.10352 8.41992 8.88542 8.47852 8.72266C8.53711 8.55664 8.62826 8.41504 8.75195 8.29785C8.87891 8.18066 9.04329 8.06185 9.24512 7.94141C9.56087 7.74609 9.8099 7.51009 9.99219 7.2334C10.1745 6.95345 10.2656 6.61328 10.2656 6.21289C10.2656 5.82878 10.1745 5.49186 9.99219 5.20215C9.81315 4.91244 9.56087 4.6862 9.23535 4.52344C8.90983 4.36068 8.52734 4.2793 8.08789 4.2793C7.69401 4.2793 7.33268 4.35579 7.00391 4.50879C6.67513 4.65853 6.41146 4.88151 6.21289 5.17773C6.01432 5.4707 5.90853 5.82878 5.89551 6.25195H6.96973C6.986 6.0013 7.04948 5.79785 7.16016 5.6416C7.27083 5.4821 7.40755 5.36491 7.57031 5.29004C7.73633 5.21517 7.90885 5.17773 8.08789 5.17773C8.28971 5.17773 8.47363 5.22005 8.63965 5.30469C8.80892 5.38932 8.94075 5.50814 9.03516 5.66113C9.13281 5.81413 9.18164 5.99479 9.18164 6.20312C9.18164 6.47005 9.11003 6.69954 8.9668 6.8916C8.82357 7.0804 8.64453 7.23828 8.42969 7.36523C8.21159 7.50195 8.02279 7.64193 7.86328 7.78516C7.70703 7.92513 7.58659 8.11556 7.50195 8.35645C7.42057 8.59408 7.37988 8.93425 7.37988 9.37695ZM7.37988 11.5205C7.51986 11.654 7.69076 11.7207 7.89258 11.7207C8.09766 11.7207 8.26855 11.654 8.40527 11.5205C8.54525 11.3838 8.61523 11.2161 8.61523 11.0176C8.61523 10.8158 8.54525 10.6481 8.40527 10.5146C8.26855 10.3779 8.09766 10.3096 7.89258 10.3096C7.69076 10.3096 7.51986 10.3779 7.37988 10.5146C7.24316 10.6481 7.1748 10.8158 7.1748 11.0176C7.1748 11.2161 7.24316 11.3838 7.37988 11.5205Z",fill:"currentColor"},null,-1)])])}const ta=X(Qn,[["render",ea]]),la={class:"flex h-screen flex-col text-ink-gray-9"},sa={class:"z-20 flex items-center justify-between border-b bg-surface-white px-5 py-2.5"},na={class:"text-base font-medium"},aa={class:"flex gap-1"},oa={key:0,class:"divide-y divide-outline-gray-modals overflow-auto text-base"},ia={class:"mt-1 flex items-center gap-2.5"},ra=["innerHTML"],ua={key:1,class:"mb-2 space-x-1 leading-5 text-ink-gray-5"},da={class:"font-medium text-ink-gray-9"},ca={class:"font-medium text-ink-gray-9"},ma={class:"text-sm text-ink-gray-5"},pa={key:1,class:"flex flex-1 flex-col items-center justify-center gap-2"},_a={class:"text-lg font-medium text-ink-gray-4"},fa={__name:"Notifications",setup(g){const{$socket:l}=qe(),{mark_as_read:i,toggle:m,mark_doc_as_read:n}=Rt(),a=D(null);ll(a,()=>{vt.value&&m()},{ignore:["#notifications-btn"]});function o(u){xe("notification_mark_as_read"),n(u)}function v(){xe("notification_mark_all_as_read"),i.reload()}sl(()=>{l.off("crm_notification")}),me(()=>{l.on("crm_notification",()=>{Ze.reload()})});function b(u){let _={leadId:u.reference_name};return u.route_name==="Deal"&&(_={dealId:u.reference_name}),{name:u.route_name,params:_,hash:u.hash}}return(u,_)=>{var f;const p=T("Button"),C=T("RouterLink");return t(vt)?(s(),c("div",{key:0,ref_key:"target",ref:a,class:"absolute z-20 h-screen bg-surface-white transition-all duration-300 ease-in-out",style:{"box-shadow":"8px 0px 8px rgba(0, 0, 0, 0.1)","max-width":"350px","min-width":"350px",left:"calc(100% + 1px)"}},[e("div",la,[e("div",sa,[e("div",na,h(u.__("Notifications")),1),e("div",aa,[r(p,{tooltip:u.__("Mark all as read"),icon:Ll,variant:"ghost",onClick:v},null,8,["tooltip"]),r(p,{tooltip:u.__("Close"),icon:"x",variant:"ghost",onClick:_[0]||(_[0]=()=>t(m)())},null,8,["tooltip"])])]),(f=t(Ze).data)!=null&&f.length?(s(),c("div",oa,[(s(!0),c(B,null,Z(t(Ze).data,d=>(s(),S(C,{key:d.comment,to:b(d),class:"flex cursor-pointer items-start gap-2.5 px-4 py-2.5 hover:bg-surface-gray-2",onClick:y=>o(d.comment||d.notification_type_doc)},{default:j(()=>[e("div",ia,[e("div",{class:K(["size-[5px] rounded-full",[d.read?"bg-transparent":"bg-surface-gray-7"]])},null,2),d.type=="WhatsApp"?(s(),S(Ut,{key:0,class:"size-7"})):(s(),S(jt,{key:1,user:d.from_user.name,size:"lg"},null,8,["user"]))]),e("div",null,[d.notification_text?(s(),c("div",{key:0,innerHTML:d.notification_text},null,8,ra)):(s(),c("div",ua,[e("span",da,h(d.from_user.full_name),1),e("span",null,h(u.__("mentioned you in {0}",[d.reference_doctype])),1),e("span",ca,h(d.reference_name),1)])),e("div",ma,h(u.__(t(Ml)(d.creation))),1)])]),_:2},1032,["to","onClick"]))),128))])):(s(),c("div",pa,[r(At,{class:"h-20 w-20 text-ink-gray-2"}),e("div",_a,h(u.__("No new notifications")),1)]))])],512)):$("",!0)}}},ga={class:"lucide lucide-circle-dollar-sign",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function va(g,l){return s(),c("svg",ga,[...l[0]||(l[0]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"},null,-1),e("path",{d:"M12 18V6"},null,-1)])])}const ha=H({name:"lucide-circle-dollar-sign",render:va}),ya={class:"lucide lucide-trending-up-down",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function ba(g,l){return s(),c("svg",ya,[...l[0]||(l[0]=[e("path",{d:"M14.828 14.828 21 21"},null,-1),e("path",{d:"M21 16v5h-5"},null,-1),e("path",{d:"m21 3-9 9-4-4-6 6"},null,-1),e("path",{d:"M21 8V3h-5"},null,-1)])])}const xa=H({name:"lucide-trending-up-down",render:ba}),ka={},Ca={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function wa(g,l){return s(),c("svg",Ca,[...l[0]||(l[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.37543 1.93494L4.21632 2.21494C4.35232 2.26027 4.44388 2.38738 4.44388 2.53138C4.44388 2.67538 4.35143 2.80249 4.21543 2.84783L3.37454 3.12783L3.09365 3.9696C3.04921 4.10472 2.92121 4.19716 2.7781 4.19716C2.63499 4.19716 2.50787 4.1056 2.46254 3.9696L2.18165 3.12783L1.34076 2.84783C1.20476 2.80249 1.11232 2.67538 1.11232 2.53138C1.11232 2.38738 1.20476 2.26027 1.34076 2.21494L2.18165 1.93494L2.46254 1.09316C2.55321 0.82116 3.00387 0.82116 3.09454 1.09316L3.37543 1.93494ZM8.44852 1.33394C8.3643 1.16325 8.19046 1.05518 8.00012 1.05518C7.80978 1.05518 7.63595 1.16325 7.55173 1.33394L5.67697 5.13368L1.48388 5.74214C1.29552 5.76947 1.13901 5.90137 1.08017 6.08238C1.02133 6.26339 1.07036 6.46211 1.20665 6.59497L4.24065 9.55281L3.52421 13.7284C3.49203 13.916 3.56913 14.1056 3.7231 14.2174C3.87706 14.3293 4.08119 14.3441 4.24966 14.2555L8.11188 12.2253C8.35631 12.0968 8.4503 11.7945 8.32181 11.5501C8.19333 11.3057 7.89102 11.2117 7.64659 11.3402L4.68114 12.899L5.2707 9.46284C5.29853 9.30065 5.24477 9.13514 5.12693 9.02027L2.63025 6.58626L6.08082 6.08555C6.24373 6.06191 6.38457 5.95959 6.45741 5.81196L8.00012 2.6852L9.54284 5.81196C9.61568 5.95959 9.75652 6.06191 9.91943 6.08555L13.37 6.58625L11.6235 8.2887C11.4258 8.48146 11.4218 8.79802 11.6145 8.99575C11.8073 9.19349 12.1239 9.19752 12.3216 9.00476L14.7936 6.59498C14.9299 6.46212 14.9789 6.2634 14.9201 6.08239C14.8612 5.90138 14.7047 5.76947 14.5164 5.74214L10.3233 5.13368L8.44852 1.33394ZM13.4744 11.9911L12.3517 11.6168L11.9775 10.4942C11.8557 10.1315 11.2557 10.1315 11.1339 10.4942L10.7597 11.6168L9.63702 11.9911C9.45569 12.0515 9.33302 12.2213 9.33302 12.4124C9.33302 12.6035 9.45569 12.7733 9.63702 12.8337L10.7597 13.2079L11.1339 14.3306C11.1944 14.5119 11.365 14.6346 11.5561 14.6346C11.7472 14.6346 11.917 14.5119 11.9784 14.3306L12.3526 13.2079L13.4752 12.8337C13.6566 12.7733 13.7792 12.6035 13.7792 12.4124C13.7792 12.2213 13.6566 12.0515 13.4752 11.9911H13.4744ZM13.3333 2.88883C13.3333 3.25702 13.0349 3.5555 12.6667 3.5555C12.2985 3.5555 12 3.25702 12 2.88883C12 2.52064 12.2985 2.22217 12.6667 2.22217C13.0349 2.22217 13.3333 2.52064 13.3333 2.88883Z",fill:"currentColor"},null,-1)])])}const $a=X(ka,[["render",wa]]),Sa={},Va={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function La(g,l){return s(),c("svg",Va,[...l[0]||(l[0]=[e("path",{d:"M1 5C1 2.79086 2.79086 1 5 1H13C15.2091 1 17 2.79086 17 5V13C17 15.2091 15.2091 17 13 17H5C2.79086 17 1 15.2091 1 13V5Z",stroke:"currentColor"},null,-1),e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.7819 6.27142H11.5136H8.02453H6.28001V4.84002H11.7819V6.27142ZM8.02451 9.62623V11.5944H11.8267V13.0258H6.27999V8.19484H8.02451H11.5135V9.62623H8.02451Z",fill:"currentColor"},null,-1)])])}const Ma=X(Sa,[["render",La]]),Da={},Ra={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-settings2-icon lucide-settings-2"};function Aa(g,l){return s(),c("svg",Ra,[...l[0]||(l[0]=[e("path",{d:"M14 17H5"},null,-1),e("path",{d:"M19 7h-9"},null,-1),e("circle",{cx:"17",cy:"17",r:"3"},null,-1),e("circle",{cx:"7",cy:"7",r:"3"},null,-1)])])}const Ua=X(Da,[["render",Aa]]),ja={class:"flex flex-wrap gap-1"},Ea={class:"flex-1"},Ia={class:"mt-1 rounded-lg bg-surface-modal shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none"},Ta={key:0,class:"flex gap-2 rounded px-2 py-1 text-base text-ink-gray-5"},Ba={class:"flex flex-col gap-1 p-1 text-ink-gray-8"},Fa={class:"text-base font-medium"},Na={class:"text-sm text-ink-gray-5"},za={key:1,class:"whitespace-pre-line text-sm text-ink-blue-3 mt-2 pl-2"},Oa={__name:"MultiSelectUserInput",props:Oe({validate:{type:Function,default:null},variant:{type:String,default:"subtle"},placeholder:{type:String,default:""},inputClass:{type:String,default:""},errorMessage:{type:Function,default:g=>`${g} is an Invalid value`},fetchUsers:{type:Boolean,default:!0},existingEmails:{type:Array,default:()=>[]}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(g,{expose:l}){const i=g,m=Se(g,"modelValue"),{users:n}=ge(),a=D([]),o=D(null),v=D(null),b=D(null),u=D(""),_=D(!1),p=N({get:()=>u.value||"",set:w=>{u.value="",w&&(_.value=!1),w!=null&&w.value&&f(w.value)}}),C=N(()=>{var M,U;let w=i.fetchUsers?(M=n==null?void 0:n.data)==null?void 0:M.allUsers:[];return i.fetchUsers?(w=w.map(I=>({label:I.full_name||I.name||I.email,value:I.email})),(U=i.existingEmails)!=null&&U.length&&(w=w.filter(I=>!i.existingEmails.includes(I.value))),u.value&&(w=w.filter(I=>I.label.toLowerCase().includes(u.value.toLowerCase())||I.value.toLowerCase().includes(u.value.toLowerCase())))):!(w!=null&&w.length)&&u.value&&w.push({label:u.value,value:u.value}),w||[]}),f=w=>{v.value=null,b.value=null,w&&(w.split(",").forEach(U=>{var I;if(U=U.trim(),U)if((I=m.value)!=null&&I.includes(U))b.value=__("email already exists");else{if(U&&i.validate&&!i.validate(U)){v.value=i.errorMessage(U),u.value=U;return}m.value?m.value.push(U):m.value=[U],U=U.replace(U,"")}}),!v.value&&(w=""))},d=w=>{m.value=m.value.filter(M=>M!==w)},y=()=>{var M;if(u.value)return;let w=(M=a.value[a.value.length-1])==null?void 0:M.$el;document.activeElement===w?(m.value.pop(),nl(()=>{m.value.length?(w=a.value[a.value.length-1].$el,w==null||w.focus()):k()})):w==null||w.focus()};function k(){o.value.$el.focus()}return l({setFocus:k}),(w,M)=>{const U=T("FeatherIcon"),I=T("Button"),z=T("ErrorMessage");return s(),c("div",null,[e("div",ja,[(s(!0),c(B,null,Z(m.value,A=>(s(),S(I,{ref_for:!0,ref_key:"emails",ref:a,key:A,label:A,theme:"gray",variant:"subtle",class:K({"rounded bg-surface-white hover:!bg-surface-gray-1 focus-visible:ring-outline-gray-4":g.variant==="subtle"}),onKeydownCapture:dt(re(y,["stop"]),["delete"])},{suffix:j(()=>[r(U,{class:"h-3.5",name:"x",onClick:re(x=>d(A),["stop"])},null,8,["onClick"])]),_:2},1032,["label","class","onKeydownCapture"]))),128)),e("div",Ea,[r(t(Lt),{modelValue:p.value,"onUpdate:modelValue":M[2]||(M[2]=A=>p.value=A),nullable:""},{default:j(()=>[r(xl,{class:"w-full",show:_.value,"onUpdate:show":M[1]||(M[1]=A=>_.value=A)},{target:j(({togglePopover:A})=>[r(t($t),{ref_key:"search",ref:o,class:K(["search-input form-input w-full border-none focus:border-none focus:!shadow-none focus-visible:!ring-0",[g.variant=="ghost"?"bg-surface-white hover:bg-surface-white":"bg-surface-gray-2 hover:bg-surface-gray-3",g.inputClass]]),placeholder:g.placeholder,type:"text",value:u.value,onChange:M[0]||(M[0]=x=>{u.value=x.target.value,_.value=!0}),autocomplete:"off",onFocus:()=>A(),onKeydownCapture:dt(re(y,["stop"]),["delete"])},null,8,["class","placeholder","value","onFocus","onKeydownCapture"])]),body:j(({isOpen:A})=>[Ue(e("div",null,[e("div",Ia,[r(t(St),{class:"p-1.5 max-h-[12rem] overflow-y-auto",static:""},{default:j(()=>[C.value.length?$("",!0):(s(),c("div",Ta,[g.fetchUsers?(s(),S(U,{key:0,name:"search",class:"h-4"})):$("",!0),Y(" "+h(g.fetchUsers?w.__("No results found"):w.__("Type an email address to invite")),1)])),(s(!0),c(B,null,Z(C.value,x=>(s(),S(t(Vt),{key:x.value,value:x},{default:j(({active:R})=>[e("li",{class:K(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-3":R}])},[r(jt,{class:"mr-2",user:x.value,size:"lg"},null,8,["user"]),e("div",Ba,[e("div",Fa,h(x.label),1),e("div",Na,h(x.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[Pe,A]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])]),v.value?(s(),S(z,{key:0,class:"mt-2 pl-2",message:v.value},null,8,["message"])):$("",!0),b.value?(s(),c("div",za,h(b.value),1)):$("",!0)])}}},Pa={class:"flex gap-1 border rounded mb-4 p-2 text-ink-gray-5"},qa={class:"text-sm"},Ha={class:"block text-xs text-ink-gray-5 mb-1.5"},Ga={class:"p-2 group bg-surface-gray-2 hover:bg-surface-gray-3 rounded"},Za={class:"flex justify-end gap-2"},Ja={__name:"AddExistingUserModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(g){const{users:l,isAdmin:i,isManager:m}=ge(),n=Se(g,"modelValue"),a=D([]),o=D("Sales User"),v=N(()=>({"System Manager":"Can manage all aspects of the CRM, including user management, customizations and settings.","Sales Manager":"Can manage and invite new users, and create public & private views (reports).","Sales User":"Can work with leads and deals and create private views (reports)."})[o.value]),b=N(()=>[{value:"Sales User",label:__("Sales User")},...m()?[{value:"Sales Manager",label:__("Manager")}]:[],...i()?[{value:"System Manager",label:__("Admin")}]:[]]),u=ee({url:"crm.api.user.add_existing_users",makeParams:()=>({users:JSON.stringify(a.value),role:o.value}),onSuccess:()=>{F.success(__("Users added successfully")),a.value=[],n.value=!1,l.reload()},onError:_=>{F.error(_.messages[0]||__("Failed to add users"))}});return(_,p)=>{const C=T("FeatherIcon"),f=T("FormControl"),d=T("Button"),y=T("Dialog");return s(),S(y,{modelValue:n.value,"onUpdate:modelValue":p[3]||(p[3]=k=>n.value=k),options:{title:_.__("Add Existing User")},onClose:p[4]||(p[4]=k=>n.value=!1)},{"body-content":j(()=>{var k,w,M;return[e("div",Pa,[r(C,{name:"info",class:"size-3.5"}),e("p",qa,h(_.__("Add existing system users to this CRM. Assign them a role to grant access with their current credentials.")),1)]),e("label",Ha,h(_.__("Users")),1),e("div",Ga,[(M=(w=(k=t(l))==null?void 0:k.data)==null?void 0:w.crmUsers)!=null&&M.length?(s(),S(Oa,{key:0,class:"flex-1",inputClass:"!bg-surface-gray-2 hover:!bg-surface-gray-3 group-hover:!bg-surface-gray-3",placeholder:_.__("john@doe.com"),modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=U=>a.value=U),validate:t(at),existingEmails:[...t(l).data.crmUsers.map(U=>U.name),"admin@example.com"],"error-message":U=>_.__("{0} is an invalid email address",[U])},null,8,["placeholder","modelValue","validate","existingEmails","error-message"])):$("",!0)]),r(f,{type:"select",class:"mt-4",modelValue:o.value,"onUpdate:modelValue":p[1]||(p[1]=U=>o.value=U),label:_.__("Role"),options:b.value,description:v.value},null,8,["modelValue","label","options","description"])]}),actions:j(()=>[e("div",Za,[r(d,{variant:"solid",label:_.__("Add"),disabled:!a.value.length,onClick:p[2]||(p[2]=k=>t(u).submit()),loading:t(u).loading},null,8,["label","disabled","loading"])])]),_:1},8,["modelValue","options"])}}},Ya={class:"flex h-full flex-col gap-6 p-6 text-ink-gray-8"},Wa={class:"flex justify-between px-2 pt-2"},Ka={class:"flex flex-col gap-1 w-9/12"},Qa={class:"flex gap-2 text-xl font-semibold leading-none h-5"},Xa={class:"text-p-base text-ink-gray-6"},eo={class:"flex item-center space-x-2 w-3/12 justify-end"},to={key:0,class:"flex mt-28 justify-between w-full h-full"},lo={key:1,class:"flex justify-between w-full h-full"},so={class:"text-ink-gray-4 border border-dashed rounded w-full flex items-center justify-center"},no={key:2,class:"flex flex-col overflow-hidden"},ao={key:0,class:"flex items-center justify-between mb-4 px-2 pt-0.5"},oo={class:"divide-y divide-outline-gray-modals overflow-y-auto px-2"},io={class:"flex items-center"},ro={class:"flex flex-col ml-3"},uo={class:"flex items-center text-p-base text-ink-gray-8"},co={class:"text-p-sm text-ink-gray-5"},mo={class:"flex gap-2 items-center flex-row-reverse"},po={key:0,class:"flex justify-center"},_o={__name:"Users",setup(g){const{users:l,isAdmin:i,isManager:m}=ge(),n=D(!1),a=D(null),o=D(""),v=D("All"),b={"System Manager":__("Admin"),"Sales Manager":__("Manager"),"Sales User":__("Sales User")},u=N(()=>{var k,w;return(((w=(k=l.data)==null?void 0:k.crmUsers)==null?void 0:w.filter(M=>M.name!=="Administrator"))||[]).filter(M=>{var U,I;return((U=M.name)==null?void 0:U.includes(o.value))||((I=M.full_name)==null?void 0:I.includes(o.value))}).filter(M=>v.value==="All"?!0:M.role===v.value)}),_=D(!1);function p(y){return[{label:__("Remove"),icon:"trash-2",onClick:w=>{w.preventDefault(),w.stopPropagation(),_.value=!0},condition:()=>!_.value},{label:__("Confirm Remove"),icon:"trash-2",theme:"red",onClick:()=>d(y),condition:()=>_.value}].filter(w=>{var M;return((M=w.condition)==null?void 0:M.call(w))||!0})}function C(y){return[{label:__("Admin"),component:()=>Ye({option:__("Admin"),icon:"shield",selected:y.role==="System Manager"}),onClick:()=>f(y,"System Manager"),condition:()=>i()},{label:__("Manager"),component:()=>Ye({option:__("Manager"),icon:"briefcase",selected:y.role==="Sales Manager"}),onClick:()=>f(y,"Sales Manager"),condition:()=>m()},{label:__("Sales User"),component:()=>Ye({option:__("Sales User"),icon:"user-check",selected:y.role==="Sales User"}),onClick:()=>f(y,"Sales User")}].filter(w=>{var M;return((M=w.condition)==null?void 0:M.call(w))||!0})}function f(y,k){y.role!==k&&he("crm.api.user.update_user_role",{user:y.name,new_role:k}).then(()=>{F.success(__("{0} has been granted {1} access",[y.full_name,b[k]])),l.reload()})}function d(y){he("crm.api.user.remove_user",{user:y.name}).then(()=>{F.success(__("User {0} has been removed",[y.full_name])),l.reload()})}return me(()=>{a.value&&a.value.el.focus()}),(y,k)=>{var U,I,z,A,x,R;const w=T("Button"),M=T("FormControl");return s(),c(B,null,[e("div",Ya,[e("div",Wa,[e("div",Ka,[e("h2",Qa,h(y.__("Users")),1),e("p",Xa,h(y.__("Manage CRM users by adding or inviting them, and assign roles to control their access and permissions")),1)]),e("div",eo,[r(t(ce),{options:[{label:y.__("Add Existing User"),onClick:()=>n.value=!0},{label:y.__("Invite New User"),onClick:()=>$e.value="Invite User"}],button:{label:y.__("New"),iconLeft:"plus",variant:"solid"},placement:"right"},null,8,["options","button"])])]),t(l).loading?(s(),c("div",to,[r(w,{loading:t(l).loading,variant:"ghost",class:"w-full",size:"2xl"},null,8,["loading"])])):$("",!0),!t(l).loading&&((I=(U=t(l).data)==null?void 0:U.crmUsers)==null?void 0:I.length)==1?(s(),c("div",lo,[e("div",so,h(y.__("No users found")),1)])):$("",!0),!t(l).loading&&((A=(z=t(l).data)==null?void 0:z.crmUsers)==null?void 0:A.length)>1?(s(),c("div",no,[((R=(x=t(l).data)==null?void 0:x.crmUsers)==null?void 0:R.length)>10?(s(),c("div",ao,[r(t(lt),{ref_key:"searchRef",ref:a,modelValue:o.value,"onUpdate:modelValue":k[0]||(k[0]=L=>o.value=L),placeholder:y.__("Search user"),class:"w-1/3",debounce:300},{prefix:j(()=>[r(t(ae),{name:"search",class:"h-4 w-4 text-ink-gray-6"})]),_:1},8,["modelValue","placeholder"]),r(M,{type:"select",modelValue:v.value,"onUpdate:modelValue":k[1]||(k[1]=L=>v.value=L),options:[{label:y.__("All"),value:"All"},{label:y.__("Admin"),value:"System Manager"},{label:y.__("Manager"),value:"Sales Manager"},{label:y.__("Sales User"),value:"Sales User"}]},null,8,["modelValue","options"])])):$("",!0),e("ul",oo,[(s(!0),c(B,null,Z(u.value,L=>(s(),c("li",{key:L.name,class:"flex items-center justify-between py-2"},[e("div",io,[r(t(Ee),{image:L.user_image,label:L.full_name,size:"xl"},null,8,["image","label"]),e("div",ro,[e("div",uo,h(L.full_name),1),e("div",co,h(L.name),1)])]),e("div",mo,[r(t(ce),{options:p(L),button:{icon:"more-horizontal",onblur:q=>{q.stopPropagation(),_.value=!1}},placement:"right"},null,8,["options","button"]),t(m)()&&L.role=="System Manager"?(s(),S(t(tt),{key:0,text:y.__("Cannot change role of user with Admin access")},{default:j(()=>[r(w,{label:y.__("Admin"),"icon-left":"shield"},null,8,["label"])]),_:1},8,["text"])):(s(),S(t(ce),{key:1,options:C(L),button:{label:b[L.role],iconRight:"chevron-down",iconLeft:L.role==="System Manager"?"shield":L.role==="Sales Manager"?"briefcase":"user-check"},placement:"right"},null,8,["options","button"]))])]))),128)),!t(l).loading&&t(l).hasNextPage?(s(),c("div",po,[r(w,{class:"mt-3.5 p-2",onClick:k[2]||(k[2]=()=>t(l).next()),loading:t(l).loading,label:y.__("Load More"),"icon-left":"refresh-cw"},null,8,["loading","label"])])):$("",!0)])])):$("",!0)]),n.value?(s(),S(Ja,{key:0,modelValue:n.value,"onUpdate:modelValue":k[3]||(k[3]=L=>n.value=L)},null,8,["modelValue"])):$("",!0)],64)}}},fo={class:"flex h-full flex-col gap-6 py-8 px-6 text-ink-gray-8"},go={class:"flex px-2 justify-between"},vo={class:"flex flex-col gap-1 w-9/12"},ho={class:"flex gap-2 text-xl font-semibold leading-none h-5"},yo={class:"text-p-base text-ink-gray-6"},bo={class:"flex item-center space-x-2 w-3/12 justify-end"},xo={class:"flex-1 flex flex-col px-2 gap-8 overflow-y-auto"},ko={key:0,class:"text-xs text-ink-red-3 mt-1.5"},Co={key:0,class:"flex flex-col gap-4"},wo={class:"flex items-center justify-between text-base font-semibold"},$o={class:"flex flex-col gap-1"},So={class:"text-base"},Vo={class:"text-ink-gray-8"},Lo={class:"text-ink-gray-5"},Mo={__name:"InviteUserPage",setup(g){const{updateOnboardingStep:l}=Ie("frappecrm"),{users:i,isAdmin:m,isManager:n}=ge(),a=D([]),o=D("Sales User"),v=D(null),b=N(()=>{var I,z;const k=new Set(a.value);if(!k.size||!((z=(I=i.data)==null?void 0:I.crmUsers)!=null&&z.length))return null;const w=i.data.crmUsers.map(A=>A.name),M=new Set(w),U=k.intersection(M);return U.size===0?null:__("User with email {0} already exists",[Array.from(U).join(", ")])}),u=N(()=>{var I;const k=new Set(a.value);if(!k.size||!((I=d.data)!=null&&I.length))return null;const w=d.data.map(z=>z.email),M=new Set(w),U=k.intersection(M);return U.size===0?null:__("User with email {0} already invited",[Array.from(U).join(", ")])}),_=N(()=>({"System Manager":"Can manage all aspects of the CRM, including user management, customizations and settings.","Sales Manager":"Can manage and invite new users, and create public & private views (reports).","Sales User":"Can work with leads and deals and create private views (reports)."})[o.value]),p=N(()=>[{value:"Sales User",label:__("Sales User")},...n()?[{value:"Sales Manager",label:__("Manager")}]:[],...m()?[{value:"System Manager",label:__("Admin")}]:[]]),C={"Sales User":__("Sales User"),"Sales Manager":__("Manager"),"System Manager":__("Admin")},f=ee({url:"crm.api.invite_by_email",makeParams(){return{emails:Dl(a.value),role:o.value}},onSuccess(k){var w;(w=k==null?void 0:k.existing_invites)!=null&&w.length?v.value=__("User with email {0} already exists",[k.existing_invites.join(", ")]):(o.value="Sales User",v.value=null),a.value=[],d.reload(),l("invite_your_team")},onError(k){var w;v.value=(w=k==null?void 0:k.messages)==null?void 0:w[0]}}),d=je({type:"list",doctype:"CRM Invitation",filters:{status:"Pending"},fields:["name","email","role"],pageLength:999,auto:!0});function y(k){const w=k.split(",").map(M=>M.trim()).filter(M=>at(M));a.value=w}return(k,w)=>{var I;const M=T("Button"),U=T("ErrorMessage");return s(),c("div",fo,[e("div",go,[e("div",vo,[e("h2",ho,h(k.__("Send invites to")),1),e("p",yo,h(k.__("Invite users to access CRM. Specify their roles to control access and permissions")),1)]),e("div",bo,[r(M,{label:k.__("Send Invites"),variant:"solid",disabled:!a.value.length,onClick:w[0]||(w[0]=z=>t(f).submit()),loading:t(f).loading},null,8,["label","disabled","loading"])])]),e("div",xo,[e("div",null,[r(t(O),{type:"textarea",label:"Invite by email",placeholder:"user1@example.com, user2@example.com, ...",onInput:w[1]||(w[1]=z=>y(z.target.value)),debounce:100,disabled:t(f).loading,description:k.__("You can invite multiple users by comma separating their email addresses")},null,8,["disabled","description"]),b.value||u.value?(s(),c("div",ko,h(b.value||u.value),1)):$("",!0),r(t(O),{type:"select",class:"mt-4",modelValue:o.value,"onUpdate:modelValue":w[2]||(w[2]=z=>o.value=z),label:k.__("Invite as"),options:p.value,description:_.value},null,8,["modelValue","label","options","description"])]),(I=t(d).data)!=null&&I.length&&!a.value.length?(s(),c("div",Co,[e("div",wo,[e("div",null,h(k.__("Pending Invites")),1)]),e("ul",$o,[(s(!0),c(B,null,Z(t(d).data,z=>(s(),c("li",{class:"flex items-center justify-between px-2 py-1 rounded-lg bg-surface-gray-2",key:z.name},[e("div",So,[e("span",Vo,h(z.email),1),e("span",Lo," ("+h(C[z.role])+") ",1)]),e("div",null,[r(M,{tooltip:k.__("Delete invitation"),icon:"x",variant:"ghost",loading:t(d).delete.loading&&t(d).delete.params.name===z.name,onClick:A=>t(d).delete.submit(z.name)},null,8,["tooltip","loading","onClick"])])]))),128))])])):$("",!0)]),r(U,{message:v.value},null,8,["message"])])}}},Do={class:"flex h-full flex-col gap-6 p-8 text-ink-gray-8"},Ro={class:"flex-1 flex flex-col gap-6 mt-2 overflow-y-auto"},Ao={key:0,class:"flex w-full items-center justify-between"},Uo={class:"flex items-center gap-4"},jo={class:"group relative !size-[66px]"},Eo={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},Io={class:"flex flex-col gap-1"},To={class:"text-2xl font-semibold text-ink-gray-8"},Bo={class:"text-base text-ink-gray-7"},Fo={class:"flex flex-col gap-4"},No={class:"flex justify-between gap-4"},zo={class:"flex justify-between items-center"},Oo={__name:"ProfileSettings",setup(g){const{getUser:l,users:i}=ge(),m=N(()=>l()||{}),n=D({}),a=D(""),o=D(!1),v=N(()=>n.value.first_name!==m.value.first_name||n.value.last_name!==m.value.last_name),b=ee({url:"frappe.client.set_value",makeParams(){return{doctype:"User",name:m.value.name,fieldname:{first_name:n.value.first_name,last_name:n.value.last_name,user_image:n.value.user_image}}},onSuccess:()=>{a.value="",F.success(__("Profile updated successfully")),i.reload()},onError:_=>{a.value=_.messages[0]||__("Failed to update profile")}});function u(_=""){n.value.user_image=_,b.submit()}return me(()=>{n.value={...m.value}}),(_,p)=>{const C=T("ErrorMessage"),f=T("Button"),d=T("FormControl");return s(),c("div",Do,[e("div",Ro,[n.value?(s(),c("div",Ao,[r(t(Et),{onSuccess:p[0]||(p[0]=y=>u(y.file_url)),validateFile:t(Rl)},{default:j(({openFileSelector:y,error:k})=>[e("div",Uo,[e("div",jo,[r(t(Ee),{class:"!size-16",image:n.value.user_image,label:n.value.full_name},null,8,["image","label"]),(s(),S(_e(n.value.user_image?t(ce):"div"),wt(n.value.user_image?{options:[{icon:"upload",label:n.value.user_image?_.__("Change image"):_.__("Upload image"),onClick:y},{icon:"trash-2",label:_.__("Remove image"),onClick:()=>u()}]}:{onClick:y},{class:"!absolute bottom-0 left-0 right-0"}),{default:j(()=>[e("div",Eo,[r(Bl,{class:"size-4 cursor-pointer text-white"})])]),_:1},16))]),e("div",Io,[e("span",To,h(n.value.full_name),1),e("span",Bo,h(n.value.email),1),r(C,{message:_.__(k)},null,8,["message"])])])]),_:1},8,["validateFile"]),r(f,{label:_.__("Change Password"),"icon-left":"lock",onClick:p[1]||(p[1]=y=>o.value=!0)},null,8,["label"]),o.value?(s(),S(fl,{key:0,modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=y=>o.value=y)},null,8,["modelValue"])):$("",!0)])):$("",!0),e("div",Fo,[e("div",No,[r(d,{class:"w-full",label:_.__("First name"),modelValue:n.value.first_name,"onUpdate:modelValue":p[3]||(p[3]=y=>n.value.first_name=y)},null,8,["label","modelValue"]),r(d,{class:"w-full",label:_.__("Last name"),modelValue:n.value.last_name,"onUpdate:modelValue":p[4]||(p[4]=y=>n.value.last_name=y)},null,8,["label","modelValue"])])])]),e("div",zo,[e("div",null,[r(C,{message:a.value},null,8,["message"])]),r(f,{variant:"solid",label:_.__("Update"),disabled:!v.value,loading:t(b).loading,onClick:p[5]||(p[5]=y=>t(b).submit())},null,8,["label","disabled","loading"])])])}}},Po={class:"flex h-full flex-col gap-6"},qo={class:"flex justify-between"},Ho={class:"flex flex-col gap-1 w-9/12"},Go={class:"flex gap-2 text-xl font-semibold leading-none h-5 text-ink-gray-8"},Zo={class:"flex item-center space-x-2 w-3/12 justify-end"},Jo={key:0,class:"flex-1 overflow-y-auto"},Yo={key:1,class:"flex flex-1 items-center justify-center"},Ft={__name:"SettingsPage",props:{doctype:{type:String,required:!0},title:{type:String,default:""},successMessage:{type:String,default:"Updated Successfully"}},setup(g){const l=g,i=ee({url:"crm.api.doc.get_fields",cache:["fields",l.doctype],params:{doctype:l.doctype,allow_all_fieldtypes:!0},auto:!0}),m=We({doctype:l.doctype,name:l.doctype,fields:["*"],auto:!0,setValue:{onSuccess:()=>{F.success(__(l.successMessage))},onError:a=>{F.error(a.message+": "+a.messages[0])}}}),n=N(()=>{if(!i.data)return[];let a=[],o=i.data;if(o[0].type!="Tab Break"){let v=[];o[0].type!="Section Break"&&v.push({name:"first_section",columns:[{name:"first_column",fields:[]}]}),a.push({name:"first_tab",sections:v})}return o.forEach(v=>{let b=a[a.length-1],u=a.length?b.sections:[];if(v.fieldtype==="Tab Break")a.push({label:v.label,name:v.fieldname,sections:[{name:"section_"+ve(),columns:[{name:"column_"+ve(),fields:[]}]}]});else if(v.fieldtype==="Section Break")u.push({label:v.label,name:v.fieldname,hideBorder:v.hide_border,columns:[{name:"column_"+ve(),fields:[]}]});else if(v.fieldtype==="Column Break")u[u.length-1].columns.push({name:v.fieldname,fields:[]});else{let _=u[u.length-1];_.columns[_.columns.length-1].fields.push(v)}}),a});return(a,o)=>{var b;const v=T("Button");return s(),c("div",Po,[e("div",qo,[e("div",Ho,[e("h2",Go,[Y(h(g.title||a.__(g.doctype))+" ",1),t(m).isDirty?(s(),S(t(Ve),{key:0,label:a.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):$("",!0)])]),e("div",Zo,[r(v,{loading:t(m).save.loading,label:a.__("Update"),variant:"solid",onClick:o[0]||(o[0]=u=>t(m).save.submit())},null,8,["loading","label"])])]),t(m).get.loading?(s(),c("div",Yo,[r(t(Bt),{class:"size-8"})])):(s(),c("div",Jo,[(b=t(m))!=null&&b.doc&&n.value?(s(),S(Xe,{key:0,tabs:n.value,data:t(m).doc,doctype:g.doctype},null,8,["tabs","data","doctype"])):$("",!0)])),r(t(de),{message:t(m).save.error},null,8,["message"])])}}},Wo={__name:"WhatsAppSettings",setup(g){return(l,i)=>(s(),S(Ft,{doctype:"WhatsApp Settings",class:"p-8"}))}},Ko={__name:"ERPNextSettings",setup(g){return(l,i)=>(s(),S(Ft,{doctype:"ERPNext CRM Settings",title:l.__("ERPNext settings"),successMessage:l.__("ERPNext settings updated"),class:"p-8"},null,8,["title","successMessage"]))}},Qo={class:"flex h-full flex-col gap-6 text-ink-gray-8"},Xo={class:"flex justify-between px-2 pt-2"},ei={class:"flex flex-col gap-1 w-9/12"},ti={class:"flex gap-2 text-xl font-semibold leading-none h-5 items-center"},li={class:"text-p-base text-ink-gray-6"},si={class:"flex item-center space-x-2 w-3/12 justify-end"},ni={key:0,class:"flex mt-28 justify-between w-full h-full"},ai={key:1,class:"flex justify-between w-full h-full"},oi={class:"text-ink-gray-4 border border-dashed rounded w-full flex items-center justify-center"},ii={key:2,class:"flex flex-col overflow-hidden"},ri={class:"flex items-center py-2 px-4 text-sm text-ink-gray-5"},ui={class:"w-4/6"},di={class:"w-1/6"},ci={class:"w-1/6"},mi={class:"overflow-y-auto px-2"},pi=["onClick"],_i={class:"flex flex-col w-4/6 pr-5"},fi={class:"text-p-base font-medium text-ink-gray-7 truncate"},gi={class:"flex flex-col w-1/6 pr-5"},vi={class:"text-p-base font-medium text-ink-gray-7 truncate"},hi={class:"flex items-center justify-between w-1/6"},yi={key:0,class:"h-px border-t mx-2 border-outline-gray-modals"},bi={key:0,class:"flex justify-center"},xi={__name:"LeadSyncSources",emits:["updateStep"],setup(g,{emit:l}){const i=l,m=Q("sources"),n=D(""),a=D(!1),o=N(()=>{let _=m.data||[];return n.value&&(_=_.filter(p=>p.name.toLowerCase().includes(n.value.toLowerCase())||p.subject.toLowerCase().includes(n.value.toLowerCase()))),_});function v(_){m.setValue.submit({name:_.name,enabled:_.enabled?1:0},{onSuccess:()=>{F.success(_.enabled?__("Source enabled successfully"):__("Source disabled successfully"))},onError:p=>{F.error(p.messages[0]||__("Failed to update source")),_.enabled=!_.enabled}})}function b(_){a.value=!1,m.delete.submit(_.name,{onSuccess:()=>{F.success(__("Lead Sync Source deleted successfully"))},onError:p=>{F.error(p.messages[0]||__("Failed to delete Lead Sync Source"))}})}function u(_){return[{label:__("Duplicate"),icon:"copy",onClick:()=>i("updateStep","new-source",{..._})},{label:__("Delete"),icon:"trash-2",onClick:C=>{C.preventDefault(),C.stopPropagation(),a.value=!0},condition:()=>!a.value},{label:__("Confirm Delete"),icon:"trash-2",theme:"red",onClick:()=>b(_),condition:()=>a.value}]}return(_,p)=>{var f,d;const C=T("Button");return s(),c("div",Qo,[e("div",Xo,[e("div",ei,[e("h2",ti,[Y(h(_.__("Lead sources"))+" ",1),r(t(Ve),{theme:"orange",size:"sm"},{default:j(()=>[...p[4]||(p[4]=[Y("Beta",-1)])]),_:1})]),e("p",li,h(_.__("Add, edit, and manage sources for automatic lead syncing to your CRM")),1)]),e("div",si,[r(C,{label:_.__("New"),"icon-left":"plus",variant:"solid",onClick:p[0]||(p[0]=y=>i("updateStep","new-source"))},null,8,["label"])])]),t(m).loading?(s(),c("div",ni,[r(C,{loading:t(m).loading,variant:"ghost",class:"w-full",size:"2xl"},null,8,["loading"])])):$("",!0),!t(m).loading&&!((f=t(m).data)!=null&&f.length)?(s(),c("div",ai,[e("div",oi,h(_.__("No lead sources found")),1)])):$("",!0),!t(m).loading&&((d=t(m).data)!=null&&d.length)?(s(),c("div",ii,[e("div",ri,[e("div",ui,h(_.__("Name")),1),e("div",di,h(_.__("Source")),1),e("div",ci,h(_.__("Enabled")),1)]),p[5]||(p[5]=e("div",{class:"h-px border-t mx-4 border-outline-gray-modals"},null,-1)),e("ul",mi,[(s(!0),c(B,null,Z(o.value,(y,k)=>(s(),c(B,{key:y.name},[e("li",{class:"flex items-center justify-between p-3 cursor-pointer hover:bg-surface-menu-bar rounded",onClick:()=>i("updateStep","edit-source",{...y})},[e("div",_i,[e("div",fi,h(y.name),1)]),e("div",gi,[e("div",vi,h(y.type),1)]),e("div",hi,[r(t(fe),{size:"sm",modelValue:y.enabled,"onUpdate:modelValue":[w=>y.enabled=w,w=>v(y)],onClick:p[1]||(p[1]=re(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"]),r(t(ce),{class:"",options:u(y),placement:"right",button:{icon:"more-horizontal",variant:"ghost",onblur:w=>{w.stopPropagation(),a.value=!1}},onClick:p[2]||(p[2]=re(()=>{},["stop"]))},null,8,["options","button"])])],8,pi),o.value.length!==k+1?(s(),c("div",yi)):$("",!0)],64))),128)),!t(m).loading&&t(m).hasNextPage?(s(),c("div",bi,[r(C,{class:"mt-3.5 p-2",onClick:p[3]||(p[3]=()=>t(m).next()),loading:t(m).loading,label:_.__("Load More"),"icon-left":"refresh-cw"},null,8,["loading","label"])])):$("",!0)])])):$("",!0)])}}},ki={},Ci={xmlns:"http://www.w3.org/2000/svg","xmlns:svg":"http://www.w3.org/2000/svg",version:"1.1",id:"svg9",width:"666.66669",height:"666.66718",viewBox:"0 0 666.66668 666.66717"};function wi(g,l){return s(),c("svg",Ci,[...l[0]||(l[0]=[Mt('<defs id="defs13"><clipPath clipPathUnits="userSpaceOnUse" id="clipPath25"><path d="M 0,700 H 700 V 0 H 0 Z" id="path23"></path></clipPath></defs><g id="g17" transform="matrix(1.3333333,0,0,-1.3333333,-133.33333,799.99999)"><g id="g19"><g id="g21" clip-path="url(#clipPath25)"><g id="g27" transform="translate(600,350)"><path d="m 0,0 c 0,138.071 -111.929,250 -250,250 -138.071,0 -250,-111.929 -250,-250 0,-117.245 80.715,-215.622 189.606,-242.638 v 166.242 h -51.552 V 0 h 51.552 v 32.919 c 0,85.092 38.508,124.532 122.048,124.532 15.838,0 43.167,-3.105 54.347,-6.211 V 81.986 c -5.901,0.621 -16.149,0.932 -28.882,0.932 -40.993,0 -56.832,-15.528 -56.832,-55.9 V 0 h 81.659 l -14.028,-76.396 h -67.631 V -248.169 C -95.927,-233.218 0,-127.818 0,0" style="fill:#0866ff;fill-opacity:1;fill-rule:nonzero;stroke:none;" id="path29"></path></g><g id="g31" transform="translate(447.9175,273.6036)"><path d="M 0,0 14.029,76.396 H -67.63 v 27.019 c 0,40.372 15.838,55.899 56.831,55.899 12.733,0 22.981,-0.31 28.882,-0.931 v 69.253 c -11.18,3.106 -38.509,6.212 -54.347,6.212 -83.539,0 -122.048,-39.441 -122.048,-124.533 V 76.396 h -51.552 V 0 h 51.552 v -166.242 c 19.343,-4.798 39.568,-7.362 60.394,-7.362 10.254,0 20.358,0.632 30.288,1.831 L -67.63,0 Z" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none;" id="path33"></path></g></g></g></g>',2)])])}const $i=X(ki,[["render",wi]]),bt=[{label:"Facebook",value:"Facebook",icon:$i,info:__("You will need a Meta developer account and an access token to sync leads from Facebook. Read more "),link:"https://www.facebook.com/business/help/503306463479099?id=2190812977867143",custom:!1}];__("Name"),__("Add a name for your source"),__("Access Token"),__("Enter your Facebook Access Token");const Si={class:"lucide lucide-circle-question-mark",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function Vi(g,l){return s(),c("svg",Si,[...l[0]||(l[0]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"},null,-1),e("path",{d:"M12 17h.01"},null,-1)])])}const Li=H({name:"lucide-circle-question-mark",render:Vi}),Mi={key:0},Di={class:"flex justify-between items-center"},Ri={class:"grid grid-cols-2 gap-2 mt-4"},Ai={class:"mt-4 flex flex-col gap-8"},Ui={key:1,class:"text-base"},ji={__name:"FailureLogs",props:{source:{type:String,required:!0}},setup(g){const l=g,i=D(null),m=je({doctype:"Failed Lead Sync Log",fields:["name","type","lead_data","traceback"],filters:{source:l.source},auto:!0}),n=[{label:__("ID"),key:"name"},{label:__("Type"),key:"type"}],a=D(null);return pe(i,()=>{var o;(o=i.value)!=null&&o.name&&(a.value=we("Failed Lead Sync Log",i.value.name,{whitelistedMethods:{retrySync:{method:"retry_sync",onSuccess(){F.success(__("Sync successful!"))},onError(v){F.error(v.message||(v.messages??v.messages[0])||v.exc_type||__("Error syncing lead"))}}}}))}),(o,v)=>{var u,_,p,C,f,d;const b=T("Button");return s(),c(B,null,[i.value?(s(),c("div",Mi,[e("div",Di,[r(b,{variant:"ghost","icon-left":"chevron-left",onClick:v[0]||(v[0]=y=>i.value=null)},{default:j(()=>[Y(h(o.__("Back to all logs")),1)]),_:1}),(_=(u=a.value)==null?void 0:u.document)!=null&&_.retrySync&&i.value.type!="Synced"?(s(),S(b,{key:0,loading:(C=(p=a.value)==null?void 0:p.document)==null?void 0:C.retrySync.loading,onClick:v[1]||(v[1]=y=>{var k,w;return(w=(k=a.value)==null?void 0:k.document)==null?void 0:w.retrySync.submit()})},{default:j(()=>[Y(h(o.__("Retry Sync")),1)]),_:1},8,["loading"])):$("",!0)]),e("div",Ri,[r(t(O),{type:"text",label:o.__("Log ID"),value:i.value.name,disabled:""},null,8,["label","value"]),r(t(O),{type:"text",label:o.__("Reason"),value:i.value.type,disabled:""},null,8,["label","value"])]),e("div",Ai,[e("div",null,[r(t(ct),{class:"h-[250px]",label:o.__("Lead Data"),value:i.value.lead_data,disabled:""},null,8,["label","value"])]),e("div",null,[i.value.traceback?(s(),S(t(ct),{key:0,class:"h-[250px]",label:o.__("Traceback"),disabled:"",value:i.value.traceback},null,8,["label","value"])):$("",!0)])])])):$("",!0),!i.value&&((f=t(m))!=null&&f.data)?(s(),S(t(Fl),{key:1,class:"h-full",columns:n,rows:(d=t(m))==null?void 0:d.data,options:{selectable:!1,showTooltip:!0,resizeColumn:!1,emptyState:{title:o.__("No failure logs found"),description:o.__("Any failed lead syncs will show up here")},onRowClick:y=>{i.value=y}}},{cell:j(({item:y,row:k,column:w})=>[w.key==="type"?(s(),S(t(Ve),{key:0},{default:j(()=>[Y(h(y),1)]),_:2},1024)):(s(),c("span",Ui,h(y),1))]),_:1},8,["rows","options"])):$("",!0)],64)}}},Ei={class:"flex h-full flex-col text-ink-gray-8"},Ii={class:"flex justify-between px-2 pt-2"},Ti={class:"flex gap-1 -ml-4 w-9/12"},Bi={class:"flex item-center space-x-4 w-3/12 justify-end"},Fi={class:"flex items-center space-x-2"},Ni={class:"text-sm text-ink-gray-7"},zi={key:0,class:"overflow-hidden flex h-full flex-col gap-6 mt-4"},Oi={class:"grid grid-cols-2 gap-4"},Pi={target:"_blank",href:"https://developers.facebook.com/docs/facebook-login/guides/access-tokens/"},qi={key:0},Hi={key:1,class:"mt-4"},xt={__name:"LeadSyncSourceForm",props:{sourceData:{type:Object,default:()=>({})}},emits:["updateStep"],setup(g,{emit:l}){var A;const i=g,m=l,n=N(()=>{const x=[{label:__("Details"),icon:Nl}];return y.value||x.push({label:__("Failure Logs"),icon:zl}),x}),a=D(0),o=D(null),v=D(null),b=N(()=>{var x,R;if(o.value)return(R=(x=o.value)==null?void 0:x.document)==null?void 0:R.doc}),{meta:u,getFields:_}=Al("Lead Sync Source"),p=D(_());pe(()=>u.data,()=>{p.value=_()});const C=N(()=>{if(!p.value)return{};const x={};for(const R of p.value)x[R.fieldname]=R;return x}),f=Q("sources"),d=D({name:"",type:"",access_token:"",facebook_page:"",facebook_lead_form:"",enabled:!0,background_sync_frequency:((A=C.value.background_sync_frequency)==null?void 0:A.default)||"Hourly"}),y=D(!0);function k(x){f.setValue.submit({name:d.value.name,...x},{onSuccess:()=>{o.value&&o.value.document.reload(),v.value.document.save.submit()},onError(R){F.error(R.messages[0]||__("Error updating Lead Sync Source"))}})}function w(){f.insert.submit({...d.value,type:d.value.type.value},{onSuccess:x=>{F.success(__("Lead Sync Source created successfully")),y.value=!1,o.value=z(x.name)},onError(x){F.error(x.messages[0]||__("Error creating Lead Sync Source"))}})}function M(){y.value?w():k({...d.value,type:d.value.type.value})}me(()=>{var x;(x=i.sourceData)!=null&&x.name&&(Object.assign(d.value,i.sourceData),y.value=!1,o.value=z(i.sourceData.name)),d.value.facebook_lead_form&&(v.value=we("Facebook Lead Form",d.value.facebook_lead_form))}),pe(()=>b.value,x=>{x&&(Object.assign(d.value,{...x,type:bt.find(R=>R.value===x.type)||x.type}),v.value=we("Facebook Lead Form",d.value.facebook_lead_form))}),pe(()=>d.value.facebook_page,(x,R)=>{R&&(d.value.facebook_lead_form="")}),pe(()=>d.value.facebook_lead_form,x=>{x?v.value=we("Facebook Lead Form",x):v.value=null});const U=ee({url:"crm.api.doc.get_fields_meta",params:{doctype:"CRM Lead",as_array:!0},cache:["fieldsMeta","CRM Lead"],auto:!0,transform:x=>{let R=["name","owner","creation","modified","modified_by","docstatus","_comments","_user_tags","_assign","_liked_by"];return x.filter(L=>!R.includes(L.fieldname))}}),I=N(()=>U.data?U.data.map(x=>({label:x.label,value:x.fieldname})):[]);function z(x){return we("Lead Sync Source",x,{whitelistedMethods:{syncLeads:{method:"sync_leads",onSuccess(){F.success(__("Syncing started in background"))},onError(R){F.error((R.messages??R.messages[0])||__("Error syncing leads"))}}}})}return(x,R)=>{var L,q,V,E,J,P,te;return s(),c("div",Ei,[e("div",Ii,[e("div",Ti,[r(t(G),{variant:"ghost","icon-left":"chevron-left",label:y.value?x.__("New Lead Sync Source"):d.value.name,size:"md",onClick:R[0]||(R[0]=()=>m("updateStep","source-list")),class:"cursor-pointer hover:bg-transparent focus:bg-transparent focus:outline-none focus:ring-0 focus:ring-offset-0 focus-visible:none active:bg-transparent active:outline-none active:ring-0 active:ring-offset-0 active:text-ink-gray-5 font-semibold text-xl hover:opacity-70 !pr-0 !max-w-96 !justify-start"},null,8,["label"])]),e("div",Bi,[e("div",Fi,[r(t(fe),{size:"sm",modelValue:d.value.enabled,"onUpdate:modelValue":R[1]||(R[1]=se=>d.value.enabled=se)},null,8,["modelValue"]),e("span",Ni,h(x.__("Enabled")),1)]),!y.value&&((q=(L=o.value)==null?void 0:L.document)!=null&&q.syncLeads)?(s(),S(t(G),{key:0,label:x.__("Sync Now"),variant:"outline",loading:(E=(V=o.value)==null?void 0:V.document)==null?void 0:E.syncLeads.loading,onClick:R[2]||(R[2]=se=>{var ye,W;return(W=(ye=o.value)==null?void 0:ye.document)==null?void 0:W.syncLeads.submit()})},null,8,["label","loading"])):$("",!0),r(t(G),{label:y.value?x.__("Create"):x.__("Update"),"icon-left":"plus",variant:"solid",loading:t(f).setValue.loading||t(f).insert.loading||((J=o.value)==null?void 0:J.loading),onClick:M},null,8,["label","loading"])])]),r(t(wl),{as:"div",modelValue:a.value,"onUpdate:modelValue":R[11]||(R[11]=se=>a.value=se),tabs:n.value,class:"mt-2"},{"tab-panel":j(({tab:se})=>{var ye;return[se.label=="Details"?(s(),c("div",zi,[e("div",Oi,[r(t(O),{type:"autocomplete",required:"true",modelValue:d.value.type,"onUpdate:modelValue":R[3]||(R[3]=W=>d.value.type=W),options:t(bt),label:x.__("Source Type"),placeholder:x.__("Select Source Type")},al({"item-prefix":j(({option:W})=>[(s(),S(_e(W.icon),{class:"size-4"}))]),_:2},[d.value.type?{name:"prefix",fn:j(()=>[(s(),S(_e(d.value.type.icon),{class:"mr-2 size-4"}))]),key:"0"}:void 0]),1032,["modelValue","options","label","placeholder"]),y.value?(s(),S(t(O),{key:0,type:"text",required:"true",modelValue:d.value.name,"onUpdate:modelValue":R[4]||(R[4]=W=>d.value.name=W),label:x.__("Source Name"),placeholder:x.__("Enter Source Name")},null,8,["modelValue","label","placeholder"])):$("",!0),C.value.background_sync_frequency?(s(),S(t(O),{key:1,type:"select",required:"true",options:C.value.background_sync_frequency.options,modelValue:d.value.background_sync_frequency,"onUpdate:modelValue":R[5]||(R[5]=W=>d.value.background_sync_frequency=W),label:x.__("Background Sync Frequency")},null,8,["options","modelValue","label"])):$("",!0),r(t(O),{type:"password",required:"true",modelValue:d.value.access_token,"onUpdate:modelValue":R[6]||(R[6]=W=>d.value.access_token=W),label:x.__("Access Token"),placeholder:x.__("Enter Access Token")},{suffix:j(()=>[e("a",Pi,[r(t(Li),{class:"w-4"})])]),_:1},8,["modelValue","label","placeholder"]),!y.value&&b.value&&b.value.last_synced_at?(s(),S(t(O),{key:2,modelValue:t(Ul)(b.value.last_synced_at),disabled:"",type:"datetime",label:x.__("Last Synced At")},null,8,["modelValue","label"])):$("",!0),y.value?$("",!0):(s(),S(Ne,{key:3,label:"Facebook Page",modelValue:d.value.facebook_page,"onUpdate:modelValue":R[7]||(R[7]=W=>d.value.facebook_page=W),doctype:"Facebook Page"},null,8,["modelValue"])),!y.value&&d.value.facebook_page?(s(),S(Ne,{key:4,label:"Lead Form",modelValue:d.value.facebook_lead_form,"onUpdate:modelValue":R[8]||(R[8]=W=>d.value.facebook_lead_form=W),doctype:"Facebook Lead Form",filters:{page:d.value.facebook_page}},null,8,["modelValue","filters"])):$("",!0)]),d.value.facebook_lead_form&&v.value&&((ye=v.value.document)!=null&&ye.doc)?(s(),c("div",qi,[r(It,{modelValue:v.value.document.doc.questions,"onUpdate:modelValue":R[9]||(R[9]=W=>v.value.document.doc.questions=W),parent:v.value.document.doc,"onUpdate:parent":R[10]||(R[10]=W=>v.value.document.doc=W),doctype:"Facebook Lead Form Question",parentDoctype:"Facebook Lead Form",parentFieldname:"questions",overrides:{fields:[{fieldname:"mapped_to_crm_field",options:I.value,placeholder:x.__("Not Synced")}]}},null,8,["modelValue","parent","overrides"])])):$("",!0)])):$("",!0),se.label=="Failure Logs"?(s(),c("div",Hi,[r(ji,{source:d.value.name},null,8,["source"])])):$("",!0)]}),_:1},8,["modelValue","tabs"]),r(t(de),{message:(te=(P=o.value)==null?void 0:P.document)==null?void 0:te.syncLeads.error},null,8,["message"])])}}},Gi={class:"flex-1 p-6"},Zi={__name:"LeadSyncSourcePage",setup(g){const l=D("source-list"),i=D(null),m=je({type:"list",doctype:"Lead Sync Source",cache:"lead_sync_sources",fields:["name","enabled","type","last_synced_at","facebook_lead_form"],auto:!0,orderBy:"modified desc",pageLength:20});ue("sources",m);function n(a,o){l.value=a,i.value=o}return(a,o)=>(s(),c("div",Gi,[l.value==="new-source"?(s(),S(xt,{key:0,sourceData:i.value,onUpdateStep:n},null,8,["sourceData"])):l.value==="source-list"?(s(),S(xi,{key:1,onUpdateStep:n})):l.value==="edit-source"?(s(),S(xt,{key:2,sourceData:i.value,onUpdateStep:n},null,8,["sourceData"])):$("",!0)]))}},Ji={class:"lucide lucide-image-up",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function Yi(g,l){return s(),c("svg",Ji,[...l[0]||(l[0]=[e("path",{d:"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21"},null,-1),e("path",{d:"m14 19.5 3-3 3 3"},null,-1),e("path",{d:"M17 22v-5.5"},null,-1),e("circle",{cx:"9",cy:"9",r:"2"},null,-1)])])}const Wi=H({name:"lucide-image-up",render:Yi}),Ki={class:"flex items-end space-x-1"},kt={__name:"ImageUploader",props:{image_url:String,image_type:{type:String,default:"image/*"}},emits:["upload","remove"],setup(g,{emit:l}){return(i,m)=>(s(),S(t(Et),{"file-types":g.image_type,onSuccess:m[1]||(m[1]=n=>{i.$emit("upload",n.file_url)})},{default:j(({progress:n,uploading:a,openFileSelector:o})=>[e("div",Ki,[r(t(G),{onClick:o,iconLeft:a?"cloud-upload":t(Wi),label:a?i.__("Uploading {0}%",[n]):g.image_url?i.__("Change"):i.__("Upload")},null,8,["onClick","iconLeft","label"]),g.image_url?(s(),S(t(G),{key:0,label:i.__("Remove"),onClick:m[0]||(m[0]=v=>i.$emit("remove"))},null,8,["label"])):$("",!0)])]),_:1},8,["file-types"]))}},Qi={class:"flex h-full flex-col gap-6 px-6 py-8 text-ink-gray-8"},Xi={class:"flex justify-between px-2 text-ink-gray-8"},er={class:"flex flex-col gap-1"},tr={class:"flex gap-2 text-xl font-semibold leading-none h-5"},lr={class:"text-p-base text-ink-gray-6"},sr={class:"flex item-center space-x-2 w-3/12 justify-end"},nr={class:"flex flex-1 flex-col p-2 gap-4 overflow-y-auto"},ar={class:"flex w-full"},or={class:"flex flex-col justify-between gap-4"},ir={class:"flex items-center flex-1 gap-5"},rr={class:"flex items-center justify-center rounded border border-outline-gray-modals size-20"},ur=["src"],dr={class:"flex flex-1 flex-col gap-1"},cr={class:"text-base font-medium"},mr={class:"text-p-base text-ink-gray-6"},pr={class:"flex flex-col justify-between gap-4"},_r={class:"flex items-center flex-1 gap-5"},fr={class:"flex items-center justify-center rounded border border-outline-gray-modals size-20"},gr=["src"],vr={class:"flex flex-1 flex-col gap-1"},hr={class:"text-base font-medium"},yr={class:"text-p-base text-ink-gray-6"},br={__name:"BrandSettings",setup(g){const{_settings:l,setupBrand:i}=ot();function m(){l.save.submit(null,{onSuccess:()=>{Ce.value=!1,i()}})}return(n,a)=>{var v,b,u,_,p,C;const o=T("Button");return s(),c("div",Qi,[e("div",Xi,[e("div",er,[e("h2",tr,h(n.__("Brand settings")),1),e("p",lr,h(n.__("Configure your brand name, logo, and favicon")),1)]),e("div",sr,[r(o,{label:n.__("Update"),variant:"solid",disabled:!t(l).isDirty,loading:t(l).loading,onClick:m},null,8,["label","disabled","loading"])])]),e("div",nr,[e("div",ar,[r(t(O),{type:"text",class:"w-1/2",size:"md",modelValue:t(l).doc.brand_name,"onUpdate:modelValue":a[0]||(a[0]=f=>t(l).doc.brand_name=f),label:n.__("Brand name"),placeholder:n.__("Enter brand name")},null,8,["modelValue","label","placeholder"])]),e("div",or,[e("div",ir,[e("div",rr,[(v=t(l).doc)!=null&&v.brand_logo?(s(),c("img",{key:0,src:(b=t(l).doc)==null?void 0:b.brand_logo,alt:"Logo",class:"size-8 rounded"},null,8,ur)):(s(),S(t(ht),{key:1,class:"size-5 text-ink-gray-4"}))]),e("div",dr,[e("span",cr,h(n.__("Brand logo")),1),e("span",mr,h(n.__("Appears in the left sidebar. Recommended size is 32x32 px in PNG or SVG")),1)]),e("div",null,[r(kt,{image_type:"image/ico",image_url:(u=t(l).doc)==null?void 0:u.brand_logo,onUpload:a[1]||(a[1]=f=>t(l).doc.brand_logo=f),onRemove:a[2]||(a[2]=()=>t(l).doc.brand_logo="")},null,8,["image_url"])])])]),e("div",pr,[e("div",_r,[e("div",fr,[(_=t(l).doc)!=null&&_.favicon?(s(),c("img",{key:0,src:(p=t(l).doc)==null?void 0:p.favicon,alt:"Favicon",class:"size-8 rounded"},null,8,gr)):(s(),S(t(ht),{key:1,class:"size-5 text-ink-gray-4"}))]),e("div",vr,[e("span",hr,h(n.__("Favicon")),1),e("span",yr,h(n.__("Appears next to the title in your browser tab. Recommended size is 32x32 px in PNG or ICO")),1)]),e("div",null,[r(kt,{image_type:"image/ico",image_url:(C=t(l).doc)==null?void 0:C.favicon,onUpload:a[3]||(a[3]=f=>t(l).doc.favicon=f),onRemove:a[4]||(a[4]=()=>t(l).doc.favicon="")},null,8,["image_url"])])])])])])}}},xr={class:"flex h-full flex-col gap-6 p-8 text-ink-gray-8"},kr={class:"flex justify-between text-ink-gray-8"},Cr={class:"flex flex-col gap-1"},wr={class:"flex gap-2 text-xl font-semibold leading-none h-5"},$r={class:"text-p-base text-ink-gray-6"},Sr={class:"flex item-center space-x-2 w-3/12 justify-end"},Vr={class:"flex flex-1 flex-col overflow-y-auto"},Lr={key:0},Mr={__name:"HomeActions",emits:["updateStep"],setup(g,{emit:l}){const{document:i,triggerOnChange:m}=we("FCRM Settings","FCRM Settings");ue("triggerOnChange",m);const n=D("");function a(){i.save.submit(null,{onSuccess:()=>{Ce.value=!1}})}return(o,v)=>{const b=T("Button");return s(),c("div",xr,[e("div",kr,[e("div",Cr,[e("h2",wr,h(o.__("Home actions")),1),e("p",$r,h(o.__("Configure actions that appear on the home dropdown")),1)]),e("div",Sr,[r(b,{label:o.__("Update"),variant:"solid",disabled:!t(i).isDirty,loading:t(i).loading,onClick:a},null,8,["label","disabled","loading"])])]),e("div",Vr,[r(It,{modelValue:t(i).doc.dropdown_items,"onUpdate:modelValue":v[0]||(v[0]=u=>t(i).doc.dropdown_items=u),doctype:"CRM Dropdown Item",parentDoctype:"FCRM Settings",parentFieldname:"dropdown_items"},null,8,["modelValue"])]),n.value?(s(),c("div",Lr,[r(t(de),{message:o.__(n.value)},null,8,["message"])])):$("",!0)])}}},Dr={class:"flex h-full flex-col gap-6 py-8 px-6 text-ink-gray-8"},Rr={class:"flex flex-col gap-1 px-2"},Ar={class:"flex gap-2 text-xl font-semibold leading-none h-5"},Ur={class:"text-p-base text-ink-gray-6"},jr={class:"flex-1 flex flex-col overflow-y-auto"},Er={class:"flex items-center justify-between py-3 px-2"},Ir={class:"flex flex-col"},Tr={class:"text-p-base font-medium text-ink-gray-7 truncate"},Br={class:"text-p-sm text-ink-gray-5 truncate"},Fr={class:"flex items-center justify-between py-3 px-2"},Nr={class:"flex flex-col"},zr={class:"text-p-base font-medium text-ink-gray-7 truncate"},Or={class:"text-p-sm text-ink-gray-5 truncate"},Pr={__name:"ForecastingSettings",setup(g){const{_settings:l}=ot();function i(){l.save.submit(null,{onSuccess:()=>{F.success(l.doc.enable_forecasting?__("Forecasting enabled successfully"):__("Forecasting disabled successfully"))}})}function m(){l.save.submit(null,{onSuccess:()=>{F.success(l.doc.auto_update_expected_deal_value?__("Auto update of expected deal value enabled"):__("Auto update of expected deal value disabled"))}})}return(n,a)=>(s(),c("div",Dr,[e("div",Rr,[e("h2",Ar,h(n.__("Forecasting")),1),e("p",Ur,h(n.__("Configure forecasting feature to help predict sales performance and growth")),1)]),e("div",jr,[e("div",Er,[e("div",Ir,[e("div",Tr,h(n.__("Enable forecasting")),1),e("div",Br,h(n.__('Makes "Expected Closure Date" and "Expected Deal Value" mandatory for deal value forecasting')),1)]),e("div",null,[r(t(fe),{size:"sm",modelValue:t(l).doc.enable_forecasting,"onUpdate:modelValue":a[0]||(a[0]=o=>t(l).doc.enable_forecasting=o),onClick:re(i,["stop"])},null,8,["modelValue"])])]),a[2]||(a[2]=e("div",{class:"h-px border-t mx-2 border-outline-gray-modals"},null,-1)),e("div",Fr,[e("div",Nr,[e("div",zr,h(n.__("Auto update expected deal value")),1),e("div",Or,h(n.__('Automatically update "Expected Deal Value" based on the total value of associated products in a deal')),1)]),e("div",null,[r(t(fe),{size:"sm",modelValue:t(l).doc.auto_update_expected_deal_value,"onUpdate:modelValue":a[1]||(a[1]=o=>t(l).doc.auto_update_expected_deal_value=o),onClick:re(m,["stop"])},null,8,["modelValue"])])])])]))}},qr={class:"flex h-full flex-col gap-6 px-6 py-8 text-ink-gray-8"},Hr={class:"flex justify-between px-2 text-ink-gray-8"},Gr={class:"flex flex-col gap-1"},Zr={class:"flex gap-2 text-xl font-semibold leading-none h-5"},Jr={class:"text-p-base text-ink-gray-6"},Yr={class:"flex item-center space-x-2 w-3/12 justify-end"},Wr={class:"flex flex-1 flex-col overflow-y-auto"},Kr={class:"flex items-center justify-between gap-8 py-3 px-2"},Qr={class:"flex flex-col"},Xr={class:"text-p-base font-medium text-ink-gray-7 truncate"},eu={class:"text-p-sm text-ink-gray-5"},tu={key:0,class:"text-base text-ink-gray-8"},lu={class:"flex items-center justify-between gap-8 py-3 px-2"},su={class:"flex flex-col"},nu={class:"text-p-base font-medium text-ink-gray-7 truncate"},au={class:"text-p-sm text-ink-gray-5"},ou={class:"flex items-center gap-2"},iu={key:0,class:"h-px border-t mx-2 border-outline-gray-modals"},ru={key:1,class:"flex items-center justify-between gap-8 p-3"},uu={class:"flex flex-col"},du={class:"text-p-base font-medium text-ink-gray-7 truncate"},cu={class:"text-p-sm text-ink-gray-5"},mu={class:"text-p-sm text-ink-gray-5"},pu={class:"hover:underline text-ink-gray-7",href:"https://exchangerate.host/#/docs/access_key",target:"_blank"},_u={class:"flex items-center gap-2"},fu={key:0,class:"px-3"},gu={__name:"CurrencySettings",setup(g){const{_settings:l}=ot(),{$dialog:i}=qe(),m=D("");function n(){l.save.submit(null,{validate:()=>{var o;if(m.value="",!((o=l.doc)!=null&&o.currency))return m.value=__("Please select a currency before saving."),m.value;if(l.doc.service_provider==="exchangerate.host"&&!l.doc.access_key)return m.value=__("Please enter the Exchangerate Host access key."),m.value},onSuccess:()=>{Ce.value=!1}})}function a(o){i({title:__("Set currency"),message:__("Are you sure you want to set the currency as {0}? This cannot be changed later.",[o]),variant:"solid",theme:"blue",actions:[{label:__("Save"),variant:"solid",onClick:v=>{l.doc.currency=o,l.save.submit(null,{onSuccess:()=>{F.success(__("Currency set as {0} successfully",[o])),v()}})}}]})}return(o,v)=>{var _,p,C,f;const b=T("Button"),u=Ne;return s(),c("div",qr,[e("div",Hr,[e("div",Gr,[e("h2",Zr,h(o.__("Currency & Exchange rate provider")),1),e("p",Jr,h(o.__("Configure the currency and exchange rate provider for your CRM")),1)]),e("div",Yr,[r(b,{label:o.__("Update"),variant:"solid",disabled:!t(l).isDirty,loading:t(l).loading,onClick:n},null,8,["label","disabled","loading"])])]),e("div",Wr,[e("div",Kr,[e("div",Qr,[e("div",Xr,h(o.__("Currency")),1),e("div",eu,h(o.__("CRM currency for all monetary values. Once set, cannot be edited.")),1)]),e("div",null,[(_=t(l).doc)!=null&&_.currency?(s(),c("div",tu,h(t(l).doc.currency),1)):(s(),S(u,{key:1,class:"form-control flex-1 truncate w-40",value:(p=t(l).doc)==null?void 0:p.currency,doctype:"Currency",onChange:v[0]||(v[0]=d=>a(d)),placeholder:o.__("Select currency"),placement:"bottom-end"},null,8,["value","placeholder"]))])]),v[3]||(v[3]=e("div",{class:"h-px border-t mx-2 border-outline-gray-modals"},null,-1)),e("div",lu,[e("div",su,[e("div",nu,h(o.__("Exchange rate provider")),1),e("div",au,h(o.__("Configure the exchange rate provider for your CRM")),1)]),e("div",ou,[r(t(O),{type:"select",class:"w-44",modelValue:t(l).doc.service_provider,"onUpdate:modelValue":v[1]||(v[1]=d=>t(l).doc.service_provider=d),options:[{label:"Frankfurter",value:"frankfurter.app"},{label:"Exchangerate Host",value:"exchangerate.host"}],placeholder:o.__("Select provider"),disabled:!((C=t(l).doc)!=null&&C.currency)},null,8,["modelValue","placeholder","disabled"])])]),t(l).doc.service_provider==="exchangerate.host"?(s(),c("div",iu)):$("",!0),t(l).doc.service_provider==="exchangerate.host"?(s(),c("div",ru,[e("div",uu,[e("div",du,h(o.__("Access key")),1),e("div",cu,h(o.__("Access key for Exchangerate Host. Required for fetching exchange rates.")),1),e("div",mu,[Y(h(o.__("You can get your access key from "))+" ",1),e("a",pu,h(o.__("exchangerate.host")),1)])]),e("div",_u,[r(t(O),{type:"text",class:"w-44",modelValue:t(l).doc.access_key,"onUpdate:modelValue":v[2]||(v[2]=d=>t(l).doc.access_key=d),placeholder:o.__("Enter access key"),disabled:!((f=t(l).doc)!=null&&f.currency)},null,8,["modelValue","placeholder","disabled"])])])):$("",!0)]),m.value?(s(),c("div",fu,[r(t(de),{message:o.__(m.value)},null,8,["message"])])):$("",!0)])}}},vu={class:"flex h-full flex-col gap-6 p-8 text-ink-gray-8"},hu={class:"flex justify-between"},yu={class:"flex gap-1 -ml-4 w-9/12"},bu={class:"flex item-center space-x-4 w-3/12 justify-end"},xu={class:"flex items-center space-x-2"},ku={class:"text-sm text-ink-gray-7"},Cu={class:"flex flex-1 flex-col gap-4 overflow-y-auto"},wu={class:"flex sm:flex-row flex-col gap-4"},$u={class:"flex-1"},Su={class:"flex-1"},Vu={class:"border-t pt-4"},Lu={key:1},Mu={class:"mb-1.5 text-base text-ink-gray-5"},Du={key:0},Ru={__name:"NewEmailTemplate",props:{templateData:{type:Object,default:()=>({})}},emits:["updateStep"],setup(g,{emit:l}){const i=g,m=l,n=D(""),a=D({name:"",reference_doctype:"CRM Deal",subject:"",content_type:"Rich Text",response_html:"",response:"",enabled:!1}),o=Q("templates"),v=()=>{if(n.value="",!a.value.name){n.value=__("Name is required");return}if(!a.value.subject){n.value=__("Subject is required");return}if(a.value.content_type==="Rich Text"&&!a.value.response){n.value=__("Content is required");return}if(a.value.content_type==="HTML"&&!a.value.response_html){n.value=__("Content is required");return}o.insert.submit({...a.value},{onSuccess:()=>{m("updateStep","template-list"),F.success(__("Template created successfully"))},onError:b=>{n.value=b.messages[0]||__("Failed to create template")}})};return me(()=>{var b;(b=i.templateData)!=null&&b.name&&(Object.assign(a.value,i.templateData),a.value.name=a.value.name+" - Copy",a.value.enabled=!1)}),(b,u)=>{var C,f;const _=T("Button"),p=T("ErrorMessage");return s(),c("div",vu,[e("div",hu,[e("div",yu,[r(_,{variant:"ghost","icon-left":"chevron-left",label:(C=g.templateData)!=null&&C.name?b.__("Duplicate template"):b.__("New template"),size:"md",onClick:u[0]||(u[0]=()=>m("updateStep","template-list")),class:"cursor-pointer hover:bg-transparent focus:bg-transparent focus:outline-none focus:ring-0 focus:ring-offset-0 focus-visible:none active:bg-transparent active:outline-none active:ring-0 active:ring-offset-0 active:text-ink-gray-5 font-semibold text-xl hover:opacity-70 !pr-0 !max-w-96 !justify-start"},null,8,["label"])]),e("div",bu,[e("div",xu,[r(t(fe),{size:"sm",modelValue:a.value.enabled,"onUpdate:modelValue":u[1]||(u[1]=d=>a.value.enabled=d)},null,8,["modelValue"]),e("span",ku,h(b.__("Enabled")),1)]),r(_,{label:(f=g.templateData)!=null&&f.name?b.__("Duplicate"):b.__("Create"),"icon-left":"plus",variant:"solid",onClick:v},null,8,["label"])])]),e("div",Cu,[e("div",wu,[e("div",$u,[r(t(O),{size:"md",modelValue:a.value.name,"onUpdate:modelValue":u[2]||(u[2]=d=>a.value.name=d),placeholder:b.__("Payment Reminder"),label:b.__("Name"),required:!0},null,8,["modelValue","placeholder","label"])]),e("div",Su,[r(t(O),{type:"select",size:"md",modelValue:a.value.reference_doctype,"onUpdate:modelValue":u[3]||(u[3]=d=>a.value.reference_doctype=d),label:b.__("For"),options:[{label:b.__("Deal"),value:"CRM Deal"},{label:b.__("Lead"),value:"CRM Lead"}],placeholder:b.__("Deal")},null,8,["modelValue","label","options","placeholder"])])]),e("div",null,[r(t(O),{ref:"subjectRef",size:"md",modelValue:a.value.subject,"onUpdate:modelValue":u[4]||(u[4]=d=>a.value.subject=d),label:b.__("Subject"),placeholder:b.__("Payment Reminder from Frapp - (#{{ name }})"),required:!0},null,8,["modelValue","label","placeholder"])]),e("div",Vu,[r(t(O),{type:"select",size:"md",modelValue:a.value.content_type,"onUpdate:modelValue":u[5]||(u[5]=d=>a.value.content_type=d),label:b.__("Content Type"),default:"Rich Text",options:["Rich Text","HTML"],placeholder:b.__("Rich Text")},null,8,["modelValue","label","placeholder"])]),e("div",null,[a.value.content_type==="HTML"?(s(),S(t(O),{key:0,size:"md",type:"textarea",label:b.__("Content"),required:!0,ref:"content",rows:10,modelValue:a.value.response_html,"onUpdate:modelValue":u[6]||(u[6]=d=>a.value.response_html=d),placeholder:b.__(`<p>Dear {{ lead_name }},</p>

<p>This is a reminder for the payment of {{ grand_total }}.</p>

<p>Thanks,</p>
<p>Frapp</p>`)},null,8,["label","modelValue","placeholder"])):(s(),c("div",Lu,[e("div",Mu,[Y(h(b.__("Content"))+" ",1),u[8]||(u[8]=e("span",{class:"text-ink-red-3"},"*",-1))]),r(t(Tt),{ref:"content","editor-class":"!prose-sm max-w-full overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors",bubbleMenu:!0,content:a.value.response,onChange:u[7]||(u[7]=d=>a.value.response=d),placeholder:b.__(`Dear {{ lead_name }}, 

This is a reminder for the payment of {{ grand_total }}. 

Thanks, 
Frapp`)},null,8,["content","placeholder"])]))])]),n.value?(s(),c("div",Du,[r(p,{message:b.__(n.value)},null,8,["message"])])):$("",!0)])}}},Au={class:"flex h-full flex-col gap-6 p-8 text-ink-gray-8"},Uu={class:"flex justify-between"},ju={class:"flex gap-1 -ml-4 w-9/12"},Eu={class:"flex item-center space-x-4 w-3/12 justify-end"},Iu={class:"flex items-center space-x-2"},Tu={class:"text-sm text-ink-gray-7"},Bu={class:"flex flex-1 flex-col gap-4 overflow-y-auto"},Fu={class:"flex sm:flex-row flex-col gap-4"},Nu={class:"flex-1"},zu={class:"flex-1"},Ou={class:"border-t pt-4"},Pu={key:1},qu={class:"mb-1.5 text-base text-ink-gray-5"},Hu={key:0},Gu={__name:"EditEmailTemplate",props:{templateData:{type:Object,required:!0}},emits:["updateStep"],setup(g,{emit:l}){const i=g,m=l,n=D(""),a=Q("templates"),o=D({}),v=async()=>{if(n.value="",!o.value.name){n.value=__("Name is required");return}if(!o.value.subject){n.value=__("Subject is required");return}if(o.value.content_type==="Rich Text"&&!o.value.response){n.value=__("Content is required");return}if(o.value.content_type==="HTML"&&!o.value.response_html){n.value=__("Content is required");return}o.value.use_html=o.value.content_type==="HTML";const _={...i.templateData,use_html:!!i.templateData.use_html},p={...o.value,use_html:!!o.value.use_html};delete p.content_type;const C=_.name!==p.name;delete _.name,delete p.name;const f=JSON.stringify(_)!==JSON.stringify(p),d=p;if(!C&&!f)return;let y=i.templateData.name;C&&(y=await u.fetch(),f||m("updateStep","template-list")),f&&a.setValue.submit({...d,name:y},{onSuccess:()=>{m("updateStep","template-list"),F.success(__("Template updated successfully"))},onError:k=>{n.value=k.messages[0]||__("Failed to update template")}})},b=N(()=>o.value.name!==i.templateData.name||o.value.reference_doctype!==i.templateData.reference_doctype||o.value.subject!==i.templateData.subject||o.value.response_html!==i.templateData.response_html||o.value.response!==i.templateData.response||o.value.use_html!==i.templateData.use_html||!!o.value.enabled!=!!i.templateData.enabled),u=ee({url:"frappe.client.rename_doc",method:"POST",makeParams(){return{doctype:"Email Template",old_name:i.templateData.name,new_name:o.value.name}},onSuccess:()=>{a.reload(),F.success(__("Template renamed successfully"))},onError:_=>{n.value=_.messages[0]||__("Failed to rename template")}});return me(()=>{o.value={...i.templateData},o.value.content_type=o.value.use_html?"HTML":"Rich Text"}),(_,p)=>{const C=T("Button"),f=T("ErrorMessage");return s(),c("div",Au,[e("div",Uu,[e("div",ju,[r(C,{variant:"ghost","icon-left":"chevron-left",label:_.__(o.value.name),size:"md",onClick:p[0]||(p[0]=()=>m("updateStep","template-list")),class:"cursor-pointer hover:bg-transparent focus:bg-transparent focus:outline-none focus:ring-0 focus:ring-offset-0 focus-visible:none active:bg-transparent active:outline-none active:ring-0 active:ring-offset-0 active:text-ink-gray-5 font-semibold text-xl hover:opacity-70 !pr-0 !max-w-96 !justify-start"},null,8,["label"])]),e("div",Eu,[e("div",Iu,[r(t(fe),{size:"sm",modelValue:o.value.enabled,"onUpdate:modelValue":p[1]||(p[1]=d=>o.value.enabled=d)},null,8,["modelValue"]),e("span",Tu,h(_.__("Enabled")),1)]),r(C,{label:_.__("Update"),"icon-left":"plus",variant:"solid",disabled:!b.value,loading:t(u).loading||t(a).setValue.loading,onClick:v},null,8,["label","disabled","loading"])])]),e("div",Bu,[e("div",Fu,[e("div",Nu,[r(t(O),{size:"md",modelValue:o.value.name,"onUpdate:modelValue":p[2]||(p[2]=d=>o.value.name=d),placeholder:_.__("Payment Reminder"),label:_.__("Name"),required:!0},null,8,["modelValue","placeholder","label"])]),e("div",zu,[r(t(O),{type:"select",size:"md",modelValue:o.value.reference_doctype,"onUpdate:modelValue":p[3]||(p[3]=d=>o.value.reference_doctype=d),label:_.__("For"),options:[{label:_.__("Deal"),value:"CRM Deal"},{label:_.__("Lead"),value:"CRM Lead"}],placeholder:_.__("Deal")},null,8,["modelValue","label","options","placeholder"])])]),e("div",null,[r(t(O),{ref:"subjectRef",size:"md",modelValue:o.value.subject,"onUpdate:modelValue":p[4]||(p[4]=d=>o.value.subject=d),label:_.__("Subject"),placeholder:_.__("Payment Reminder from Frapp - (#{{ name }})"),required:!0},null,8,["modelValue","label","placeholder"])]),e("div",Ou,[r(t(O),{type:"select",size:"md",modelValue:o.value.content_type,"onUpdate:modelValue":p[5]||(p[5]=d=>o.value.content_type=d),label:_.__("Content Type"),default:"Rich Text",options:["Rich Text","HTML"],placeholder:_.__("Rich Text")},null,8,["modelValue","label","placeholder"])]),e("div",null,[o.value.content_type==="HTML"?(s(),S(t(O),{key:0,size:"md",type:"textarea",label:_.__("Content"),required:!0,ref:"content",rows:10,modelValue:o.value.response_html,"onUpdate:modelValue":p[6]||(p[6]=d=>o.value.response_html=d),placeholder:_.__(`<p>Dear {{ lead_name }},</p>

<p>This is a reminder for the payment of {{ grand_total }}.</p>

<p>Thanks,</p>
<p>Frapp</p>`)},null,8,["label","modelValue","placeholder"])):(s(),c("div",Pu,[e("div",qu,[Y(h(_.__("Content"))+" ",1),p[8]||(p[8]=e("span",{class:"text-ink-red-3"},"*",-1))]),r(t(Tt),{ref:"content","editor-class":"!prose-sm max-w-full overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-[--surface-gray-2] bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 hover:shadow-sm focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors",bubbleMenu:!0,content:o.value.response,onChange:p[7]||(p[7]=d=>o.value.response=d),placeholder:_.__(`Dear {{ lead_name }}, 

This is a reminder for the payment of {{ grand_total }}. 

Thanks, 
Frapp`)},null,8,["content","placeholder"])]))])]),n.value?(s(),c("div",Hu,[r(f,{message:_.__(n.value)},null,8,["message"])])):$("",!0)])}}},Zu={class:"flex h-full flex-col gap-6 p-6 text-ink-gray-8"},Ju={class:"flex justify-between px-2 pt-2"},Yu={class:"flex flex-col gap-1 w-9/12"},Wu={class:"flex gap-2 text-xl font-semibold leading-none h-5"},Ku={class:"text-p-base text-ink-gray-6"},Qu={class:"flex item-center space-x-2 w-3/12 justify-end"},Xu={key:0,class:"flex mt-28 justify-between w-full h-full"},ed={key:1,class:"flex justify-between w-full h-full"},td={class:"text-ink-gray-4 border border-dashed rounded w-full flex items-center justify-center"},ld={key:2,class:"flex flex-col overflow-hidden"},sd={key:0,class:"flex items-center justify-between mb-4 px-2 pt-0.5"},nd={class:"flex items-center py-2 px-4 text-sm text-ink-gray-5"},ad={class:"w-4/6"},od={class:"w-1/6"},id={class:"w-1/6"},rd={class:"overflow-y-auto px-2"},ud=["onClick"],dd={class:"flex flex-col w-4/6 pr-5"},cd={class:"text-p-base font-medium text-ink-gray-7 truncate"},md={class:"text-p-sm text-ink-gray-5 truncate"},pd={class:"text-base text-ink-gray-6 w-1/6"},_d={class:"flex items-center justify-between w-1/6"},fd={key:0,class:"h-px border-t mx-2 border-outline-gray-modals"},gd={key:0,class:"flex justify-center"},vd={__name:"EmailTemplates",emits:["updateStep"],setup(g,{emit:l}){const i=l,m=Q("templates"),n=D(""),a=D("All"),o=D(!1),v=N(()=>{let p=m.data||[];return n.value&&(p=p.filter(C=>C.name.toLowerCase().includes(n.value.toLowerCase())||C.subject.toLowerCase().includes(n.value.toLowerCase()))),a.value!=="All"&&(p=p.filter(C=>C.reference_doctype===a.value)),p});function b(p){m.setValue.submit({name:p.name,enabled:p.enabled?1:0},{onSuccess:()=>{F.success(p.enabled?__("Template enabled successfully"):__("Template disabled successfully"))},onError:C=>{F.error(C.messages[0]||__("Failed to update template")),p.enabled=!p.enabled}})}function u(p){o.value=!1,m.delete.submit(p.name,{onSuccess:()=>{F.success(__("Template deleted successfully"))},onError:C=>{F.error(C.messages[0]||__("Failed to delete template"))}})}function _(p){return[{label:__("Duplicate"),icon:"copy",onClick:()=>i("updateStep","new-template",{...p})},{label:__("Delete"),icon:"trash-2",onClick:f=>{f.preventDefault(),f.stopPropagation(),o.value=!0},condition:()=>!o.value},{label:__("Confirm Delete"),icon:"trash-2",theme:"red",onClick:()=>u(p),condition:()=>o.value}]}return(p,C)=>{var d,y,k;const f=T("Button");return s(),c("div",Zu,[e("div",Ju,[e("div",Yu,[e("h2",Wu,h(p.__("Email templates")),1),e("p",Ku,h(p.__("Add, edit, and manage email templates for various CRM communications")),1)]),e("div",Qu,[r(f,{label:p.__("New"),"icon-left":"plus",variant:"solid",onClick:C[0]||(C[0]=w=>i("updateStep","new-template"))},null,8,["label"])])]),t(m).loading?(s(),c("div",Xu,[r(f,{loading:t(m).loading,variant:"ghost",class:"w-full",size:"2xl"},null,8,["loading"])])):$("",!0),!t(m).loading&&!((d=t(m).data)!=null&&d.length)?(s(),c("div",ed,[e("div",td,h(p.__("No email templates found")),1)])):$("",!0),!t(m).loading&&((y=t(m).data)!=null&&y.length)?(s(),c("div",ld,[((k=t(m).data)==null?void 0:k.length)>10?(s(),c("div",sd,[r(t(lt),{ref:"searchRef",modelValue:n.value,"onUpdate:modelValue":C[1]||(C[1]=w=>n.value=w),placeholder:p.__("Search template"),class:"w-1/3",debounce:300},{prefix:j(()=>[r(t(ae),{name:"search",class:"h-4 w-4 text-ink-gray-6"})]),_:1},8,["modelValue","placeholder"]),r(t(O),{type:"select",modelValue:a.value,"onUpdate:modelValue":C[2]||(C[2]=w=>a.value=w),options:[{label:p.__("All"),value:"All"},{label:p.__("Lead"),value:"CRM Lead"},{label:p.__("Deal"),value:"CRM Deal"}]},null,8,["modelValue","options"])])):$("",!0),e("div",nd,[e("div",ad,h(p.__("Template name")),1),e("div",od,h(p.__("For")),1),e("div",id,h(p.__("Enabled")),1)]),C[6]||(C[6]=e("div",{class:"h-px border-t mx-4 border-outline-gray-modals"},null,-1)),e("ul",rd,[(s(!0),c(B,null,Z(v.value,(w,M)=>(s(),c(B,{key:w.name},[e("li",{class:"flex items-center justify-between p-3 cursor-pointer hover:bg-surface-menu-bar rounded",onClick:()=>i("updateStep","edit-template",{...w})},[e("div",dd,[e("div",cd,h(w.name),1),e("div",md,h(w.subject),1)]),e("div",pd,h(w.reference_doctype.replace("CRM ","")),1),e("div",_d,[r(t(fe),{size:"sm",modelValue:w.enabled,"onUpdate:modelValue":[U=>w.enabled=U,U=>b(w)],onClick:C[3]||(C[3]=re(()=>{},["stop"]))},null,8,["modelValue","onUpdate:modelValue"]),r(t(ce),{class:"",options:_(w),placement:"right",button:{icon:"more-horizontal",variant:"ghost",onblur:U=>{U.stopPropagation(),o.value=!1}},onClick:C[4]||(C[4]=re(()=>{},["stop"]))},null,8,["options","button"])])],8,ud),v.value.length!==M+1?(s(),c("div",fd)):$("",!0)],64))),128)),!t(m).loading&&t(m).hasNextPage?(s(),c("div",gd,[r(f,{class:"mt-3.5 p-2",onClick:C[5]||(C[5]=()=>t(m).next()),loading:t(m).loading,label:p.__("Load More"),"icon-left":"refresh-cw"},null,8,["loading","label"])])):$("",!0)])])):$("",!0)])}}},hd={__name:"EmailTemplatePage",setup(g){const l=D("template-list"),i=D(null),m=je({type:"list",doctype:"Email Template",cache:"emailTemplates",fields:["name","enabled","use_html","reference_doctype","subject","response","response_html","modified","owner"],auto:!0,filters:{reference_doctype:["in",["CRM Lead","CRM Deal"]]},orderBy:"modified desc",pageLength:20});ue("templates",m);function n(a,o){l.value=a,i.value=o}return(a,o)=>l.value==="new-template"?(s(),S(Ru,{key:0,templateData:i.value,onUpdateStep:n},null,8,["templateData"])):l.value==="template-list"?(s(),S(vd,{key:1,onUpdateStep:n})):l.value==="edit-template"?(s(),S(Gu,{key:2,templateData:i.value,onUpdateStep:n},null,8,["templateData"])):$("",!0)}},yd={class:"flex h-full flex-col gap-6 p-8"},bd={class:"flex justify-between"},xd={class:"flex flex-col gap-1 w-9/12"},kd={class:"flex gap-2 text-xl font-semibold leading-none h-5 text-ink-gray-8"},Cd={class:"text-p-base text-ink-gray-6"},wd={class:"flex item-center space-x-2 w-3/12 justify-end"},$d={key:0,class:"flex-1 flex flex-col gap-8 overflow-y-auto"},Sd={key:0,class:"flex flex-col justify-between gap-4"},Vd={class:"text-base font-semibold text-ink-gray-8"},Ld={key:1,class:"flex flex-col justify-between gap-4"},Md={class:"text-base font-semibold text-ink-gray-8"},Dd={key:1,class:"flex flex-1 items-center justify-center"},Rd={__name:"TelephonySettings",setup(g){const{isManager:l,isTelephonyAgent:i}=ge(),m=ee({url:"crm.api.doc.get_fields",cache:["fields","CRM Twilio Settings"],params:{doctype:"CRM Twilio Settings",allow_all_fieldtypes:!0},auto:!0}),n=ee({url:"crm.api.doc.get_fields",cache:["fields","CRM Exotel Settings"],params:{doctype:"CRM Exotel Settings",allow_all_fieldtypes:!0},auto:!0}),a=We({doctype:"CRM Twilio Settings",name:"CRM Twilio Settings",fields:["*"],auto:!0,setValue:{onSuccess:()=>{F.success(__("Twilio settings updated successfully"))},onError:d=>{F.error(d.message+": "+d.messages[0])}}}),o=We({doctype:"CRM Exotel Settings",name:"CRM Exotel Settings",fields:["*"],auto:!0,setValue:{onSuccess:()=>{F.success(__("Exotel settings updated successfully"))},onError:d=>{F.error(d.message+": "+d.messages[0])}}}),v=N(()=>{if(!m.data)return[];let d=[],y=m.data;if(y[0].type!="Tab Break"){let k=[];y[0].type!="Section Break"&&k.push({name:"first_section",columns:[{name:"first_column",fields:[]}]}),d.push({name:"first_tab",sections:k})}return y.forEach(k=>{let w=d[d.length-1],M=d.length?w.sections:[];if(k.fieldtype==="Tab Break")d.push({label:k.label,name:k.fieldname,sections:[{name:"section_"+ve(),columns:[{name:"column_"+ve(),fields:[]}]}]});else if(k.fieldtype==="Section Break")M.push({label:k.label,name:k.fieldname,hideBorder:k.hide_border,columns:[{name:"column_"+ve(),fields:[]}]});else if(k.fieldtype==="Column Break")M[M.length-1].columns.push({name:k.fieldname,fields:[]});else{let U=M[M.length-1];U.columns[U.columns.length-1].fields.push(k)}}),d}),b=N(()=>{if(!n.data)return[];let d=[],y=n.data;if(y[0].type!="Tab Break"){let k=[];y[0].type!="Section Break"&&k.push({name:"first_section",columns:[{name:"first_column",fields:[]}]}),d.push({name:"first_tab",sections:k})}return y.forEach(k=>{let w=d[d.length-1],M=d.length?w.sections:[];if(k.fieldtype==="Tab Break")d.push({label:k.label,name:k.fieldname,sections:[{name:"section_"+ve(),columns:[{name:"column_"+ve(),fields:[]}]}]});else if(k.fieldtype==="Section Break")M.push({label:k.label,name:k.fieldname,hideBorder:k.hide_border,columns:[{name:"column_"+ve(),fields:[]}]});else if(k.fieldtype==="Column Break")M[M.length-1].columns.push({name:k.fieldname,fields:[]});else{let U=M[M.length-1];U.columns[U.columns.length-1].fields.push(k)}}),d}),u=D(!1);pe(ke,()=>{u.value=!0});function _(){f()&&(u.value&&p(),l()&&(a.isDirty&&a.save.submit(),o.isDirty&&o.save.submit()))}async function p(){await he("crm.integrations.api.set_default_calling_medium",{medium:ke.value}),u.value=!1,C.value="",F.success(__("Default calling medium updated successfully"))}const C=D("");function f(){return i()&&!l()?!0:ke.value==="Twilio"&&!a.doc.enabled?(C.value=__("Twilio is not enabled"),!1):ke.value==="Exotel"&&!o.doc.enabled?(C.value=__("Exotel is not enabled"),!1):!0}return(d,y)=>{var w,M;const k=T("Button");return s(),c("div",yd,[e("div",bd,[e("div",xd,[e("h2",kd,[Y(h(d.__("Telephony settings"))+" ",1),t(a).isDirty||t(o).isDirty||u.value?(s(),S(t(Ve),{key:0,label:d.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):$("",!0)]),e("p",Cd,h(d.__("Configure telephony settings for your CRM")),1)]),e("div",wd,[r(k,{loading:t(a).save.loading||t(o).save.loading,label:d.__("Update"),variant:"solid",onClick:_},null,8,["loading","label"])])]),!t(a).get.loading||!t(o).get.loading?(s(),c("div",$d,[r(t(O),{type:"select",modelValue:t(ke),"onUpdate:modelValue":y[0]||(y[0]=U=>st(ke)?ke.value=U:null),label:d.__("Default medium"),options:[{label:d.__(""),value:""},{label:d.__("Twilio"),value:"Twilio"},{label:d.__("Exotel"),value:"Exotel"}],class:"w-1/2",description:d.__("Default calling medium for logged in user")},null,8,["modelValue","label","options","description"]),t(l)()?(s(),c("div",Sd,[e("span",Vd,h(d.__("Twilio")),1),(w=t(a))!=null&&w.doc&&v.value?(s(),S(Xe,{key:0,tabs:v.value,data:t(a).doc,doctype:"CRM Twilio Settings"},null,8,["tabs","data"])):$("",!0)])):$("",!0),t(l)()?(s(),c("div",Ld,[e("span",Md,h(d.__("Exotel")),1),(M=t(o))!=null&&M.doc&&b.value?(s(),S(Xe,{key:0,tabs:b.value,data:t(o).doc,doctype:"CRM Exotel Settings"},null,8,["tabs","data"])):$("",!0)])):$("",!0)])):(s(),c("div",Dd,[r(t(Bt),{class:"size-8"})])),r(t(de),{message:t(a).save.error||t(o).save.error||C.value},null,8,["message"])])}}},Ad={class:"lucide lucide-circle-alert",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function Ud(g,l){return s(),c("svg",Ad,[...l[0]||(l[0]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("line",{x1:"12",x2:"12",y1:"8",y2:"12"},null,-1),e("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"},null,-1)])])}const Nt=H({name:"lucide-circle-alert",render:Ud}),zt="/images/gmail.png",Ot="/images/outlook.png",Pt="/images/sendgrid.png",qt="/images/sparkpost.webp",Ht="/images/yahoo.png",Gt="/images/yandex.png",Zt="/images/frappe-mail.svg",Jt=[{label:__("Account Name"),name:"email_account_name",type:"text",placeholder:__("Support / Sales")},{label:"Email ID",name:"email_id",type:"email",placeholder:"johndoe@example.com"}],Yt=[{label:__("Enable Incoming"),name:"enable_incoming",type:"checkbox",description:__("If enabled, records can be created from the incoming emails on this account.")},{label:__("Enable Outgoing"),name:"enable_outgoing",type:"checkbox",description:__("If enabled, outgoing emails can be sent from this account.")},{label:__("Default Incoming"),name:"default_incoming",type:"checkbox",description:__("If enabled, all replies to your company (eg: replies@yourcomany.com) will come to this account. Note: Only one account can be default incoming.")},{label:__("Default Outgoing"),name:"default_outgoing",type:"checkbox",description:__("If enabled, all outgoing emails will be sent from this account. Note: Only one account can be default outgoing.")}],Wt=[...Jt,{label:__("Password"),name:"password",type:"password",placeholder:"********"}],Kt=[...Jt,{label:"Frappe Mail Site",name:"frappe_mail_site",type:"text",placeholder:"https://frappemail.com"},{label:"API Key",name:"api_key",type:"text",placeholder:"********"},{label:"API Secret",name:"api_secret",type:"password",placeholder:"********"}],Qt=[{name:"GMail",icon:zt,info:__(`Setting up GMail requires you to enable two factor authentication
		  and app specific passwords. Read more`),link:"https://support.google.com/accounts/answer/185833",custom:!1},{name:"Outlook",icon:Ot,info:__(`Setting up Outlook requires you to enable two factor authentication
		  and app specific passwords. Read more`),link:"https://support.microsoft.com/en-us/account-billing/how-to-get-and-use-app-passwords-5896ed9b-4263-e681-128a-a6f2979a7944",custom:!1},{name:"Sendgrid",icon:Pt,info:__(`Setting up Sendgrid requires you to enable two factor authentication
		  and app specific passwords. Read more `),link:"https://sendgrid.com/docs/ui/account-and-settings/two-factor-authentication/",custom:!1},{name:"SparkPost",icon:qt,info:__(`Setting up SparkPost requires you to enable two factor authentication
		  and app specific passwords. Read more `),link:"https://support.sparkpost.com/docs/my-account-and-profile/enabling-two-factor-authentication",custom:!1},{name:"Yahoo",icon:Ht,info:__(`Setting up Yahoo requires you to enable two factor authentication
		  and app specific passwords. Read more `),link:"https://help.yahoo.com/kb/SLN15241.html",custom:!1},{name:"Yandex",icon:Gt,info:__(`Setting up Yandex requires you to enable two factor authentication
		  and app specific passwords. Read more `),link:"https://yandex.com/support/id/authorization/app-passwords.html",custom:!1},{name:"Frappe Mail",icon:Zt,info:__("Setting up Frappe Mail requires you to have an API key and API Secret of your email account. Read more "),link:"https://github.com/frappe/mail",custom:!0}],Xt={GMail:zt,Outlook:Ot,Sendgrid:Pt,SparkPost:qt,Yahoo:Ht,Yandex:Gt,"Frappe Mail":Zt};function el(g,l){if(!g.email_account_name)return __("Account name is required");if(!g.email_id)return __("Email ID is required");if(!at(g.email_id))return __("Invalid email ID");if(!l&&!g.password)return __("Password is required");if(l){if(!g.api_key)return __("API Key is required");if(!g.api_secret)return}return""}const jd=["src"],Ed={key:0,class:"text-xs text-center text-ink-gray-6 mt-2"},it={__name:"EmailProviderIcon",props:{logo:{type:String,required:!0},label:{type:String,default:""},selected:{type:Boolean,default:!1}},setup(g){return(l,i)=>(s(),c(B,null,[e("div",{class:K(["flex items-center justify-center w-8 h-8 bg-surface-gray-2 cursor-pointer rounded-xl hover:bg-surface-gray-3",{"ring-2 ring-outline-gray-4":g.selected}])},[e("img",{src:g.logo,class:"w-4 h-4"},null,8,jd)],2),g.label?(s(),c("p",Ed,h(g.label),1)):$("",!0)],64))}},Id={class:"flex flex-col h-full gap-4"},Td={role:"heading","aria-level":"1",class:"flex flex-col gap-1"},Bd={class:"text-xl font-semibold text-ink-gray-8"},Fd={class:"text-sm text-ink-gray-5"},Nd={class:"flex flex-wrap items-center"},zd=["onClick"],Od={key:0,class:"flex flex-col gap-4"},Pd={class:"flex items-center gap-2 p-2 rounded-md ring-1 ring-outline-gray-3 text-ink-gray-6"},qd={class:"text-xs text-wrap"},Hd=["href"],Gd={class:"flex flex-col gap-4"},Zd={class:"grid grid-cols-1 gap-4"},Jd={class:"grid grid-cols-2 gap-4"},Yd={class:"text-ink-gray-4 text-p-sm"},Wd={key:1,class:"flex justify-between mt-auto"},Kd={__name:"EmailAdd",setup(g,{emit:l}){const i=l,m=nt({service:"",email_account_name:"",email_id:"",password:"",api_key:"",api_secret:"",frappe_mail_site:"",enable_incoming:!1,enable_outgoing:!1,default_incoming:!1,default_outgoing:!1}),n=D(null),a=N(()=>n.value.custom?Kt:Wt);function o(_){n.value=_,m.service=_.name}const v=ee({url:"crm.api.settings.create_email_account",makeParams:_=>({..._}),onSuccess:()=>{F.success(__("Email account created successfully")),i("update:step","email-list")},onError:()=>{b.value=__("Failed to create email account, Invalid credentials")}}),b=D();function u(){b.value=el(m,n.value.custom),!b.value&&v.submit({data:m})}return(_,p)=>{const C=T("FormControl"),f=T("ErrorMessage"),d=T("Button");return s(),c("div",Id,[e("div",Td,[e("h2",Bd,h(_.__("Setup Email")),1),e("p",Fd,h(_.__("Choose the email service provider you want to configure.")),1)]),e("div",Nd,[(s(!0),c(B,null,Z(t(Qt),y=>{var k;return s(),c("div",{key:y.name,class:"flex flex-col items-center gap-1 mt-4 w-[70px]",onClick:w=>o(y)},[r(it,{label:y.name,logo:y.icon,selected:((k=n.value)==null?void 0:k.name)===(y==null?void 0:y.name)},null,8,["label","logo","selected"])],8,zd)}),128))]),n.value?(s(),c("div",Od,[e("div",Pd,[r(t(Nt),{class:"w-5 h-6 w-min-5 w-max-5 min-h-5 max-w-5"}),e("div",qd,[Y(h(n.value.info)+" ",1),e("a",{href:n.value.link,target:"_blank",class:"underline"},h(_.__("here")),9,Hd),p[1]||(p[1]=Y(" . ",-1))])]),e("div",Gd,[e("div",Zd,[(s(!0),c(B,null,Z(a.value,y=>(s(),c("div",{key:y.name,class:"flex flex-col gap-1"},[r(C,{modelValue:m[y.name],"onUpdate:modelValue":k=>m[y.name]=k,label:y.label,name:y.name,type:y.type,placeholder:y.placeholder},null,8,["modelValue","onUpdate:modelValue","label","name","type","placeholder"])]))),128))]),e("div",Jd,[(s(!0),c(B,null,Z(t(Yt),y=>(s(),c("div",{key:y.name,class:"flex flex-col gap-1"},[r(C,{modelValue:m[y.name],"onUpdate:modelValue":k=>m[y.name]=k,label:y.label,name:y.name,type:y.type},null,8,["modelValue","onUpdate:modelValue","label","name","type"]),e("p",Yd,h(y.description),1)]))),128))]),r(f,{class:"ml-1",message:b.value},null,8,["message"])])])):$("",!0),n.value?(s(),c("div",Wd,[r(d,{label:_.__("Back"),variant:"outline",disabled:t(v).loading,onClick:p[0]||(p[0]=y=>i("update:step","email-list"))},null,8,["label","disabled"]),r(d,{label:_.__("Create"),variant:"solid",loading:t(v).loading,onClick:u},null,8,["label","loading"])])):$("",!0)])}}},Qd={class:"flex items-center justify-between px-2 py-3 border-outline-gray-modals cursor-pointer hover:bg-surface-menu-bar rounded"},Xd={class:"flex items-center justify-between gap-2"},ec={class:"text-p-base text-ink-gray-8"},tc={class:"text-p-sm text-ink-gray-5"},lc={__name:"EmailAccountCard",props:{emailAccount:{type:Object,required:!0}},setup(g){const l=g,i=N(()=>l.emailAccount.default_incoming&&l.emailAccount.default_outgoing?__("Default Sending and Inbox"):l.emailAccount.default_incoming?__("Default Inbox"):l.emailAccount.default_outgoing?__("Default Sending"):__("Inbox"));return(m,n)=>{const a=T("Badge");return s(),c("div",Qd,[e("div",Xd,[r(it,{logo:t(Xt)[g.emailAccount.service]},null,8,["logo"]),e("div",null,[e("div",ec,h(g.emailAccount.email_account_name),1),e("div",tc,h(g.emailAccount.email_id),1)])]),e("div",null,[r(a,{variant:"subtle",label:i.value,theme:"gray"},null,8,["label"])])])}}},sc={class:"flex justify-between text-ink-gray-8"},nc={class:"flex flex-col gap-1 w-9/12"},ac={class:"flex gap-2 text-xl font-semibold leading-none h-5"},oc={class:"text-p-base text-ink-gray-6"},ic={class:"flex item-center space-x-2 w-3/12 justify-end"},rc={key:0,class:"mt-4"},uc={key:0,class:"h-px border-t mx-2 border-outline-gray-modals"},dc={key:1,class:"flex items-center justify-center h-64 text-ink-gray-4"},cc={__name:"EmailAccountList",emits:["update:step"],setup(g,{emit:l}){const i=l,m=je({doctype:"Email Account",cache:!0,fields:["*"],filters:{email_id:["Not Like","%example%"]},pageLength:10,auto:!0,onSuccess:n=>{n.forEach(a=>{a.enable_incoming=!!a.enable_incoming,a.enable_outgoing=!!a.enable_outgoing,a.default_incoming=!!a.default_incoming,a.default_outgoing=!!a.default_outgoing})}});return(n,a)=>{var v;const o=T("Button");return s(),c("div",null,[e("div",sc,[e("div",nc,[e("h2",ac,h(n.__("Email accounts")),1),e("p",oc,h(n.__("Manage your email accounts to send and receive emails directly from CRM. You can add multiple accounts and set one as default for incoming and outgoing emails.")),1)]),e("div",ic,[r(o,{label:n.__("Add Account"),theme:"gray",variant:"solid","icon-left":"plus",onClick:a[0]||(a[0]=b=>i("update:step","email-add"))},null,8,["label"])])]),!t(m).loading&&((v=t(m).data)!=null&&v.length)?(s(),c("div",rc,[(s(!0),c(B,null,Z(t(m).data,(b,u)=>(s(),c("div",{key:b.name},[r(lc,{emailAccount:b,onClick:_=>i("update:step","email-edit",b)},null,8,["emailAccount","onClick"]),t(m).data.length!==u+1?(s(),c("div",uc)):$("",!0)]))),128))])):(s(),c("div",dc,h(n.__("Please add an email account to continue.")),1))])}}},mc={class:"flex flex-col h-full gap-4"},pc={role:"heading","aria-level":"1",class:"flex justify-between gap-1"},_c={class:"text-xl font-semibold text-ink-gray-8"},fc={class:"w-fit"},gc={class:"flex items-center gap-2 p-2 rounded-md ring-1 ring-outline-gray-3"},vc={class:"text-xs text-ink-gray-6 text-wrap"},hc=["href"],yc={class:"flex flex-col gap-4"},bc={class:"grid grid-cols-1 gap-4"},xc={class:"grid grid-cols-2 gap-4"},kc={class:"text-ink-gray-4 text-p-sm"},Cc={class:"flex justify-between mt-auto"},wc={__name:"EmailEdit",props:{accountData:null},setup(g,{emit:l}){var k,w,M,U;const i=g,m=l,n=nt({email_account_name:i.accountData.email_account_name||"",service:i.accountData.service||"",email_id:i.accountData.email_id||"",api_key:((k=i.accountData)==null?void 0:k.api_key)||null,api_secret:((w=i.accountData)==null?void 0:w.api_secret)||null,password:((M=i.accountData)==null?void 0:M.password)||null,frappe_mail_site:((U=i.accountData)==null?void 0:U.frappe_mail_site)||"",enable_incoming:i.accountData.enable_incoming||!1,enable_outgoing:i.accountData.enable_outgoing||!1,default_outgoing:i.accountData.default_outgoing||!1,default_incoming:i.accountData.default_incoming||!1}),a={description:__("To know more about setting up email accounts, click"),link:"https://docs.erpnext.com/docs/user/manual/en/email-account"},o=N(()=>Qt.find(I=>I.name===i.accountData.service).custom),v=N(()=>o.value?Kt:Wt),b=D(),u=D(!1);async function _(){if(b.value=el(n,o.value),b.value)return;const I={...i.accountData},z={...n},A=I.email_account_name!==z.email_account_name;delete I.email_account_name,delete z.email_account_name;const x=p.value,R=z;if(!A&&!x){F.info(__("No changes made"));return}if(A)try{u.value=!0,await C(),d()}catch{y()}if(x)try{u.value=!0,await f(R),d()}catch{y()}}const p=N(()=>n.email_id!==i.accountData.email_id||n.api_key!==i.accountData.api_key||n.api_secret!==i.accountData.api_secret||n.password!==i.accountData.password||n.enable_incoming!==i.accountData.enable_incoming||n.enable_outgoing!==i.accountData.enable_outgoing||n.default_outgoing!==i.accountData.default_outgoing||n.default_incoming!==i.accountData.default_incoming||n.frappe_mail_site!==i.accountData.frappe_mail_site);async function C(){return await he("frappe.client.rename_doc",{doctype:"Email Account",old_name:i.accountData.email_account_name,new_name:n.email_account_name})}async function f(I){return(await he("frappe.client.set_value",{doctype:"Email Account",name:n.email_account_name,fieldname:I})).name}function d(){m("update:step","email-list"),F.success(__("Email account updated successfully"))}function y(){u.value=!1,b.value=__("Failed to update email account, Invalid credentials")}return(I,z)=>{const A=T("FormControl"),x=T("ErrorMessage"),R=T("Button");return s(),c("div",mc,[e("div",pc,[e("h2",_c,h(I.__("Edit Email")),1)]),e("div",fc,[r(it,{logo:t(Xt)[g.accountData.service],label:g.accountData.service},null,8,["logo","label"])]),e("div",gc,[r(t(Nt),{class:"size-6 text-ink-gray-4 w-min-5 w-max-5 min-h-5 max-w-5"}),e("div",vc,[Y(h(a.description)+" ",1),e("a",{href:a.link,target:"_blank",class:"underline"},h(I.__("here")),9,hc),z[1]||(z[1]=Y(" . ",-1))])]),e("div",yc,[e("div",bc,[(s(!0),c(B,null,Z(v.value,L=>(s(),c("div",{key:L.name,class:"flex flex-col gap-1"},[r(A,{modelValue:n[L.name],"onUpdate:modelValue":q=>n[L.name]=q,label:L.label,name:L.name,type:L.type,placeholder:L.placeholder},null,8,["modelValue","onUpdate:modelValue","label","name","type","placeholder"])]))),128))]),e("div",xc,[(s(!0),c(B,null,Z(t(Yt),L=>(s(),c("div",{key:L.name,class:"flex flex-col gap-1"},[r(A,{modelValue:n[L.name],"onUpdate:modelValue":q=>n[L.name]=q,label:L.label,name:L.name,type:L.type},null,8,["modelValue","onUpdate:modelValue","label","name","type"]),e("p",kc,h(L.description),1)]))),128))]),b.value?(s(),S(x,{key:0,class:"ml-1",message:b.value},null,8,["message"])):$("",!0)]),e("div",Cc,[r(R,{label:I.__("Back"),theme:"gray",variant:"outline",disabled:u.value,onClick:z[0]||(z[0]=L=>m("update:step","email-list"))},null,8,["label","disabled"]),r(R,{label:I.__("Update Account"),variant:"solid",onClick:_,loading:u.value},null,8,["label","loading"])])])}}},$c={class:"flex-1 p-8"},Sc={key:0,class:"h-full"},Vc={key:1,class:"h-full"},Lc={key:2,class:"h-full"},Mc={__name:"EmailConfig",setup(g){const l=D("email-list"),i=D(null);function m(n,a){l.value=n,i.value=a}return(n,a)=>(s(),c("div",$c,[l.value==="email-add"?(s(),c("div",Sc,[r(Kd,{"onUpdate:step":m})])):l.value==="email-list"?(s(),c("div",Vc,[r(cc,{"onUpdate:step":m})])):l.value==="email-edit"?(s(),c("div",Lc,[r(wc,{"account-data":i.value,"onUpdate:step":m},null,8,["account-data"])])):$("",!0)]))}},Dc={class:"flex p-3 items-center justify-between cursor-pointer hover:bg-surface-menu-bar rounded"},Rc={class:"text-base text-ink-gray-7 font-medium"},Ac={key:0,class:"text-p-base w-full text-ink-gray-5 mt-0.5 whitespace-nowrap overflow-ellipsis overflow-hidden"},Uc={class:"w-3/12"},jc=["value"],Ec={class:"flex justify-between items-center w-2/12"},Ic={class:"flex flex-col gap-4"},Tc={class:"flex gap-2 justify-end"},Bc={__name:"AssignmentRuleListItem",props:{data:{type:Object,required:!0}},setup(g){const l=Q("assignmentRulesList"),i=Q("updateStep"),m=g,n=[{label:"Low",value:"0"},{label:"Low-Medium",value:"1"},{label:"Medium",value:"2"},{label:"Medium-High",value:"3"},{label:"High",value:"4"}],a=D({show:!1,name:""}),o=D(!1),v=()=>{ee({url:"frappe.client.delete",params:{doctype:"Assignment Rule",name:m.data.name},onSuccess:()=>{l.reload(),o.value=!1,F.success(__("Assignment rule deleted"))},auto:!0})},b=[{label:__("Duplicate"),onClick:()=>{a.value={show:!0,name:m.data.name+" (Copy)"}},icon:"copy"},{label:__("Delete"),icon:"trash-2",onClick:f=>{f.preventDefault(),f.stopImmediatePropagation(),o.value=!0},condition:()=>!o.value},{label:__("Confirm Delete"),icon:"trash-2",theme:"red",onClick:()=>v(),condition:()=>o.value}],u=()=>{ee({url:"crm.api.assignment_rule.duplicate_assignment_rule",params:{docname:m.data.name,new_name:a.value.name},onSuccess:f=>{l.reload(),F.success(__("Assignment rule duplicated")),a.value.show=!1,a.value.name="",i("view",f)},auto:!0})},_=()=>{C("priority",m.data.priority)},p=()=>{if(!m.data.users_exists&&m.data.disabled){F.error(__("Cannot enable rule without adding users in it"));return}C("disabled",!m.data.disabled,"status")},C=(f,d,y=void 0)=>{ee({url:"frappe.client.set_value",params:{doctype:"Assignment Rule",name:m.data.name,fieldname:f,value:d},onSuccess:()=>{l.reload(),F.success(__("Assignment rule {0} updated",[y||f]))},auto:!0})};return(f,d)=>(s(),c(B,null,[e("div",Dc,[e("div",{class:"w-7/12",onClick:d[0]||(d[0]=y=>t(i)("view",g.data))},[e("div",Rc,h(g.data.name),1),g.data.description&&g.data.description.length>0?(s(),c("div",Ac,h(g.data.description),1)):$("",!0)]),e("div",Uc,[Ue(e("select",{class:"w-full h-7 text-base hover:bg-surface-gray-3 rounded-md p-0 pl-2 pr-5 bg-transparent -ml-2 border-0 text-ink-gray-8 focus-visible:!ring-0 bg-none truncate","onUpdate:modelValue":d[1]||(d[1]=y=>g.data.priority=y),"on:update:modelValue":_,onChange:_},[(s(),c(B,null,Z(n,y=>e("option",{key:y.value,value:y.value},h(y.label),9,jc)),64))],544),[[ol,g.data.priority]])]),e("div",Ec,[r(t(fe),{size:"sm",modelValue:!g.data.disabled,"onUpdate:modelValue":p},null,8,["modelValue"]),r(t(ce),{placement:"right",options:b},{default:j(()=>[r(t(G),{icon:"more-horizontal",variant:"ghost",onClick:d[2]||(d[2]=y=>o.value=!1)})]),_:1})])]),r(t(Ae),{options:{title:f.__("Duplicate Assignment Rule")},modelValue:a.value.show,"onUpdate:modelValue":d[6]||(d[6]=y=>a.value.show=y)},{"body-content":j(()=>[e("div",Ic,[r(t(O),{label:f.__("New Assignment Rule Name"),type:"text",modelValue:a.value.name,"onUpdate:modelValue":d[3]||(d[3]=y=>a.value.name=y)},null,8,["label","modelValue"])])]),actions:j(()=>[e("div",Tc,[r(t(G),{variant:"subtle",label:f.__("Close"),onClick:d[4]||(d[4]=y=>a.value.show=!1)},null,8,["label"]),r(t(G),{variant:"solid",label:f.__("Duplicate"),onClick:d[5]||(d[5]=y=>u())},null,8,["label"])])]),_:1},8,["options","modelValue"])],64))}},Fc={key:0,class:"flex items-center justify-center mt-12"},Nc={key:1},zc={key:0,class:"flex items-center justify-center rounded-md border border-outline-gray-2 p-4"},Oc={class:"text-sm text-ink-gray-7"},Pc={key:1},qc={class:"flex items-center py-2 px-4 text-sm text-ink-gray-5"},Hc={class:"w-7/12"},Gc={class:"w-3/12"},Zc={class:"w-2/12"},Jc={class:"overflow-y-auto px-2"},Yc={key:0,class:"mx-2"},Wc={__name:"AssignmentRulesList",setup(g){const l=Q("assignmentRulesList");return(i,m)=>{var n;return t(l).loading&&!t(l).data?(s(),c("div",Fc,[r(t(Dt),{class:"w-4"})])):(s(),c("div",Nc,[((n=t(l).data)==null?void 0:n.length)===0?(s(),c("div",zc,[e("div",Oc,h(i.__("No items in the list")),1)])):(s(),c("div",Pc,[e("div",qc,[e("div",Hc,h(i.__("Assignment rule")),1),e("div",Gc,h(i.__("Priority")),1),e("div",Zc,h(i.__("Enabled")),1)]),m[0]||(m[0]=e("div",{class:"h-px border-t mx-4 border-outline-gray-modals"},null,-1)),e("div",Jc,[(s(!0),c(B,null,Z(t(l).data,(a,o)=>(s(),c(B,{key:a.name},[r(Bc,{data:a},null,8,["data"]),t(l).data.length!==o+1?(s(),c("hr",Yc)):$("",!0)],64))),128))])]))]))}}},Kc={class:"flex h-full flex-col gap-6 p-6 text-ink-gray-8"},Qc={class:"flex justify-between px-2 pt-2"},Xc={class:"flex flex-col gap-1 w-9/12"},em={class:"flex gap-2 text-xl font-semibold leading-none h-5"},tm={class:"text-p-base text-ink-gray-6"},lm={class:"flex item-center space-x-2 w-3/12 justify-end"},sm={class:"overflow-y-auto"},nm={__name:"AssignmentRules",setup(g){const l=Q("updateStep"),i=ee({url:"crm.api.assignment_rule.get_assignment_rules_list",cache:["assignmentRules","get_assignment_rules_list"],auto:!0});ue("assignmentRulesList",i);const m=()=>{l("view",null)};return(n,a)=>{const o=T("Button");return s(),c("div",Kc,[e("div",Qc,[e("div",Xc,[e("h2",em,h(n.__("Assignment rules")),1),e("p",tm,h(n.__("Assignment rules automatically assign lead/deal to the right sales user based on predefined conditions")),1)]),e("div",lm,[r(o,{label:n.__("New"),"icon-left":"plus",variant:"solid",onClick:a[0]||(a[0]=v=>m())},null,8,["label"])])]),e("div",sm,[r(Wc)])])}}},am={class:"lucide lucide-group",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function om(g,l){return s(),c("svg",am,[...l[0]||(l[0]=[Mt('<path d="M3 7V5c0-1.1.9-2 2-2h2"></path><path d="M17 3h2c1.1 0 2 .9 2 2v2"></path><path d="M21 17v2c0 1.1-.9 2-2 2h-2"></path><path d="M7 21H5c-1.1 0-2-.9-2-2v-2"></path><rect width="7" height="5" x="7" y="7" rx="1"></rect><rect width="7" height="5" x="10" y="12" rx="1"></rect>',6)])])}const im=H({name:"lucide-group",render:om}),rm={class:"lucide lucide-ungroup",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"};function um(g,l){return s(),c("svg",rm,[...l[0]||(l[0]=[e("rect",{width:"8",height:"6",x:"5",y:"4",rx:"1"},null,-1),e("rect",{width:"8",height:"6",x:"11",y:"14",rx:"1"},null,-1)])])}const dm=H({name:"lucide-ungroup",render:um}),Fe=ee({url:"crm.api.doc.get_filterable_fields",transform:g=>(g=g.filter(l=>!l.fieldname.startsWith("_")).map(l=>({label:l.label,value:l.fieldname,...l})),g)}),cm={class:K("text-end text-base text-gray-600")},mm={key:0,class:"min-w-[66px] text-start"},pm={key:1,class:"min-w-[66px] flex items-start"},_m={key:0,class:"flex items-center gap-2 w-full"},fm={id:"fieldname",class:"w-full"},gm={id:"operator"},vm={id:"value",class:"w-full"},hm={class:K("w-max")},ym={__name:"CFCondition",props:{condition:{type:Array,required:!0},isChild:{type:Boolean,default:!1},itemIndex:{type:Number},level:{type:Number,default:0},isGroup:{type:Boolean,default:!1},conjunction:{type:String},disableAddCondition:{type:Boolean,default:!1}},emits:["remove","unGroupConditions","toggleConjunction","turnIntoGroup"],setup(g,{emit:l}){const i=D(!1),m=l,n=g,a=N(()=>{const x=[];return!n.isGroup&&n.level<4&&x.push({label:__("Turn into a group"),icon:()=>ne(im),onClick:()=>{m("turnIntoGroup")}}),n.isGroup&&x.push({label:__("Ungroup conditions"),icon:()=>ne(dm),onClick:()=>{m("unGroupConditions")}}),x.push({label:__("Remove"),icon:"trash-2",variant:"red",onClick:()=>m("remove"),condition:()=>!n.isGroup}),x.push({label:__("Remove group"),icon:"trash-2",variant:"red",onClick:()=>m("remove"),condition:()=>n.isGroup}),x}),o=["Check"],v=["Link","Dynamic Link"],b=["Float","Int","Currency","Percent"],u=["Select"],_=["Data","Long Text","Small Text","Text Editor","Text"],p=["Date","Datetime"],C=["Rating"];function f(){m("toggleConjunction",n.conjunction)}const d=()=>{y()},y=()=>{n.condition[2]=""};function k(){var E;const[x,R]=n.condition;if(!x)return null;const L=(E=Fe.data)==null?void 0:E.find(J=>J.fieldname==x);if(!L)return null;const{fieldtype:q,options:V}=L;if(R=="is")return ne(O,{type:"select",options:[{label:"Set",value:"set"},{label:"Not Set",value:"not set"}]});if(["like","not like","in","not in"].includes(R))return ne(O,{type:"text"});if(u.includes(q)||o.includes(q)){const J=q=="Check"?["Yes","No"]:M(V);return ne(O,{type:"select",options:J.map(P=>({label:P,value:P}))})}else return v.includes(q)?q=="Dynamic Link"?ne(O,{type:"text"}):ne(Ne,{class:"form-control",doctype:V,value:n.condition[2]}):b.includes(q)?ne(O,{type:"number"}):p.includes(q)&&R=="between"?ne(Ol,{value:n.condition[2],iconLeft:""}):p.includes(q)?ne(q=="Date"?El:Il,{value:n.condition[2],iconLeft:""}):C.includes(q)?ne(Ql,{modelValue:n.condition[2]||0,class:"truncate","update:modelValue":J=>w(J)}):ne(O,{type:"text"})}function w(x){x=x.target?x.target.value:x,n.condition[1]==="between"?n.condition[2]=[x.split(",")[0],x.split(",")[1]]:n.condition[2]=x+""}function M(x){return x.split(`
`)}function U(x){let R=x.target._value,L=x.target.value;n.condition[1]=x.target.value,A(R,L)||(n.condition[2]=z(n.condition[0])),y()}function I(){var J;let x=[];const R=n.condition[0];if(!R)return x;const L=(J=Fe.data)==null?void 0:J.find(P=>P.fieldname==R);if(!L)return x;const{fieldtype:q,fieldname:V}=L;_.includes(q)&&x.push({label:"Equals",value:"=="},{label:"Not Equals",value:"!="},{label:"Like",value:"like"},{label:"Not Like",value:"not like"},{label:"In",value:"in"},{label:"Not In",value:"not in"},{label:"Is",value:"is"}),V==="_assign"&&(x=[{label:"Like",value:"like"},{label:"Not Like",value:"not like"},{label:"Is",value:"is"}]),b.includes(q)&&x.push({label:"Equals",value:"=="},{label:"Not Equals",value:"!="},{label:"Like",value:"like"},{label:"Not Like",value:"not like"},{label:"In",value:"in"},{label:"Not In",value:"not in"},{label:"Is",value:"is"},{label:"<",value:"<"},{label:">",value:">"},{label:"<=",value:"<="},{label:">=",value:">="}),u.includes(q)&&x.push({label:"Equals",value:"=="},{label:"Not Equals",value:"!="},{label:"In",value:"in"},{label:"Not In",value:"not in"},{label:"Is",value:"is"}),v.includes(q)&&x.push({label:"Equals",value:"=="},{label:"Not Equals",value:"!="},{label:"Like",value:"like"},{label:"Not Like",value:"not like"},{label:"In",value:"in"},{label:"Not In",value:"not in"},{label:"Is",value:"is"}),o.includes(q)&&x.push({label:"Equals",value:"=="}),["Duration"].includes(q)&&x.push({label:"Like",value:"like"},{label:"Not Like",value:"not like"},{label:"In",value:"in"},{label:"Not In",value:"not in"},{label:"Is",value:"is"}),p.includes(q)&&x.push({label:"Equals",value:"=="},{label:"Not Equals",value:"!="},{label:"Is",value:"is"},{label:">",value:">"},{label:"<",value:"<"},{label:">=",value:">="},{label:"<=",value:"<="},{label:"Between",value:"between"}),C.includes(q)&&x.push({label:"Equals",value:"=="},{label:"Not Equals",value:"!="},{label:"Is",value:"is"},{label:">",value:">"},{label:"<",value:"<"},{label:">=",value:">="},{label:"<=",value:"<="});const E=x.find(P=>P.value==n.condition[1]);return n.condition[1]=(E==null?void 0:E.value)||x[0].value,x}function z(x){return u.includes(x.fieldtype)?M(x.options)[0]:o.includes(x.fieldtype)?"Yes":p.includes(x.fieldtype)?null:C.includes(x.fieldtype)?0:""}function A(x,R){let L=["==","!=","in","not in",">","<",">=","<="];return!!(L.includes(x)&&L.includes(R))}return(x,R)=>(s(),c(B,null,[e("div",{class:K(["flex gap-2",[{"items-center":!n.isGroup}]])},[e("div",{class:K(["flex gap-2 w-full",[{"items-center justify-between":!n.isGroup}]])},[e("div",cm,[n.itemIndex==0?(s(),c("div",mm,h(x.__("Where")),1)):(s(),c("div",pm,[r(t(G),{variant:"subtle",class:"w-max",onClick:f,"icon-right":"refresh-cw",disabled:n.itemIndex>2,label:g.conjunction},null,8,["disabled","label"])]))]),n.isGroup?$("",!0):(s(),c("div",_m,[e("div",fm,[r(t(il),{options:t(Fe).data,modelValue:n.condition[0],"onUpdate:modelValue":[R[0]||(R[0]=L=>n.condition[0]=L),d],placeholder:x.__("Field")},null,8,["options","modelValue","placeholder"])]),e("div",gm,[n.condition[0]?(s(),S(t(O),{key:1,disabled:!n.condition[0],type:"select",modelValue:n.condition[1],"onUpdate:modelValue":R[1]||(R[1]=L=>n.condition[1]=L),onChange:U,options:I(),class:"w-max min-w-[100px]"},null,8,["disabled","modelValue","options"])):(s(),S(t(O),{key:0,disabled:"",type:"text",placeholder:x.__("operator"),class:"w-[100px]"},null,8,["placeholder"]))]),e("div",vm,[n.condition[0]?(s(),S(_e(k()),{key:1,modelValue:n.condition[2],"onUpdate:modelValue":R[2]||(R[2]=L=>n.condition[2]=L),onChange:w,placeholder:x.__("condition")},null,40,["modelValue","placeholder"])):(s(),S(t(O),{key:0,disabled:"",type:"text",placeholder:x.__("condition"),class:"w-full"},null,8,["placeholder"]))])])),n.isGroup&&!(n.level==2||n.level==4)?(s(),S(et,{key:1,conditions:n.condition,isChild:!0,level:n.level,disableAddCondition:n.disableAddCondition},null,8,["conditions","level","disableAddCondition"])):$("",!0),n.isGroup&&(n.level==2||n.level==4)?(s(),S(t(G),{key:2,variant:"outline",onClick:R[3]||(R[3]=L=>i.value=!0),label:x.__("Open nested conditions")},null,8,["label"])):$("",!0)],2),e("div",hm,[r(t(ce),{placement:"right",options:a.value},{default:j(()=>[r(t(G),{variant:"ghost",icon:"more-horizontal"})]),_:1},8,["options"])])],2),r(t(Ae),{modelValue:i.value,"onUpdate:modelValue":R[4]||(R[4]=L=>i.value=L),options:{size:"3xl",title:x.__("Nested conditions")}},{"body-content":j(()=>[r(et,{conditions:n.condition,isChild:!0,level:n.level,disableAddCondition:n.disableAddCondition},null,8,["conditions","level","disableAddCondition"])]),_:1},8,["modelValue","options"])],64))}},bm={class:"rounded-lg border border-outline-gray-2 p-3 flex flex-col gap-4 w-full"},xm={key:0,class:"flex"},et={__name:"CFConditions",props:{conditions:{type:Array,required:!0},isChild:{type:Boolean,default:!1},level:{type:Number,default:0},disableAddCondition:{type:Boolean,default:!1},doctype:{type:String,required:!0}},setup(g){const l=g,i=()=>{let u="and";return l.conditions.forEach(_=>{typeof _=="string"&&(u=_)}),u},m=u=>{l.conditions.splice(l.conditions.indexOf(u),1,[u])},n=u=>Array.isArray(u),a=N(()=>{const u=[{label:__("Add condition"),onClick:()=>{const _=i();l.conditions.push(_,["","",""])}}];return l.level<3&&u.push({label:__("Add condition group"),onClick:()=>{const _=i();l.conditions.push(_,[[]])}}),u});function o(u){const _=l.conditions.indexOf(u);_==0?l.conditions.splice(_,2):l.conditions.splice(_-1,2)}function v(u){const _=i(),p=u.map(f=>typeof f=="string"?_:f),C=l.conditions.indexOf(u);C!==-1&&l.conditions.splice(C,1,...p)}function b(u){for(let _=0;_<l.conditions.length;_++)typeof l.conditions[_]=="string"&&(l.conditions[_]=u=="and"?"or":"and")}return pe(()=>l.doctype,u=>{Fe.submit({doctype:u})},{immediate:!0}),(u,_)=>(s(),c("div",bm,[(s(!0),c(B,null,Z(l.conditions,(p,C)=>(s(),c(B,{key:p.field},[Array.isArray(p)?(s(),S(ym,{key:0,condition:p,isChild:l.isChild,itemIndex:C,onRemove:f=>o(p),onUnGroupConditions:f=>v(p),level:l.level+1,onToggleConjunction:b,isGroup:n(p[0]),conjunction:i(),onTurnIntoGroup:f=>m(p),disableAddCondition:l.disableAddCondition},null,8,["condition","isChild","itemIndex","onRemove","onUnGroupConditions","level","isGroup","conjunction","onTurnIntoGroup","disableAddCondition"])):$("",!0)],64))),128)),l.isChild?(s(),c("div",xm,[r(t(ce),{options:a.value},{default:j(({open:p})=>[r(t(G),{disabled:l.disableAddCondition,label:u.__("Add condition"),"icon-left":"plus","icon-right":p?"chevron-up":"chevron-down"},null,8,["disabled","label","icon-right"])]),_:1},8,["options"])])):$("",!0)]))}},km={class:"flex items-center justify-between mt-2"},Cm={key:0,class:""},Ct={__name:"AssignmentRulesSection",props:{conditions:Array,name:String,errors:String,doctype:String},setup(g){const l=g,i=Q("validateAssignmentRule"),m=()=>{let o="and";return l.conditions.forEach(v=>{typeof v=="string"&&(o=v)}),o},n=[{label:__("Add condition"),onClick:()=>{a()}},{label:__("Add condition group"),onClick:()=>{const o=m();l.conditions.push(o,[[]])}}],a=()=>{if(!Qe(l.conditions))return;const v=m();l.conditions.push(v,["","",""])};return rl(()=>[...l.conditions],()=>{i(l.name)},{deep:!0,debounce:300}),(o,v)=>(s(),c(B,null,[l.conditions.length>0?(s(),S(et,{key:0,conditions:l.conditions,level:0,disableAddCondition:l.errors!=="",doctype:l.doctype},null,8,["conditions","disableAddCondition","doctype"])):$("",!0),l.conditions.length==0?(s(),c("div",{key:1,class:"flex p-4 items-center cursor-pointer justify-center gap-2 text-sm border border-outline-gray-2 text-gray-600 rounded-md",onClick:v[0]||(v[0]=()=>{l.conditions.push(["","",""]),t(i)(l.name)})},[r(t(ae),{name:"plus",class:"h-4"}),Y(" "+h(o.__("Add a condition")),1)])):$("",!0),e("div",km,[l.conditions.length>0?(s(),c("div",Cm,[r(t(ce),{options:n},{default:j(({open:b})=>[r(t(G),{disabled:l.errors!=="","icon-right":b?"chevron-up":"chevron-down",label:o.__("Add condition")},null,8,["disabled","icon-right","label"])]),_:1})])):$("",!0),l.conditions.length>0?(s(),S(t(de),{key:1,message:l.errors},null,8,["message"])):$("",!0)])],64))}},wm={class:"grid py-3.5 px-4 items-center",style:{"grid-template-columns":"3fr 1fr"}},$m={class:"text-ink-gray-7 font-medium"},Sm={class:"flex justify-start"},Vm={key:0},Lm={__name:"AssignmentScheduleItem",props:{data:{type:Object,required:!0},isLast:{type:Boolean,default:!1}},setup(g){const l=Q("assignmentRuleData"),i=g,m=n=>{const a=l.value.assignmentDays.findIndex(o=>o===i.data.day);n&&a===-1?l.value.assignmentDays.push(i.data.day):l.value.assignmentDays.splice(a,1)};return(n,a)=>(s(),c(B,null,[e("div",wm,[e("div",$m,h(n.__(g.data.day)),1),e("div",Sm,[r(t(fe),{modelValue:g.data.active,"onUpdate:modelValue":[a[0]||(a[0]=o=>g.data.active=o),m]},null,8,["modelValue"])])]),g.isLast?$("",!0):(s(),c("hr",Vm))],64))}},Mm={class:"rounded-md border px-2 border-outline-gray-2 text-sm"},Dm={class:"grid p-2 px-4 items-center",style:{"grid-template-columns":"3fr 1fr"}},Rm={__name:"AssignmentSchedule",setup(g){const l=Q("assignmentRuleData"),i=Q("assignmentRuleErrors"),m=[{label:"Days",key:"day"},{label:"Active",key:"active"}],n=D([{day:"Monday",active:!1},{day:"Tuesday",active:!1},{day:"Wednesday",active:!1},{day:"Thursday",active:!1},{day:"Friday",active:!1},{day:"Saturday",active:!1},{day:"Sunday",active:!1}]);return me(()=>{l.value.assignmentDays.forEach(a=>{const o=n.value.find(v=>v.day===a);o&&(o.active=!0)})}),(a,o)=>(s(),c(B,null,[e("div",Mm,[e("div",Dm,[(s(),c(B,null,Z(m,v=>e("div",{key:v.key,class:"text-gray-600 overflow-hidden whitespace-nowrap text-ellipsis"},h(a.__(v.label)),1)),64))]),o[0]||(o[0]=e("hr",null,null,-1)),(s(!0),c(B,null,Z(n.value,(v,b)=>(s(),S(Lm,{key:v.day,data:v,isLast:b===n.value.length-1},null,8,["data","isLast"]))),128))]),r(t(de),{message:t(i).assignmentDays,class:"mt-2"},null,8,["message"])],64))}},Am={class:"mt-1 rounded-lg bg-white py-1 text-base shadow-2xl w-60"},Um={class:"relative px-1.5 pt-0.5"},jm={class:"flex gap-2 items-center w-full select-none"},Em={class:"flex flex-col gap-1"},Im={class:"font-semibold text-ink-gray-7"},Tm={class:"text-ink-gray-6"},Bm={key:0,class:"mt-1.5 rounded-md p-1.5 text-base text-gray-600"},Fm={class:"border-t p-1.5 pb-0.5 *:w-full"},Nm={__name:"AssigneeSearch",emits:["addAssignee"],setup(g,{emit:l}){const i=l,m=D(""),{users:n}=ge(),{$dialog:a}=qe(),o=Q("assignmentRuleData"),v=ul(p=>{m.value=p},300),b=N(()=>{var C,f;return(((f=(C=n.data)==null?void 0:C.crmUsers)==null?void 0:f.filter(d=>d.name!=="Administrator"))||[]).filter(d=>{var y,k;return((y=d.name)==null?void 0:y.includes(m.value))||((k=d.full_name)==null?void 0:k.includes(m.value))}).filter(d=>!o.value.users.some(y=>y.user===d.email))}),u=p=>{o.value.users.some(f=>f.user===p.user)||(o.value.users.push({full_name:p.full_name,email:p.email,user_image:p.user_image,user:p.email}),i("addAssignee",p))},_=()=>{a({title:__("Invite agent"),message:__("You will be redirected to invite user page, unsaved changes will be lost."),variant:"solid",actions:[{label:__("Go to invite page"),variant:"solid",onClick:p=>{$e.value="Invite User",p()}}]})};return(p,C)=>{const f=T("Button"),d=T("FeatherIcon");return s(),S(t(Lt),{multiple:!0},{default:j(()=>[r(t(De),{placement:"bottom-end"},{target:j(({togglePopover:y})=>[r(f,{variant:"subtle","icon-left":"plus",onClick:k=>y(),label:p.__("Add Assignee")},null,8,["onClick","label"])]),body:j(({togglePopover:y})=>[e("div",Am,[e("div",Um,[r(t($t),{ref:"search",class:"form-input w-full",type:"text",onChange:C[0]||(C[0]=k=>t(v)(k.target.value)),value:m.value,autocomplete:"off",placeholder:p.__("Search")},null,8,["value","placeholder"]),e("button",{class:"absolute right-1.5 inline-flex h-7 w-7 items-center justify-center",onClick:C[1]||(C[1]=k=>m.value="")},[r(d,{name:"x",class:"w-4"})])]),r(t(St),{class:"my-2 max-h-64 overflow-y-auto px-1.5",static:""},{default:j(()=>[(s(!0),c(B,null,Z(b.value,k=>Ue((s(),S(t(Vt),{key:k.username,value:k,as:"template",onClick:w=>{w.stopPropagation(),u(k)}},{default:j(({active:w})=>[e("li",{class:K(["flex items-center rounded p-1.5 w-full text-base",{"bg-gray-100":w}])},[e("div",jm,[r(t(Ee),{shape:"circle",image:k.user_image,label:k.full_name,size:"lg"},null,8,["image","label"]),e("div",Em,[e("div",Im,h(k.full_name),1),e("div",Tm,h(k.email),1)])])],2)]),_:2},1032,["value","onClick"])),[[Pe,b.value.length>0]])),128)),b.value.length==0?(s(),c("li",Bm,h(p.__("No results found")),1)):$("",!0)]),_:1}),e("div",Fm,[r(f,{variant:"ghost","icon-left":"plus",class:"w-full",label:p.__("Invite agent"),onClick:()=>{_(),y()}},null,8,["label","onClick"])])])]),_:1})]),_:1})}}},zm={class:"flex flex-col gap-1"},Om={class:"text-lg font-semibold text-ink-gray-8"},Pm={class:"text-p-sm text-ink-gray-6"},qm={class:"mt-8 flex items-center justify-between gap-2"},Hm={class:"text-base font-medium text-ink-gray-8"},Gm={class:"text-p-sm text-ink-gray-6 mt-1"},Zm=["onClick"],Jm={class:"p-1 text-ink-gray-7 mt-1 w-48 bg-white shadow-xl rounded"},Ym=["onClick"],Wm={class:"mt-7 flex items-center justify-between gap-2"},Km={class:"text-base font-medium text-ink-gray-8"},Qm={class:"text-p-sm text-ink-gray-6 mt-1"},Xm={class:"mt-4 flex flex-wrap gap-2"},ep={class:"text-ink-gray-7"},tp={class:"text-xs rounded-full select-none bg-blue-600 text-white p-0.5 px-2"},lp={__name:"AssigneeRules",setup(g){const{getUser:l}=ge(),i=Q("assignmentRuleData"),m=Q("assignmentRuleErrors"),n=Q("validateAssignmentRule"),a=N(()=>i.value.documentType=="CRM Lead"?__("leads"):__("deals")),o=[{label:"Auto-rotate",value:"Round Robin"},{label:"Assign by workload",value:"Load Balancing"}],v=u=>{i.value.users=i.value.users.filter(_=>_.user!==u.name),n("users")},b=N(()=>{const u=[];return i.value.users.forEach(_=>{u.push(l(_.user))}),u});return(u,_)=>{const p=T("FeatherIcon");return s(),c("div",null,[e("div",zm,[e("span",Om,h(u.__("Assignee Rules")),1),e("span",Pm,h(u.__("Choose how {0} are assigned among salespeople.",[a.value])),1)]),e("div",qm,[e("div",null,[e("div",Hm,h(u.__("{0} Routing",[t(i).documentType=="CRM Lead"?u.__("Lead"):u.__("Deal")])),1),e("div",Gm,h(u.__("Choose how {0} are assigned among the selected assignees.",[a.value])),1)]),e("div",null,[r(t(De),{placement:"bottom-end"},{target:j(({togglePopover:C})=>{var f;return[e("div",{class:"flex items-center justify-between text-base rounded h-7 py-1.5 pl-2 pr-2 border border-outline-gray-2 bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full dark:[color-scheme:dark] select-none min-w-40",onClick:d=>C()},[e("div",null,h((f=o.find(d=>d.value==t(i).rule))==null?void 0:f.label),1),r(p,{name:"chevron-down",class:"size-4"})],8,Zm)]}),body:j(({togglePopover:C})=>[e("div",Jm,[(s(),c(B,null,Z(o,f=>e("div",{key:f.value,class:"p-2 cursor-pointer hover:bg-gray-50 text-sm flex items-center justify-between rounded",onClick:()=>{t(i).rule=f.value,C()}},[e("span",null,h(f.label),1),t(i).rule==f.value?(s(),S(p,{key:0,name:"check",class:"size-4"})):$("",!0)],8,Ym)),64))])]),_:1})])]),e("div",Wm,[e("div",null,[e("div",Km,h(u.__("Assignees")),1),e("div",Qm,h(u.__("Select the assignees for {0}.",[a.value])),1)]),r(Nm,{onAddAssignee:_[0]||(_[0]=C=>t(n)("users"))})]),e("div",Xm,[(s(!0),c(B,null,Z(b.value,C=>(s(),c("div",{key:C.name,class:"flex items-center gap-2 text-sm bg-surface-gray-2 rounded-md p-1 w-max px-2 select-none"},[r(t(Ee),{image:C.user_image,label:C.full_name,size:"sm"},null,8,["image","label"]),e("div",ep,h(C.full_name),1),C.email==t(i).lastUser?(s(),S(t(tt),{key:0,text:u.__("Last user assigned by this rule"),"hover-delay":.35,placement:"top"},{default:j(()=>[e("div",tp,h(u.__("Last")),1)]),_:1},8,["text"])):$("",!0),r(t(G),{variant:"ghost",icon:"x",onClick:f=>v(C)},null,8,["onClick"])]))),128))]),r(t(de),{message:t(m).users},null,8,["message"])])}}},sp={key:0,class:"flex flex-col h-full gap-6 px-6 py-8 text-ink-gray-8"},np={class:"flex items-center justify-between px-2 w-full"},ap={class:"flex items-center gap-2"},op={class:"flex items-center gap-4"},ip={class:"text-sm text-ink-gray-7"},rp={class:"overflow-y-auto px-2"},up={class:"grid grid-cols-2 gap-5"},dp={class:"flex flex-col gap-1.5"},cp=["onClick"],mp={class:"p-1 text-ink-gray-6 top-1 absolute bg-white shadow-2xl rounded w-[--reka-popper-anchor-width]"},pp=["onClick"],_p={class:"flex flex-col gap-1.5"},fp={class:"flex flex-col gap-1"},gp={class:"text-lg font-semibold text-ink-gray-8"},vp={class:"flex items-center justify-between gap-6"},hp={class:"text-p-sm text-ink-gray-6"},yp={class:"font-medium underline",href:"https://docs.frappe.io/crm/assignment-rule",target:"_blank"},bp={key:0},xp={class:"text-sm text-ink-gray-6 flex gap-1 cursor-default text-nowrap items-center"},kp={class:"text-sm text-ink-gray-6 p-2 bg-white rounded-md max-w-96 text-wrap whitespace-pre-wrap leading-5"},Cp={class:"mt-5"},wp={key:0,class:"flex flex-col gap-3 items-center text-center text-ink-gray-7 text-sm mb-2 border border-outline-gray-2 rounded-md p-3 py-4"},$p={class:"text-p-sm"},Sp={class:"flex justify-end"},Vp={class:"flex flex-col gap-1"},Lp={class:"text-lg font-semibold text-ink-gray-8"},Mp={class:"flex items-center justify-between gap-6"},Dp={class:"text-p-sm text-ink-gray-6"},Rp={class:"font-medium underline",href:"https://docs.frappe.io/crm/assignment-rule",target:"_blank"},Ap={key:0},Up={class:"text-sm text-ink-gray-6 flex gap-1 cursor-default text-nowrap items-center"},jp={class:"text-sm text-ink-gray-6 p-2 bg-white rounded-md max-w-96 text-wrap whitespace-pre-wrap leading-5"},Ep={class:"mt-5"},Ip={key:0,class:"flex flex-col gap-3 items-center text-center text-ink-gray-7 text-sm mb-2 border border-outline-gray-2 rounded-md p-3 py-4"},Tp={class:"text-p-sm"},Bp={class:"flex flex-col gap-1"},Fp={class:"text-lg font-semibold text-ink-gray-8"},Np={class:"text-p-sm text-ink-gray-6"},zp={class:"mt-6"},Op={key:1,class:"flex items-center h-full justify-center"},Pp={__name:"AssignmentRuleView",setup(g){var L,q;const l=D(!1),i=D(null),m=D(!1),n=Q("updateStep"),a=Q("step"),{$dialog:o}=qe(),v=D({show:!1,title:"",message:"",onConfirm:()=>{}}),b=D(!0),u=D(!1),_=N(()=>f.value.documentType=="CRM Lead"?__("leads"):__("deals")),p=`${window.location.origin}/app/assignment-rule/${(L=a.value.data)==null?void 0:L.name}`,C=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=D({assignCondition:"",unassignCondition:"",assignConditionJson:[],unassignConditionJson:[],rule:"Round Robin",priority:1,users:[],disabled:!1,description:"",name:"",assignmentRuleName:"",assignmentDays:C,documentType:"CRM Lead"}),d=(V,E=!1)=>{const J=P=>{var te,se,ye,W,rt,ut;if(!(V&&P!==V))switch(P){case"assignmentRuleName":((te=f.value.assignmentRuleName)==null?void 0:te.length)==0?k.value.assignmentRuleName=__("Name is required"):k.value.assignmentRuleName="";break;case"description":k.value.description=((se=f.value.description)==null?void 0:se.length)>0?"":__("Description is required");break;case"assignCondition":if(E)break;k.value.assignCondition=((ye=f.value.assignConditionJson)==null?void 0:ye.length)>0?"":__("Assign condition is required"),Qe(f.value.assignConditionJson)?k.value.assignConditionError="":k.value.assignConditionError=__("Assign conditions are invalid");break;case"unassignCondition":if(E)break;((W=f.value.unassignConditionJson)==null?void 0:W.length)>0&&!Qe(f.value.unassignConditionJson)?k.value.unassignConditionError=__("Unassign conditions are invalid"):k.value.unassignConditionError="";break;case"users":k.value.users=((rt=f.value.users)==null?void 0:rt.length)>0?"":__("Users are required");break;case"assignmentDays":k.value.assignmentDays=((ut=f.value.assignmentDays)==null?void 0:ut.length)>0?"":__("Assignment days are required");break}};return V?J(V):Object.keys(k.value).forEach(J),k.value},y=()=>{f.value={assignCondition:"",unassignCondition:"",assignConditionJson:[],unassignConditionJson:[],rule:"Round Robin",priority:1,users:[],disabled:!1,description:"",name:"",assignmentRuleName:"",assignmentDays:C,documentType:"CRM Lead"}},k=D({assignmentRuleName:"",assignCondition:"",assignConditionError:"",unassignConditionError:"",users:"",description:"",assignmentDays:""}),w=()=>{Object.keys(k.value).forEach(V=>{k.value[V]=""})};ue("assignmentRuleData",f),ue("assignmentRuleErrors",k),ue("validateAssignmentRule",d),ue("resetAssignmentRuleData",y),ue("resetAssignmentRuleErrors",w);const M=ee({url:"frappe.client.get",params:{doctype:"Assignment Rule",name:(q=a.value.data)==null?void 0:q.name},auto:!!a.value.data,onSuccess(V){var P,te;f.value={assignCondition:V.assign_condition,unassignCondition:V.unassign_condition,assignConditionJson:JSON.parse(V.assign_condition_json||"[]"),unassignConditionJson:JSON.parse(V.unassign_condition_json||"[]"),rule:V.rule,priority:V.priority,users:V.users,disabled:V.disabled,description:V.description,name:V.name,assignmentRuleName:V.name,assignmentDays:V.assignment_days.map(se=>se.day),documentType:V.document_type},i.value=JSON.stringify(f.value);const E=((P=f.value.assignCondition)==null?void 0:P.length)>0,J=((te=f.value.assignConditionJson)==null?void 0:te.length)>0;E&&!J?(b.value=!1,u.value=!0):(b.value=!0,u.value=!1)}});a.value.data||(i.value=JSON.stringify(f.value));const U=()=>{if(l.value&&!v.value.show){o({title:__("Unsaved changes"),message:__("Are you sure you want to go back? Unsaved changes will be lost."),variant:"solid",actions:[{label:__("Go back"),variant:"solid",onClick:V=>{n("list",null),V()}}]});return}n("list",null),v.value.show=!1},I=()=>{const V=d(void 0,!b.value);if(Object.values(V).some(E=>E)){F.error(__("Invalid fields, check if all are filled in and values are correct."));return}if(a.value.data){if(u.value&&b.value){v.value={show:!0,title:__("Confirm overwrite"),message:__("Your old condition will be overwritten. Are you sure you want to save?"),onConfirm:()=>{x(),v.value.show=!1}};return}x()}else z()},z=()=>{m.value=!0,ee({url:"frappe.client.insert",params:{doc:{doctype:"Assignment Rule",document_type:f.value.documentType,rule:f.value.rule,priority:f.value.priority,users:f.value.users,disabled:f.value.disabled,description:f.value.description,assignment_days:f.value.assignmentDays.map(V=>({day:V})),name:f.value.assignmentRuleName,assignment_rule_name:f.value.assignmentRuleName,assign_condition:Te({conditions:f.value.assignConditionJson}),unassign_condition:Te({conditions:f.value.unassignConditionJson}),assign_condition_json:JSON.stringify(f.value.assignConditionJson),unassign_condition_json:JSON.stringify(f.value.unassignConditionJson)}},auto:!0,onSuccess(V){M.submit({doctype:"Assignment Rule",name:V.name}).then(()=>{m.value=!1,F.success(__("Assignment rule created"))}),n("view",V)},onError:()=>{m.value=!1}})},A=[{label:"Low",value:"0"},{label:"Low-Medium",value:"1"},{label:"Medium",value:"2"},{label:"Medium-High",value:"3"},{label:"High",value:"4"}],x=async()=>{m.value=!0,await he("frappe.client.set_value",{doctype:"Assignment Rule",name:f.value.name,fieldname:{rule:f.value.rule,priority:f.value.priority,users:f.value.users,disabled:f.value.disabled,description:f.value.description,document_type:f.value.documentType,assignment_days:f.value.assignmentDays.map(V=>({day:V})),assign_condition:b.value?Te({conditions:f.value.assignConditionJson}):f.value.assignCondition,unassign_condition:b.value?Te({conditions:f.value.unassignConditionJson}):f.value.unassignCondition,assign_condition_json:b.value?JSON.stringify(f.value.assignConditionJson):null,unassign_condition_json:b.value?JSON.stringify(f.value.unassignConditionJson):null}}).catch(V=>{var J;const E=((J=V==null?void 0:V.messages)==null?void 0:J[0])||__("Some error occurred while updating assignment rule");F.error(E),m.value=!1}),f.value.name!==f.value.assignmentRuleName?(await he("frappe.client.rename_doc",{doctype:"Assignment Rule",old_name:f.value.name,new_name:f.value.assignmentRuleName}).catch(async V=>{var J;const E=((J=V==null?void 0:V.messages)==null?void 0:J[0])||__("Some error occurred while renaming assignment rule");F.error(E),await M.reload(),m.value=!1}),await M.submit({doctype:"Assignment Rule",name:f.value.assignmentRuleName})):M.reload(),m.value=!1,F.success(__("Assignment rule updated"))};pe(f,V=>{i.value&&(l.value=JSON.stringify(V)!=i.value,l.value?Be.value=!0:Be.value=!1)},{deep:!0});const R=V=>{l.value&&(V.preventDefault(),V.returnValue=!0)};return me(()=>{addEventListener("beforeunload",R)}),dl(()=>{w(),y(),removeEventListener("beforeunload",R),Be.value=!1}),(V,E)=>{const J=T("FeatherIcon");return s(),c(B,null,[t(M).loading?(s(),c("div",Op,[r(t(Dt),{class:"w-4"})])):(s(),c("div",sp,[e("div",np,[e("div",ap,[r(t(G),{variant:"ghost","icon-left":"chevron-left",label:f.value.assignmentRuleName||V.__("New Assignment Rule"),size:"md",onClick:E[0]||(E[0]=P=>U()),class:"cursor-pointer -ml-4 hover:bg-transparent focus:bg-transparent focus:outline-none focus:ring-0 focus:ring-offset-0 focus-visible:none active:bg-transparent active:outline-none active:ring-0 active:ring-offset-0 active:text-ink-gray-5 font-semibold text-xl hover:opacity-70 !pr-0 !max-w-96 !justify-start"},null,8,["label"]),l.value?(s(),S(t(Ve),{key:0,variant:"subtle",theme:"orange",size:"sm",label:V.__("Unsaved")},null,8,["label"])):$("",!0)]),e("div",op,[e("div",{class:"flex items-center justify-between gap-2",onClick:E[1]||(E[1]=P=>f.value.disabled=!f.value.disabled)},[r(t(fe),{size:"sm","model-value":!f.value.disabled},null,8,["model-value"]),e("span",ip,h(V.__("Enabled")),1)]),r(t(G),{disabled:!!(!l.value&&t(a).data),label:V.__("Save"),theme:"gray",variant:"solid",onClick:E[2]||(E[2]=P=>I()),loading:m.value||t(M).loading},null,8,["disabled","label","loading"])])]),e("div",rp,[e("div",up,[e("div",null,[r(t(O),{type:"text",size:"sm",variant:"subtle",placeholder:V.__("Name"),label:V.__("Name"),modelValue:f.value.assignmentRuleName,"onUpdate:modelValue":E[3]||(E[3]=P=>f.value.assignmentRuleName=P),required:"",maxlength:"50",onChange:E[4]||(E[4]=P=>d("assignmentRuleName"))},null,8,["placeholder","label","modelValue"]),r(t(de),{message:k.value.assignmentRuleName,class:"mt-2"},null,8,["message"])]),e("div",dp,[r(t(mt),{label:V.__("Priority")},null,8,["label"]),r(t(De),null,{target:j(({togglePopover:P})=>{var te;return[e("div",{class:"flex items-center justify-between text-base rounded h-7 py-1.5 pl-2 pr-2 border border-outline-gray-2 bg-surface-gray-2 placeholder-ink-gray-4 hover:border-outline-gray-modals hover:bg-surface-gray-3 focus:bg-surface-white focus:border-outline-gray-4 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 text-ink-gray-8 transition-colors w-full dark:[color-scheme:dark] cursor-default",onClick:se=>P()},[e("div",null,h((te=A.find(se=>se.value==f.value.priority))==null?void 0:te.label),1),r(J,{name:"chevron-down",class:"size-4"})],8,cp)]}),body:j(({togglePopover:P})=>[e("div",mp,[(s(),c(B,null,Z(A,te=>e("div",{key:te.value,class:"p-2 cursor-pointer hover:bg-gray-50 text-base flex items-center justify-between rounded",onClick:()=>{f.value.priority=te.value,P()}},[Y(h(te.label)+" ",1),f.value.priority==te.value?(s(),S(J,{key:0,name:"check",class:"size-4"})):$("",!0)],8,pp)),64))])]),_:1})]),e("div",null,[r(t(O),{type:"textarea",size:"sm",variant:"subtle",placeholder:V.__("Description"),label:V.__("Description"),required:"",maxlength:"250",onChange:E[5]||(E[5]=P=>d("description")),modelValue:f.value.description,"onUpdate:modelValue":E[6]||(E[6]=P=>f.value.description=P)},null,8,["placeholder","label","modelValue"]),r(t(de),{message:k.value.description,class:"mt-2"},null,8,["message"])]),e("div",_p,[r(t(mt),{label:V.__("Apply on")},null,8,["label"]),r(t(cl),{options:[{label:"Lead",value:"CRM Lead"},{label:"Deal",value:"CRM Deal"}],modelValue:f.value.documentType,"onUpdate:modelValue":E[7]||(E[7]=P=>f.value.documentType=P)},null,8,["modelValue"])])]),E[11]||(E[11]=e("hr",{class:"my-8"},null,-1)),e("div",null,[e("div",fp,[e("span",gp,h(V.__("Assignment condition")),1),e("div",vp,[e("span",hp,[Y(h(V.__("Choose which {0} are affected by this assignment rule.",[_.value]))+" ",1),e("a",yp,h(V.__("Learn about conditions")),1)]),u.value&&t(a).data?(s(),c("div",bp,[r(t(De),{trigger:"hover",hoverDelay:.25,placement:"top-end"},{target:j(()=>[e("div",xp,[e("span",null,h(V.__("Old Condition")),1),r(J,{name:"info",class:"size-4"})])]),"body-main":j(()=>[e("div",kp,[e("code",null,h(f.value.assignCondition),1)])]),_:1})])):$("",!0)])]),e("div",Cp,[!b.value&&f.value.assignCondition?(s(),c("div",wp,[e("span",$p,[Y(h(V.__("Conditions for this rule were created from"))+" ",1),e("a",{href:p,target:"_blank",class:"underline"},h(V.__("desk")),1),Y(" "+h(V.__("which are not compatible with this UI, you will need to recreate the conditions here if you want to manage and add new conditions from this UI.")),1)]),r(t(G),{label:V.__("I understand, add conditions"),variant:"subtle",theme:"gray",onClick:E[8]||(E[8]=P=>b.value=!0)},null,8,["label"])])):(s(),S(Ct,{key:1,conditions:f.value.assignConditionJson,name:"assignCondition",errors:k.value.assignConditionError,doctype:f.value.documentType},null,8,["conditions","errors","doctype"])),e("div",Sp,[r(t(de),{message:k.value.assignCondition,class:"mt-2"},null,8,["message"])])])]),E[12]||(E[12]=e("hr",{class:"my-8"},null,-1)),e("div",null,[e("div",Vp,[e("span",Lp,h(V.__("Unassignment condition")),1),e("div",Mp,[e("span",Dp,[Y(h(V.__("Choose which {0} are affected by this un-assignment rule.",[_.value]))+" ",1),e("a",Rp,h(V.__("Learn about conditions")),1)]),u.value&&t(a).data&&f.value.unassignCondition?(s(),c("div",Ap,[r(t(De),{trigger:"hover",hoverDelay:.25,placement:"top-end"},{target:j(()=>[e("div",Up,[e("span",null,h(V.__("Old Condition")),1),r(J,{name:"info",class:"size-4"})])]),"body-main":j(()=>[e("div",jp,[e("code",null,h(f.value.unassignCondition),1)])]),_:1})])):$("",!0)])]),e("div",Ep,[!b.value&&f.value.unassignCondition?(s(),c("div",Ip,[e("span",Tp,[Y(h(V.__("Conditions for this rule were created from"))+" ",1),e("a",{href:p,target:"_blank",class:"underline"},h(V.__("desk")),1),Y(" "+h(V.__("which are not compatible with this UI, you will need to recreate the conditions here if you want to manage and add new conditions from this UI.")),1)]),r(t(G),{label:V.__("I understand, add conditions"),variant:"subtle",theme:"gray",onClick:E[9]||(E[9]=P=>b.value=!0)},null,8,["label"])])):(s(),S(Ct,{key:1,conditions:f.value.unassignConditionJson,name:"unassignCondition",errors:k.value.unassignConditionError,doctype:f.value.documentType},null,8,["conditions","errors","doctype"]))])]),E[13]||(E[13]=e("hr",{class:"my-8"},null,-1)),e("div",null,[e("div",Bp,[e("span",Fp,h(V.__("Assignment Schedule")),1),e("span",Np,h(V.__("Choose the days of the week when this rule should be active.")),1)]),e("div",zp,[r(Rm)])]),E[14]||(E[14]=e("hr",{class:"my-8"},null,-1)),r(lp)])])),r(t(Zl),{modelValue:v.value.show,"onUpdate:modelValue":E[10]||(E[10]=P=>v.value.show=P),title:v.value.title,message:v.value.message,onConfirm:v.value.onConfirm,onCancel:()=>v.value.show=!1},null,8,["modelValue","title","message","onConfirm","onCancel"])],64)}}},qp={__name:"AssignmentRulePage",setup(g){const l=D({screen:"list",data:null});ue("step",l),ue("updateStep",i);function i(m,n){l.value={screen:m,data:n}}return(m,n)=>l.value.screen==="list"?(s(),S(nm,{key:0})):l.value.screen==="view"?(s(),S(Pp,{key:1})):$("",!0)}},Hp={class:"flex h-[calc(100vh_-_8rem)]"},Gp={class:"flex flex-col p-1 w-52 shrink-0 bg-surface-gray-2"},Zp={class:"px-3 pt-3 pb-2 text-lg font-semibold text-ink-gray-8"},Jp={class:"flex flex-col overflow-y-auto"},Yp={key:0,class:"py-[7px] px-2 my-1 flex cursor-pointer gap-1.5 text-base text-ink-gray-5 transition-all duration-300 ease-in-out"},Wp={class:"space-y-1 px-1"},Kp={class:"flex flex-col flex-1 overflow-y-auto bg-surface-modal"},Qp={__name:"Settings",setup(g){const{isManager:l,isTelephonyAgent:i,getUser:m}=ge(),n=N(()=>m()||{}),a=N(()=>[{label:__("Personal Settings"),hideLabel:!0,items:[{label:__("Profile"),icon:()=>ne(Ee,{size:"xs",label:n.value.full_name,image:n.value.user_image}),component:H(Oo)}]},{label:__("System Configuration"),items:[{label:__("Forecasting"),component:H(Pr),icon:xa},{label:__("Currency & Exchange Rate"),icon:ha,component:H(gu)},{label:__("Brand Settings"),icon:$a,component:H(br)}],condition:()=>l()},{label:__("User Management"),items:[{label:__("Users"),icon:"user",component:H(_o),condition:()=>l()},{label:__("Invite User"),icon:"user-plus",component:H(Mo),condition:()=>l()}],condition:()=>l()},{label:__("Email Settings"),items:[{label:__("Email Accounts"),icon:jl,component:H(Mc),condition:()=>l()},{label:__("Email Templates"),icon:kl,component:H(hd)}]},{label:__("Automation & Rules"),items:[{label:__("Assignment rules"),icon:H(ne(Ua,{class:"rotate-90"})),component:H(qp)}]},{label:__("Customization"),items:[{label:__("Home Actions"),component:H(Mr),icon:"home"}],condition:()=>l()},{label:__("Integrations",null,"FCRM"),items:[{label:__("Telephony"),icon:Ke,component:H(Rd),condition:()=>l()||i()},{label:__("WhatsApp"),icon:Ut,component:H(Wo),condition:()=>Tl.value&&l()},{label:__("ERPNext"),icon:Ma,component:H(Ko),condition:()=>l()},{label:__("Lead Syncing"),icon:"refresh-cw",component:H(Zi),condition:()=>l()}],condition:()=>l()||i()}].filter(u=>u.condition&&!u.condition()?!1:(u.items&&(u.items=u.items.filter(_=>!(_.condition&&!_.condition()))),!0))),o=D(a.value[0].items[0]);function v(b){o.value=b&&a.value.map(u=>u.items).flat().find(u=>u.label===b)||a.value[0].items[0]}return pe($e,b=>v(b)),(b,u)=>(s(),S(t(Ae),{modelValue:t(Ce),"onUpdate:modelValue":u[0]||(u[0]=_=>st(Ce)?Ce.value=_:null),options:{size:"5xl"},onClose:u[1]||(u[1]=_=>$e.value=""),disableOutsideClickToClose:t(Be)},{body:j(()=>[e("div",Hp,[e("div",Gp,[e("h1",Zp,h(b.__("Settings")),1),e("div",Jp,[(s(!0),c(B,null,Z(a.value,_=>(s(),c(B,{key:_.label},[_.hideLabel?$("",!0):(s(),c("div",Yp,[e("span",null,h(b.__(_.label)),1)])),e("nav",Wp,[(s(!0),c(B,null,Z(_.items,p=>{var C;return s(),S(Le,{icon:p.icon,label:b.__(p.label),class:K(["w-full",((C=o.value)==null?void 0:C.label)==p.label?"bg-surface-selected shadow-sm hover:bg-surface-selected":"hover:bg-surface-gray-3"]),onClick:f=>$e.value=p.label},null,8,["icon","label","class","onClick"])}),256))])],64))),128))])]),e("div",Kp,[o.value?(s(),S(_e(o.value.component),{key:0})):$("",!0)])])]),_:1},8,["modelValue","disableOutsideClickToClose"]))}},Xp={class:"p-2"},e1={class:"flex-1 overflow-y-auto"},t1={class:"mb-3 flex flex-col"},l1={key:1,class:"absolute -left-1.5 top-1 z-20 h-[5px] w-[5px] translate-x-6 translate-y-1 rounded-full bg-surface-gray-6 ring-1 ring-white"},s1={key:0,class:"mx-2 my-2 h-1 border-b"},n1=["onClick"],a1={class:"flex flex-col"},o1={class:"m-2 flex flex-col gap-1"},i1={class:"flex flex-col gap-2 mb-1"},r1={class:"grid h-4 w-4 flex-shrink-0 place-items-center"},u1={__name:"AppSidebar",setup(g){const{getPinnedViews:l,getPublicViews:i}=ml(),{toggle:m}=Rt(),n=pl("isSidebarCollapsed",!1),a=D(window.is_fc_site),o=D(window.is_demo_site),v=[{label:"Dashboard",icon:Ln,to:"Dashboard"},{label:"Leads",icon:He,to:"Leads"},{label:"Deals",icon:pt,to:"Deals"},{label:"Contacts",icon:_t,to:"Contacts"},{label:"Organizations",icon:ft,to:"Organizations"},{label:"Notes",icon:Ge,to:"Notes"},{label:"Tasks",icon:gt,to:"Tasks"},{label:"Call Logs",icon:Ke,to:"Call Logs"},{label:"Custom Reports",icon:yt,to:"/app/query-report/CRM Custom Report",isExternal:!0},{label:"GA4 Reports",icon:yt,to:"Reports",isExternal:!0}],b=N(()=>{let A=[{name:"All Views",hideLabel:!0,opened:!0,views:v.filter(x=>x.condition?x.condition():!0)}];return i().length&&A.push({name:"Public views",opened:!0,views:u(i())}),l().length&&A.push({name:"Pinned views",opened:!0,views:u(l())}),A});function u(A){return A.map(x=>({label:x.label,icon:_(x.route_name,x.icon),to:{name:x.route_name,params:{viewType:x.type||"list"},query:{view:x.name}}}))}function _(A,x){if(x)return ne("div",{class:"size-auto"},x);switch(A){case"Leads":return He;case"Deals":return pt;case"Contacts":return _t;case"Organizations":return ft;case"Notes":return Ge;case"Call Logs":return Ke;default:return Vl}}const{user:p}=_l(),{users:C,isManager:f}=ge(),{isOnboardingStepsCompleted:d,setUp:y}=Ie("frappecrm");async function k(){let A=localStorage.getItem("firstLead"+p);return A||await he("crm.api.onboarding.get_first_lead")}async function w(){let A=localStorage.getItem("firstDeal"+p);return A||await he("crm.api.onboarding.get_first_deal")}const M=D(!1),U=D({}),I=nt([{name:"setup_your_password",title:__("Setup your password"),icon:H(qn),completed:!1,onClick:()=>{le.value=!0,$l.value=!0}},{name:"create_first_lead",title:__("Create your first lead"),icon:H(He),completed:!1,onClick:()=>{le.value=!0,oe.push({name:"Leads"})}},{name:"invite_your_team",title:__("Invite your team"),icon:H(An),completed:!1,onClick:()=>{le.value=!0,Ce.value=!0,$e.value="Invite User"},condition:()=>f()},{name:"convert_lead_to_deal",title:__("Convert lead to deal"),icon:H(In),completed:!1,dependsOn:"create_first_lead",onClick:async()=>{le.value=!0,U.value={title:__("Convert lead to deal"),buttonLabel:__("Convert"),videoURL:"/assets/crm/videos/convertToDeal.mov",onClick:async()=>{M.value=!1,U.value={};let A=await k();A?oe.push({name:"Lead",params:{leadId:A}}):oe.push({name:"Leads"})}},M.value=!0}},{name:"create_first_task",title:__("Create your first task"),icon:H(gt),completed:!1,onClick:async()=>{le.value=!0;let A=await w();A?oe.push({name:"Deal",params:{dealId:A},hash:"#tasks"}):oe.push({name:"Tasks"})}},{name:"create_first_note",title:__("Create your first note"),icon:H(Ge),completed:!1,onClick:async()=>{le.value=!0;let A=await w();A?oe.push({name:"Deal",params:{dealId:A},hash:"#notes"}):oe.push({name:"Notes"})}},{name:"add_first_comment",title:__("Add your first comment"),icon:H(bl),completed:!1,dependsOn:"create_first_lead",onClick:async()=>{le.value=!0;let A=await w();A?oe.push({name:"Deal",params:{dealId:A},hash:"#comments"}):oe.push({name:"Leads"})}},{name:"send_first_email",title:__("Send email"),icon:H(Cl),completed:!1,dependsOn:"create_first_lead",onClick:async()=>{le.value=!0;let A=await w();A?oe.push({name:"Deal",params:{dealId:A},hash:"#emails"}):oe.push({name:"Leads"})}},{name:"change_deal_status",title:__("Change deal status"),icon:H(Nn),completed:!1,dependsOn:"convert_lead_to_deal",onClick:async()=>{le.value=!0,U.value={title:__("Change deal status"),buttonLabel:__("Change"),videoURL:"/assets/crm/videos/changeDealStatus.mov",onClick:async()=>{M.value=!1,U.value={};let A=await w();A?oe.push({name:"Deal",params:{dealId:A},hash:"#activity"}):oe.push({name:"Leads"})}},M.value=!0}}]);me(async()=>{await C.promise;const A=I.filter(x=>x.condition?x.condition():!0);y(A)});const z=D([{title:__("Introduction"),opened:!1,subArticles:[{name:"introduction",title:__("Introduction")},{name:"setting-up",title:__("Setting up")}]},{title:__("Settings"),opened:!1,subArticles:[{name:"profile",title:__("Profile")},{name:"custom-branding",title:__("Custom branding")},{name:"home-actions",title:__("Home actions")},{name:"invite-users",title:__("Invite users")}]},{title:__("Masters"),opened:!1,subArticles:[{name:"lead",title:__("Lead")},{name:"deal",title:__("Deal")},{name:"contact",title:__("Contact")},{name:"organization",title:__("Organization")},{name:"note",title:__("Note")},{name:"task",title:__("Task")},{name:"call-log",title:__("Call log")},{name:"email-template",title:__("Email template")}]},{title:__("Capturing leads"),opened:!1,subArticles:[{name:"web-form",title:__("Web form")}]},{title:__("Views"),opened:!1,subArticles:[{name:"view",title:__("Saved view")},{name:"public-view",title:__("Public view")},{name:"pinned-view",title:__("Pinned view")}]},{title:__("Other features"),opened:!1,subArticles:[{name:"email-communication",title:__("Email communication")},{name:"comment",title:__("Comment")},{name:"data",title:__("Data")},{name:"service-level-agreement",title:__("Service level agreement")},{name:"assignment-rule",title:__("Assignment rule")},{name:"notification",title:__("Notification")}]},{title:__("Customization"),opened:!1,subArticles:[{name:"custom-fields",title:__("Custom fields")},{name:"custom-actions",title:__("Custom actions")},{name:"custom-statuses",title:__("Custom statuses")},{name:"custom-list-actions",title:__("Custom list actions")},{name:"quick-entry-layout",title:__("Quick entry layout")}]},{title:__("Integration"),opened:!1,subArticles:[{name:"twilio",title:__("Twilio")},{name:"exotel",title:__("Exotel")},{name:"whatsapp",title:__("WhatsApp")},{name:"erpnext",title:__("ERPNext")}]},{title:__("Frappe CRM mobile"),opened:!1,subArticles:[{name:"mobile-app-installation",title:__("Mobile app installation")}]}]);return(A,x)=>{const R=T("Badge");return s(),c("div",{class:K(["relative flex h-full flex-col justify-between transition-all duration-300 ease-in-out",t(n)?"w-12":"w-[220px]"])},[e("div",Xp,[r(gl,{isCollapsed:t(n)},null,8,["isCollapsed"])]),e("div",e1,[e("div",t1,[r(Le,{id:"notifications-btn",label:A.__("Notifications"),icon:At,isCollapsed:t(n),onClick:x[0]||(x[0]=()=>t(m)()),class:"relative mx-2 my-0.5"},{right:j(()=>[!t(n)&&t(Je)?(s(),S(R,{key:0,label:t(Je),variant:"subtle"},null,8,["label"])):t(Je)?(s(),c("div",l1)):$("",!0)]),_:1},8,["label","isCollapsed"])]),(s(!0),c(B,null,Z(b.value,L=>{var q;return s(),c("div",{key:L.label},[!L.hideLabel&&t(n)&&((q=L.views)!=null&&q.length)?(s(),c("div",s1)):$("",!0),r(Sl,{label:L.name,hideLabel:L.hideLabel,opened:L.opened},{header:j(({opened:V,hide:E,toggle:J})=>[E?$("",!0):(s(),c("div",{key:0,class:K(["flex cursor-pointer gap-1.5 px-1 text-base font-medium text-ink-gray-5 transition-all duration-300 ease-in-out",t(n)?"ml-0 h-0 overflow-hidden opacity-0":"ml-2 mt-4 h-7 w-auto opacity-100"]),onClick:P=>J()},[r(t(ae),{name:"chevron-right",class:K(["h-4 text-ink-gray-9 transition-all duration-300 ease-in-out",{"rotate-90":V}])},null,8,["class"]),e("span",null,h(A.__(L.name)),1)],10,n1))]),default:j(()=>[e("nav",a1,[(s(!0),c(B,null,Z(L.views,V=>(s(),S(Le,{icon:V.icon,label:A.__(V.label),to:V.to,isCollapsed:t(n),isExternal:V.isExternal,class:"mx-2 my-0.5"},null,8,["icon","label","to","isCollapsed","isExternal"]))),256))])]),_:2},1032,["label","hideLabel","opened"])])}),128))]),e("div",o1,[e("div",i1,[o.value?(s(),S(t($n),{key:0,isSidebarCollapsed:t(n),afterSignup:()=>t(xe)("signup_from_demo_site")},null,8,["isSidebarCollapsed","afterSignup"])):$("",!0),a.value?(s(),S(t(yn),{key:1,isSidebarCollapsed:t(n),afterUpgrade:()=>t(xe)("upgrade_plan_from_trial_banner")},null,8,["isSidebarCollapsed","afterUpgrade"])):$("",!0),t(d)?$("",!0):(s(),S(t(sn),{key:2,isSidebarCollapsed:t(n)},null,8,["isSidebarCollapsed"]))]),t(d)?(s(),S(Le,{key:0,label:A.__("Help"),isCollapsed:t(n),onClick:x[1]||(x[1]=()=>{be.value=t(le)?!0:!t(be),le.value=!t(be)})},{icon:j(()=>[r(ta,{class:"h-4 w-4"})]),_:1},8,["label","isCollapsed"])):$("",!0),r(Le,{label:t(n)?A.__("Expand"):A.__("Collapse"),isCollapsed:t(n),onClick:x[2]||(x[2]=L=>n.value=!t(n)),class:""},{icon:j(()=>[e("span",r1,[r(Kn,{class:K(["h-4 w-4 text-ink-gray-7 duration-300 ease-in-out",{"[transform:rotateY(180deg)]":t(n)}])},null,8,["class"])])]),_:1},8,["label","isCollapsed"])]),r(fa),r(Qp),t(be)?(s(),S(t(Js),{key:0,modelValue:t(be),"onUpdate:modelValue":x[3]||(x[3]=L=>st(be)?be.value=L:null),articles:z.value,"onUpdate:articles":x[4]||(x[4]=L=>z.value=L),logo:vl,afterSkip:L=>t(xe)("onboarding_step_skipped_"+L),afterSkipAll:()=>t(xe)("onboarding_steps_skipped"),afterReset:L=>t(xe)("onboarding_step_reset_"+L),afterResetAll:()=>t(xe)("onboarding_steps_reset"),docsLink:"https://docs.frappe.io/crm"},null,8,["modelValue","articles","afterSkip","afterSkipAll","afterReset","afterResetAll"])):$("",!0),r(t(dn),{modelValue:M.value,"onUpdate:modelValue":x[5]||(x[5]=L=>M.value=L),currentStep:U.value},null,8,["modelValue","currentStep"])],2)}}},d1={class:"flex border-b pr-5"},c1={class:"flex items-center justify-center"},m1={__name:"AppHeader",setup(g){return(l,i)=>(s(),c("div",d1,[i[0]||(i[0]=e("div",{id:"app-header",class:"flex-1"},null,-1)),e("div",c1,[r(hl)])]))}},p1={class:"flex h-screen w-screen"},_1={class:"h-full border-r bg-surface-menu-bar"},f1={class:"flex-1 flex flex-col h-full overflow-auto bg-surface-white"},Q1={__name:"DesktopLayout",setup(g){return(l,i)=>(s(),c("div",p1,[e("div",_1,[r(u1)]),e("div",f1,[r(m1),Me(l.$slots,"default")]),r(yl)]))}};export{Q1 as default};
//# sourceMappingURL=DesktopLayout-19988083.js.map

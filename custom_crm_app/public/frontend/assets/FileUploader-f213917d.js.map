{"version":3,"file":"FileUploader-f213917d.js","sources":["../../../../frontend/node_modules/frappe-ui/src/components/FileUploader/FileUploader.vue"],"sourcesContent":["<template>\n  <div>\n    <input\n      ref=\"input\"\n      type=\"file\"\n      :accept=\"fileTypes\"\n      class=\"hidden\"\n      @change=\"onFileAdd\"\n    />\n    <slot\n      v-bind=\"{\n        file,\n        uploading,\n        progress,\n        uploaded,\n        message,\n        error,\n        total,\n        success,\n        openFileSelector,\n      }\"\n    >\n      <Button @click=\"openFileSelector\" :loading=\"uploading\">\n        {{ uploading ? `Uploading ${progress}%` : 'Upload File' }}\n      </Button>\n    </slot>\n  </div>\n</template>\n\n<script>\nimport { Button } from '../Button'\nimport FileUploadHandler from '../../utils/fileUploadHandler'\n\nexport default {\n  name: 'FileUploader',\n  props: {\n    fileTypes: {\n      type: [String, Array],\n    },\n    uploadArgs: {\n      type: Object,\n    },\n    validateFile: {\n      type: Function,\n      default: null,\n    },\n  },\n  data() {\n    return {\n      uploader: null,\n      uploading: false,\n      uploaded: 0,\n      error: null,\n      message: '',\n      total: 0,\n      file: null,\n      finishedUploading: false,\n    }\n  },\n  computed: {\n    progress() {\n      let value = Math.floor((this.uploaded / this.total) * 100)\n      return isNaN(value) ? 0 : value\n    },\n    success() {\n      return this.finishedUploading && !this.error\n    },\n  },\n  methods: {\n    inputRef() {\n      return this.$refs['input']\n    },\n    openFileSelector() {\n      this.$refs['input'].click()\n    },\n    async onFileAdd(e) {\n      this.error = null\n      this.file = e.target.files[0]\n\n      if (this.file && this.validateFile) {\n        try {\n          let message = await this.validateFile(this.file)\n          if (message) {\n            this.error = message\n          }\n        } catch (error) {\n          this.error = error\n        }\n      }\n\n      if (!this.error) {\n        this.uploadFile(this.file)\n      }\n    },\n    async uploadFile(file) {\n      this.error = null\n      this.uploaded = 0\n      this.total = 0\n\n      this.uploader = new FileUploadHandler()\n      this.uploader.on('start', () => {\n        this.uploading = true\n      })\n      this.uploader.on('progress', (data) => {\n        this.uploaded = data.uploaded\n        this.total = data.total\n      })\n      this.uploader.on('error', () => {\n        this.uploading = false\n        this.error = 'Error Uploading File'\n      })\n      this.uploader.on('finish', () => {\n        this.uploading = false\n        this.finishedUploading = true\n      })\n      this.uploader\n        .upload(file, this.uploadArgs || {})\n        .then((data) => {\n          this.$emit('success', data)\n        })\n        .catch((error) => {\n          this.uploading = false\n          let errorMessage = 'Error Uploading File'\n          if (error?._server_messages) {\n            errorMessage = JSON.parse(\n              JSON.parse(error._server_messages)[0],\n            ).message\n          } else if (error?.exc) {\n            errorMessage = JSON.parse(error.exc)[0].split('\\n').slice(-2, -1)[0]\n          }\n          this.error = errorMessage\n          this.$emit('failure', error)\n        })\n    },\n  },\n  expose: ['inputRef'],\n}\n</script>\n"],"names":["_sfc_main","value","e","message","error","file","FileUploadHandler","data","errorMessage","_createElementBlock","_createElementVNode","$props","$options","args","_renderSlot","_ctx","_normalizeProps","_guardReactiveProps","$data","_createVNode","_component_Button","_createTextVNode","_toDisplayString"],"mappings":"yKAiCA,MAAKA,EAAU,CACb,KAAM,eACN,MAAO,CACL,UAAW,CACT,KAAM,CAAC,OAAQ,KAAK,CACrB,EACD,WAAY,CACV,KAAM,MACP,EACD,aAAc,CACZ,KAAM,SACN,QAAS,IACV,CACF,EACD,MAAO,CACL,MAAO,CACL,SAAU,KACV,UAAW,GACX,SAAU,EACV,MAAO,KACP,QAAS,GACT,MAAO,EACP,KAAM,KACN,kBAAmB,EACrB,CACD,EACD,SAAU,CACR,UAAW,CACT,IAAIC,EAAQ,KAAK,MAAO,KAAK,SAAW,KAAK,MAAS,GAAG,EACzD,OAAO,MAAMA,CAAK,EAAI,EAAIA,CAC3B,EACD,SAAU,CACR,OAAO,KAAK,mBAAqB,CAAC,KAAK,KACxC,CACF,EACD,QAAS,CACP,UAAW,CACT,OAAO,KAAK,MAAM,KACnB,EACD,kBAAmB,CACjB,KAAK,MAAM,MAAS,MAAM,CAC3B,EACD,MAAM,UAAUC,EAAG,CAIjB,GAHA,KAAK,MAAQ,KACb,KAAK,KAAOA,EAAE,OAAO,MAAM,CAAC,EAExB,KAAK,MAAQ,KAAK,aACpB,GAAI,CACF,IAAIC,EAAU,MAAM,KAAK,aAAa,KAAK,IAAI,EAC3CA,IACF,KAAK,MAAQA,EAEf,OAAOC,EAAO,CACd,KAAK,MAAQA,CACf,CAGG,KAAK,OACR,KAAK,WAAW,KAAK,IAAI,CAE5B,EACD,MAAM,WAAWC,EAAM,CACrB,KAAK,MAAQ,KACb,KAAK,SAAW,EAChB,KAAK,MAAQ,EAEb,KAAK,SAAW,IAAIC,EACpB,KAAK,SAAS,GAAG,QAAS,IAAM,CAC9B,KAAK,UAAY,GAClB,EACD,KAAK,SAAS,GAAG,WAAaC,GAAS,CACrC,KAAK,SAAWA,EAAK,SACrB,KAAK,MAAQA,EAAK,MACnB,EACD,KAAK,SAAS,GAAG,QAAS,IAAM,CAC9B,KAAK,UAAY,GACjB,KAAK,MAAQ,uBACd,EACD,KAAK,SAAS,GAAG,SAAU,IAAM,CAC/B,KAAK,UAAY,GACjB,KAAK,kBAAoB,GAC1B,EACD,KAAK,SACF,OAAOF,EAAM,KAAK,YAAc,CAAA,CAAE,EAClC,KAAME,GAAS,CACd,KAAK,MAAM,UAAWA,CAAI,EAC3B,EACA,MAAOH,GAAU,CAChB,KAAK,UAAY,GACjB,IAAII,EAAe,uBACfJ,GAAA,MAAAA,EAAO,iBACTI,EAAe,KAAK,MAClB,KAAK,MAAMJ,EAAM,gBAAgB,EAAE,CAAC,CACtC,EAAE,QACOA,GAAA,MAAAA,EAAO,MAChBI,EAAe,KAAK,MAAMJ,EAAM,GAAG,EAAE,CAAC,EAAE,MAAM;AAAA,CAAI,EAAE,MAAM,GAAI,EAAE,EAAE,CAAC,GAErE,KAAK,MAAQI,EACb,KAAK,MAAM,UAAWJ,CAAK,EAC5B,CACJ,CACF,EACD,OAAQ,CAAC,UAAU,CACrB,sEAvIEK,EAyBM,MAAA,KAAA,CAxBJC,EAME,QAAA,CALA,IAAI,QACJ,KAAK,OACJ,OAAQC,EAAS,UAClB,MAAM,SACL,6BAAQC,EAAS,WAAAA,EAAA,UAAA,GAAAC,CAAA,eAEpBC,EAgBOC,EAAA,OAAA,UAAAC,EAAAC,EAAA,MAfaC,EAAI,eAAUA,EAAS,mBAAUN,EAAQ,kBAAUM,EAAQ,iBAAUA,EAAO,cAAUA,EAAK,YAAUA,EAAK,cAAUN,EAAO,yBAAUA,EAAgB,oBADzK,IAgBO,CAHLO,EAESC,EAAA,CAFA,QAAOR,EAAgB,iBAAG,QAASM,EAAS,sBACnD,IAA0D,CAAvDG,EAAAC,EAAAJ,EAAA,uBAAyBN,EAAQ,QAAA,IAAA,aAAA,EAAA,CAAA","x_google_ignoreList":[0]}
class f{constructor(){this.listeners={},this.failed=!1}on(d,e){this.listeners[d]=this.listeners[d]||[],this.listeners[d].push(e)}trigger(d,e){(this.listeners[d]||[]).forEach(i=>{i.call(this,e)})}upload(d,e){return new Promise((l,i)=>{let t=new XMLHttpRequest;t.upload.addEventListener("loadstart",()=>{this.trigger("start")}),t.upload.addEventListener("progress",r=>{r.lengthComputable&&this.trigger("progress",{uploaded:r.loaded,total:r.total})}),t.upload.addEventListener("load",()=>{this.trigger("finish")}),t.addEventListener("error",()=>{this.trigger("error"),i()}),t.onreadystatechange=()=>{if(t.readyState==XMLHttpRequest.DONE){let r;if(t.status===200){let s=null;try{s=JSON.parse(t.responseText)}catch{s=t.responseText}let p=s.message||s;l(p)}else if(t.status===403)r=JSON.parse(t.responseText);else{this.failed=!0;try{r=JSON.parse(t.responseText)}catch{}}r&&r.exc&&console.error(JSON.parse(r.exc)[0]),i(r)}};const n=e.upload_endpoint||"/api/method/upload_file";t.open("POST",n,!0),t.setRequestHeader("Accept","application/json"),window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&t.setRequestHeader("X-Frappe-CSRF-Token",window.csrf_token);let a=new FormData;d&&a.append("file",d,d.name),a.append("is_private",e.private?"1":"0"),a.append("folder",e.folder||"Home"),e.file_url&&a.append("file_url",e.file_url),e.doctype&&a.append("doctype",e.doctype),e.docname&&a.append("docname",e.docname),e.fieldname&&a.append("fieldname",e.fieldname),e.method&&a.append("method",e.method),e.type&&a.append("type",e.type),e.optimize&&(a.append("optimize","1"),e.max_width&&a.append("max_width",e.max_width.toString()),e.max_height&&a.append("max_height",e.max_height.toString())),t.send(a)})}}const c=f;export{c as F};
//# sourceMappingURL=fileUploadHandler-0b2042a3.js.map

import{g as ie,S as se}from"./view-50c6be59.js";import{_ as le}from"./Icon-c9812454.js";import{_ as re}from"./LayoutHeader-14d19c20.js";import{_ as me}from"./DealsListView-c0843424.js";import{_ as ce}from"./ContactsListView-f30ced9e.js";import{D as de}from"./DetailsIcon-a948fc9a.js";import{C as ue}from"./CameraIcon-7fcf507a.js";import{D as _e}from"./DealsIcon-f2e9236f.js";import{C as ge}from"./ContactsIcon-506159cf.js";import{u as pe,s as fe,a as ye,_ as be}from"./modals-3c1f9e01.js";import{g as he}from"./settings-c75a63ab.js";import{b as F,f as $,t as A,a as ve,v as we,o as ze}from"./index-98a0eb06.js";import{g as ke}from"./global-f8b0dbce.js";import{V as Ce,W as xe,$ as De,x as _,T as Ie,l as Oe,Z as V,r as w,b as i,c as f,u as t,g as d,w as u,A as l,d as r,F as Me,a0 as q,e as m,I as Re,a2 as x,t as z,n as T,Q as j,a1 as Se}from"./index-a3e8239b.js";import{s as Be}from"./statuses-5a1a92aa.js";import{u as Fe}from"./pageMeta-155cb5a4.js";import{_ as $e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-5a4bffc5.js";import{createListResource as L}from"../node_modules/frappe-ui/src/resources/listResource.js";import{D as Ae}from"./dayjs-de744307.js";import{F as Ve}from"./FileUploader-3fdaa660.js";import"./DragVerticalIcon-cbd80dc8.js";import"./Link-ce253979.js";import"./FadedScrollableDiv-143e35ae.js";import"./ArrowUpRightIcon-afcc694f.js";import"./ListBulkActions-ab2a2653.js";import"./DeleteLinkedDocModal-fb988008.js";import"./ListView-b8b2188c.js";import"./MultipleAvatar-8af17d0d.js";import"./IndicatorIcon-6cac9012.js";import"./PhoneIcon-58ab8bcd.js";import"./ListFooter-af9aa9de.js";import"./TabButtons-71b5ed70.js";import"./description-7db9d20b.js";import"./plus-d2d9d364.js";import"./fileUploadHandler-0b2042a3.js";const qe={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Te={key:1,class:"flex flex-col h-full overflow-hidden"},je={class:"flex flex-col items-start justify-start gap-4 p-4"},Le={class:"flex gap-4 items-center"},Ne={class:"group relative h-14.5 w-14.5"},Pe={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ee={class:"flex flex-col gap-2 truncate"},Ue={class:"truncate text-lg font-medium text-ink-gray-9"},We={class:"flex items-center gap-1.5"},Qe={key:0},Ze={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},Ge={key:3,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},He={class:"flex flex-col items-center justify-center space-y-3"},Sa={__name:"MobileOrganization",props:{organizationId:{type:String,required:!0}},setup(N){const c=N,{brand:P}=he(),{getUser:D}=Ce(),{$dialog:E}=ke(),{getDealStatus:U}=Be(),{doctypeMeta:W}=F("CRM Organization"),g=xe(),Q=De(),{document:n,permissions:Z}=pe("CRM Organization",c.organizationId),G=_(()=>{var e,a;return((a=(e=Z.data)==null?void 0:e.permissions)==null?void 0:a.delete)||!1}),H=_(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];if(g.query.view||g.query.viewType){let a=ie(g.query.view,g.query.viewType,"CRM Organization");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Organizations",params:{viewType:g.query.viewType},query:{view:g.query.view}}})}return e.push({label:I.value,route:{name:"Organization",params:{organizationId:c.organizationId}}}),e}),I=_(()=>{var a,s;let e=((a=W["CRM Organization"])==null?void 0:a.title_field)||"name";return((s=n.doc)==null?void 0:s[e])||c.organizationId});Fe(()=>({title:I.value,icon:P.favicon}));async function O(e){await q("frappe.client.set_value",{doctype:"CRM Organization",name:c.organizationId,fieldname:"organization_logo",value:(e==null?void 0:e.file_url)||""}),n.reload()}async function J(){E({title:__("Delete organization"),message:__("Are you sure you want to delete this organization?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await q("frappe.client.delete",{doctype:"CRM Organization",name:c.organizationId}),e(),Q.push({name:"Organizations"})}}]})}function K(){if(!n.doc.website){Se.error(__("No website found"));return}ze(n.doc.website)}const k=Ie({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","CRM Organization"],params:{doctype:"CRM Organization"},auto:!0,transform:e=>X(e)});function X(e){return e.map(a=>(a.columns=a.columns.map(s=>(s.fields=s.fields.map(p=>p.fieldname==="address"?{...p,create:(h,C)=>{B(),C()},edit:h=>B(h)}:p),s)),a))}const y=Oe(0),Y=[{name:"Details",label:__("Details"),icon:de},{name:"Deals",label:__("Deals"),icon:V(_e,{class:"h-4 w-4"}),count:_(()=>{var e;return(e=M.data)==null?void 0:e.length})},{name:"Contacts",label:__("Contacts"),icon:V(ge,{class:"h-4 w-4"}),count:_(()=>{var e;return(e=R.data)==null?void 0:e.length})}],M=L({type:"list",doctype:"CRM Deal",cache:["deals",c.organizationId],fields:["name","organization","currency","annual_revenue","status","email","mobile_no","deal_owner","modified"],filters:{organization:c.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),R=L({type:"list",doctype:"Contact",cache:["contacts",c.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:c.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),b=_(()=>{let e=[];return e=y.value?R:M,e.data?e.data.map(a=>y.value?oe(a):ae(a)):[]}),{getFormattedCurrency:ee}=F("CRM Deal"),S=_(()=>y.value===0?te:ne);function ae(e){var a,s;return{name:e.name,organization:{label:e.organization,logo:(a=n.doc)==null?void 0:a.organization_logo},annual_revenue:ee("annual_revenue",e),status:{label:e.status,color:(s=U(e.status))==null?void 0:s.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&D(e.deal_owner).full_name,...e.deal_owner&&D(e.deal_owner)},modified:{label:$(e.modified),timeAgo:__(A(e.modified))}}}function oe(e){var a;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(a=n.doc)==null?void 0:a.organization_logo},modified:{label:$(e.modified),timeAgo:__(A(e.modified))}}}const te=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],ne=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function B(e){fe.value=!0,ye.value={doctype:"Address",address:e}}return(e,a)=>{const s=w("FeatherIcon"),p=w("Button"),h=w("ErrorMessage"),C=w("Badge");return i(),f(Me,null,[t(n).doc?(i(),d(re,{key:0},{default:u(()=>[m("header",qe,[r(t($e),{items:H.value},{prefix:u(({item:o})=>[o.icon?(i(),d(le,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):l("",!0)]),_:1},8,["items"])])]),_:1})):l("",!0),t(n).doc?(i(),f("div",Te,[r(t(Ve),{onSuccess:O,validateFile:t(we)},{default:u(({openFileSelector:o,error:v})=>[m("div",je,[m("div",Le,[m("div",Ne,[r(t(ve),{size:"3xl",class:"h-14.5 w-14.5",label:t(n).doc.organization_name,image:t(n).doc.organization_logo},null,8,["label","image"]),(i(),d(x(t(n).doc.organization_logo?t(Ae):"div"),Re(t(n).doc.organization_logo?{options:[{icon:"upload",label:t(n).doc.organization_logo?e.__("Change image"):e.__("Upload image"),onClick:o},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>O("")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:u(()=>[m("div",Pe,[r(ue,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),m("div",Ee,[m("div",Ue,z(t(n).doc.name),1),m("div",We,[r(p,{onClick:K},{default:u(()=>[r(s,{name:"link",class:"h-4 w-4"})]),_:1}),G.value?(i(),d(p,{key:0,label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:J},null,8,["label"])):l("",!0)]),r(h,{message:e.__(v)},null,8,["message"])])])])]),_:1},8,["validateFile"]),r(t(be),{as:"div",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=o=>y.value=o),tabs:Y,class:"flex flex-1 overflow-auto flex-col [&_[role='tablist']]:gap-7.5 [&_[role='tablist']]:px-4 [&_[role='tabpanel']:not([hidden])]:flex [&_[role='tabpanel']:not([hidden])]:grow"},{"tab-item":u(({tab:o,selected:v})=>[o.name!=="Details"?(i(),f("button",{key:0,class:T(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9",{"text-ink-gray-9":v}])},[o.icon?(i(),d(x(o.icon),{key:0,class:"h-5"})):l("",!0),j(" "+z(e.__(o.label))+" ",1),r(C,{class:T(["group-hover:bg-surface-gray-7",[v?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:u(()=>[j(z(o.count),1)]),_:2},1032,["class"])],2)):l("",!0)]),"tab-panel":u(({tab:o})=>[o.name=="Details"?(i(),f("div",Qe,[t(k).data?(i(),f("div",Ze,[r(se,{sections:t(k).data,doctype:"CRM Organization",docname:t(n).doc.name,onReload:t(k).reload},null,8,["sections","docname","onReload"])])):l("",!0)])):l("",!0),o.label==="Deals"&&b.value.length?(i(),d(me,{key:1,class:"mt-4",rows:b.value,columns:S.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):l("",!0),o.label==="Contacts"&&b.value.length?(i(),d(ce,{key:2,class:"mt-4",rows:b.value,columns:S.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):l("",!0),!b.value.length&&o.name!=="Details"?(i(),f("div",Ge,[m("div",He,[(i(),d(x(o.icon),{class:"!h-10 !w-10"})),m("div",null,z(e.__("No {0} Found",[e.__(o.label)])),1)])])):l("",!0)]),_:1},8,["modelValue"])])):l("",!0)],64)}}};export{Sa as default};
//# sourceMappingURL=MobileOrganization-451ee07f.js.map

import{F as A}from"./FieldLayout-fb4b14d5.js";import{i as B,E as D}from"./DragVerticalIcon-102ee32b.js";import{_ as N,L as Q,V as T,$ as q,M as F,l as E,T as L,a as O,E as M,r as y,b as m,g as p,w as P,e as l,t as R,u as i,A as v,d as k,a0 as S,aj as U}from"./index-e2619d50.js";import{u as $,s as z,a as G,c as H,q as J}from"./modals-b2235261.js";const K={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},W={class:"mb-5 flex items-center justify-between"},X={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},Y={class:"flex items-center gap-1"},Z={class:"px-4 pb-7 pt-4 sm:px-6"},ee={class:"space-y-2"},ae={__name:"ContactModal",props:Q({contact:{type:Object,default:{}},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const c=b,{isManager:w}=T(),x=q(),d=F(b,"modelValue"),_=E(!1),u=E(null),{document:a,triggerOnBeforeCreate:f}=$("Contact");async function V(){_.value=!0,u.value=null,a.doc.email_id&&(a.doc.email_ids=[{email_id:a.doc.email_id,is_primary:1}],delete a.doc.email_id),a.doc.mobile_no&&(a.doc.phone_nos=[{phone:a.doc.mobile_no,is_primary_mobile_no:1}],delete a.doc.mobile_no),await(f==null?void 0:f());const e=await S("frappe.client.insert",{doc:{doctype:"Contact",...a.doc}},{onError:t=>{var o,r;u.value=(r=(o=t.error)==null?void 0:o.messages)==null?void 0:r[0],_.value=!1}});e.name&&(U("contact_created"),I(e))}function I(e){var t,o;(o=(t=c.contact)==null?void 0:t.reload)==null||o.call(t),e.name&&c.options.redirect&&x.push({name:"Contact",params:{contactId:e.name}}),d.value=!1,c.options.afterInsert&&c.options.afterInsert(e)}const g=L({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","Contact"],params:{doctype:"Contact",type:"Quick Entry"},auto:!0,transform:e=>e.forEach(t=>{t.sections.forEach(o=>{o.columns.forEach(r=>{r.fields.forEach(s=>{s.fieldname=="email_id"||s.fieldname=="mobile_no"?s.read_only=!1:s.fieldname=="address"?(s.create=(n,C)=>{a.doc.address=n,h(),C()},s.edit=n=>h(n)):s.fieldtype==="Table"&&(a.doc[s.fieldname]=[])})})})})});O(()=>{a.doc={},Object.assign(a.doc,c.contact.data||c.contact)});function j(){H.value=!0,J.value={doctype:"Contact"},M(()=>d.value=!1)}function h(e){z.value=!0,G.value={doctype:"Address",address:e},M(()=>d.value=!1)}return(e,t)=>{const o=y("Button"),r=y("ErrorMessage"),s=y("Dialog");return m(),p(s,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),options:{size:"xl"}},{body:P(()=>{var n;return[l("div",K,[l("div",W,[l("div",null,[l("h3",X,R(e.__("New Contact")),1)]),l("div",Y,[i(w)()&&!i(B)?(m(),p(o,{key:0,variant:"ghost",class:"w-7",tooltip:e.__("Edit fields layout"),icon:D,onClick:j},null,8,["tooltip"])):v("",!0),k(o,{variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=C=>d.value=!1),icon:"x"})])]),(n=i(g).data)!=null&&n.length?(m(),p(A,{key:0,tabs:i(g).data,data:i(a).doc,doctype:"Contact"},null,8,["tabs","data"])):v("",!0),u.value?(m(),p(r,{key:1,class:"mt-8",message:e.__(u.value)},null,8,["message"])):v("",!0)]),l("div",Z,[l("div",ee,[k(o,{class:"w-full",variant:"solid",label:e.__("Create"),loading:_.value,onClick:V},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}},le=N(ae,[["__scopeId","data-v-4b8b7c64"]]);export{le as C};
//# sourceMappingURL=ContactModal-0d40eb8c.js.map

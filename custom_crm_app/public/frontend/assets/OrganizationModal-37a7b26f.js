import{F as V}from"./FieldLayout-2174b480.js";import{i as R,E as j}from"./DragVerticalIcon-aff1de89.js";import{L as I,V as A,$ as B,M as D,l as E,T as N,a as Q,r as _,b as m,g as f,w as T,e as n,t as q,u as c,A as y,d as k,a0 as F,aj as L,E as P}from"./index-cabbcd3b.js";import{u as S,s as U,a as $,c as G,q as H}from"./modals-9de9d8e1.js";const J={class:"px-4 pt-5 pb-6 bg-surface-modal sm:px-6"},K={class:"flex items-center justify-between mb-5"},W={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},X={class:"flex items-center gap-1"},Y={class:"px-4 pt-4 pb-7 sm:px-6"},Z={class:"space-y-2"},se={__name:"OrganizationModal",props:I({data:{type:Object,default:()=>({})},options:{type:Object,default:{redirect:!0,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(v){const d=v,{isManager:z}=A(),w=B(),i=D(v,"modelValue"),u=E(!1),p=E(null),{document:r,triggerOnBeforeCreate:g}=S("CRM Organization");async function O(){u.value=!0,p.value=null,await(g==null?void 0:g());const e=await F("frappe.client.insert",{doc:{doctype:"CRM Organization",...r.doc}},{onError:a=>{var t,l;p.value=(l=(t=a.error)==null?void 0:t.messages)==null?void 0:l[0],u.value=!1}});u.value=!1,e.name&&(L("organization_created"),C(e))}function C(e){e.name&&d.options.redirect&&w.push({name:"Organization",params:{organizationId:e.name}}),i.value=!1,d.options.afterInsert&&d.options.afterInsert(e)}const M=N({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["QuickEntry","CRM Organization"],params:{doctype:"CRM Organization",type:"Quick Entry"},auto:!0,transform:e=>e.forEach(a=>{a.sections.forEach(t=>{t.columns.forEach(l=>{l.fields.forEach(s=>{s.fieldname=="address"?(s.create=(o,h)=>{r.doc.address=o,b(),h()},s.edit=o=>b(o)):s.fieldtype==="Table"&&(r.doc[s.fieldname]=[])})})})})});Q(()=>{r.doc={no_of_employees:"1-10"},Object.assign(r.doc,d.data)});function x(){G.value=!0,H.value={doctype:"CRM Organization"},P(()=>i.value=!1)}function b(e){U.value=!0,$.value={doctype:"Address",address:e}}return(e,a)=>{const t=_("Button"),l=_("ErrorMessage"),s=_("Dialog");return m(),f(s,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=o=>i.value=o),options:{size:"xl"}},{body:T(()=>{var o;return[n("div",J,[n("div",K,[n("div",null,[n("h3",W,q(e.__("New Organization")),1)]),n("div",X,[c(z)()&&!c(R)?(m(),f(t,{key:0,variant:"ghost",class:"w-7",tooltip:e.__("Edit fields layout"),icon:j,onClick:x},null,8,["tooltip"])):y("",!0),k(t,{variant:"ghost",class:"w-7",onClick:a[0]||(a[0]=h=>i.value=!1),icon:"x"})])]),(o=c(M).data)!=null&&o.length?(m(),f(V,{key:0,tabs:c(M).data,data:c(r).doc,doctype:"CRM Organization"},null,8,["tabs","data"])):y("",!0),p.value?(m(),f(l,{key:1,class:"mt-8",message:e.__(p.value)},null,8,["message"])):y("",!0)]),n("div",Y,[n("div",Z,[k(t,{class:"w-full",variant:"solid",label:e.__("Create"),loading:u.value,onClick:O},null,8,["label","loading"])])])]}),_:1},8,["modelValue"])}}};export{se as _};
//# sourceMappingURL=OrganizationModal-37a7b26f.js.map

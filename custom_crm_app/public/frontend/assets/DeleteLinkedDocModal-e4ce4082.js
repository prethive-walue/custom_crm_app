import{l as R,y as X,x as K,aS as Z,o as ee,a as te,u as _,b as s,c as f,F as S,f as V,d as k,w as v,e as a,t as y,g,a2 as le,A as C,z as O,I as Q,r as A,Y as ne,n as se,L as oe,M as ae,$ as ie,T as re,ah as ce,Q as de,a0 as Y}from"./index-2806a214.js";import{e as ue,f as J,g as me,h as fe,L as ve,a as pe,b as _e,d as ye}from"./ListView-e7793134.js";const ke={key:0,class:"mx-3 mt-2 h-full overflow-y-auto sm:mx-5"},ge={class:"my-2 flex items-center gap-2 text-base font-medium text-ink-gray-8"},he={class:"flex items-center gap-1"},we={key:1,class:"text-ink-gray-4"},be={key:2},Ce={__name:"ListRows",props:{rows:{type:Array,required:!0},doctype:{type:String,default:"CRM Lead"}},setup(h){const p=h,w=R(p.rows);X(()=>p.rows,e=>w.value=e);let i=K(()=>p.rows.every(e=>e.group&&e.rows&&Array.isArray(e.rows)));const c=Z(`scrollPosition${p.doctype}`,0),o=R(null),r=()=>{o.value&&(c.value=o.value.$el.scrollTop)};return ee(()=>{o.value&&o.value.$el.removeEventListener("scroll",r)}),te(()=>{o.value&&(o.value.$el.addEventListener("scroll",r),o.value.$el.scrollTop=c.value)}),(e,u)=>_(i)?(s(),f("div",ke,[(s(!0),f(S,null,V(w.value,l=>(s(),f("div",{key:l.group},[k(_(ue),{group:l},{default:v(()=>[a("div",ge,[a("div",null,y(e.__(l.label))+" -",1),a("div",he,[l.icon?(s(),g(le(l.icon),{key:0})):C("",!0),l.group==" "?(s(),f("div",we,y(e.__("Empty")),1)):(s(),f("div",be,y(l.group),1))])])]),_:2},1032,["group"]),k(_(me),{group:l},{default:v(()=>[(s(!0),f(S,null,V(l.rows,d=>(s(),g(_(J),{key:d.name,row:d},{default:v(({idx:x,column:b,item:D})=>[O(e.$slots,"default",Q({ref_for:!0},{idx:x,column:b,item:D,row:d}))]),_:2},1032,["row"]))),128))]),_:2},1032,["group"])]))),128))])):(s(),g(_(fe),{key:1,ref_key:"scrollContainer",ref:o,class:"mx-3 sm:mx-5",onScroll:r},{default:v(()=>[(s(!0),f(S,null,V(w.value,l=>(s(),g(_(J),{key:l.name,row:l},{default:v(({idx:d,column:x,item:b})=>[O(e.$slots,"default",Q({ref_for:!0},{idx:d,column:x,item:b,row:l}))]),_:2},1032,["row"]))),128))]),_:3},512))}},xe={class:"*:mx-0 *:sm:mx-0"},$e={key:0,class:"truncate text-base flex gap-2 w-full"},De={class:"max-w-[90%] truncate"},Le={key:1,class:"truncate text-base flex gap-2"},Re={__name:"LinkedDocsListView",props:{rows:{type:Array,required:!0},columns:{type:Array,required:!0},linkedDocsResource:{type:Object,required:!0},unlinkLinkedDoc:{type:Function,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},emits:["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],setup(h,{emit:p}){const w=p,i=R(null),c=r=>{let e="",u="",l=!1;switch(r.reference_doctype){case"CRM Lead":e="leads",u=r.reference_docname;break;case"CRM Call Log":e="call-logs",u=`view?open=${r.reference_docname}`;break;case"CRM Task":e="tasks",u=`view?open=${r.reference_docname}`;break;case"Contact":e="contacts",u=r.reference_docname;break;case"CRM Organization":e="organizations",u=r.reference_docname;break;case"CRM Notification":e="crm-notification",u=r.reference_docname,l=!0;break;case"FCRM Note":e="notes",u=`view?open=${r.reference_docname}`;break}let d="/crm";l&&(d="/app"),window.open(`${d}/${e}/${u}`)},o=r=>r.replace(/^(CRM|FCRM)\s*/,"");return(r,e)=>{const u=A("FeatherIcon");return s(),g(_(ye),{class:se(r.$attrs.class),columns:h.columns,rows:h.rows,options:{selectable:!0,showTooltip:!0,resizeColumn:!0},"row-key":"reference_docname","onUpdate:selections":e[1]||(e[1]=l=>w("selectionsChanged",l)),ref_key:"listViewRef",ref:i},{default:v(()=>[k(_(ve),{onColumnWidthUpdated:e[0]||(e[0]=l=>w("columnWidthUpdated"))},{default:v(()=>[(s(!0),f(S,null,V(h.columns,l=>(s(),g(_(pe),{key:l.key,item:l,onColumnWidthUpdated:d=>w("columnWidthUpdated",l)},null,8,["item","onColumnWidthUpdated"]))),128))]),_:1}),a("div",xe,[k(Ce,{rows:h.rows},{default:v(({idx:l,column:d,item:x,row:b})=>[k(_(_e),{item:x,onClick:D=>i.value.toggleRow(b.reference_docname),class:"!w-full"},{default:v(({label:D})=>[d.key==="title"?(s(),f("div",$e,[a("span",De,y(D),1),k(u,{name:"external-link",class:"h-4 w-4 cursor-pointer",onClick:ne(t=>c(b),["stop"])},null,8,["onClick"])])):C("",!0),d.key==="reference_doctype"?(s(),f("span",Le,y(o(b.reference_doctype)),1)):C("",!0)]),_:2},1032,["item","onClick"])]),_:1},8,["rows"])])]),_:1},8,["class","columns","rows"])}}},Me={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Se={class:"mb-6 flex items-center justify-between"},Ve={class:"text-2xl leading-6 text-ink-gray-9 font-semibold"},Ue={class:"flex items-center gap-1"},Ae={key:0},Fe={class:"text-ink-gray-5 text-base"},qe={key:1,class:"text-ink-gray-5 text-base"},ze={class:"px-4 pb-7 pt-0 sm:px-6"},Be={class:"flex flex-row-reverse gap-2"},Ne={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Te={class:"mb-6 flex items-center justify-between"},Ie={class:"text-2xl leading-6 text-ink-gray-9 font-semibold"},We={class:"flex items-center gap-1"},je={class:"text-ink-gray-5 text-base"},Ee={class:"flex justify-end gap-2 mt-6"},He={__name:"DeleteLinkedDocModal",props:oe({name:{type:String,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0},reload:{type:Function}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(h){const p=ae(h,"modelValue"),w=ie(),i=h,c=R({selections:[],updateSelections:t=>{c.value.selections=Array.from(t||[])}}),o=R({show:!1,title:""}),r=re({url:"crm.api.doc.get_linked_docs_of_document",params:{doctype:i.doctype,docname:i.docname},auto:!0,validate(t){if(!(t!=null&&t.doctype)||!(t!=null&&t.docname))return!1}}),e=K(()=>{var t;return((t=r.data)==null?void 0:t.map(n=>({id:n.reference_docname,...n})))||[]}),u=()=>{o.value.show=!1,c.value.updateSelections([])},l=t=>{let n=[];c.value.selections.length>0?Array.from(c.value.selections).forEach(m=>{const M=e.value.find(U=>U.id==m);n.push({doctype:M.reference_doctype,docname:M.reference_docname})}):n=e.value.map(m=>({doctype:m.reference_doctype,docname:m.reference_docname})),Y("crm.api.doc.remove_linked_doc_reference",{items:n,remove_contact:i.doctype=="Contact",delete:t.delete}).then(()=>{r.reload(),o.value={show:!1,title:""}})},d=()=>{const t=c.value.selections.length==0?"all":c.value.selections.length;o.value={show:!0,title:__("Delete linked item"),message:__("Are you sure you want to delete {0} linked item(s)?",[t]),delete:!0}},x=()=>{const t=c.value.selections.length==0?"all":c.value.selections.length;o.value={show:!0,title:__("Unlink linked item"),message:__("Are you sure you want to unlink {0} linked item(s)?",[t]),delete:!1}},b=()=>{l({reference_doctype:i.doctype,reference_docname:i.docname,delete:o.value.delete}),c.value.updateSelections([])},D=async()=>{var t;await Y("frappe.client.delete",{doctype:i.doctype,name:i.docname}),w.push({name:i.name}),(t=i==null?void 0:i.reload)==null||t.call(i)};return(t,n)=>{const m=A("Button"),M=Re,U=A("Dialog");return s(),g(U,{modelValue:p.value,"onUpdate:modelValue":n[8]||(n[8]=$=>p.value=$),options:{size:"xl"}},ce({_:2},[o.value.show?void 0:{name:"body",fn:v(()=>{var $,F,q,z,B,N,T,I,W,j,E,P,G,H;return[a("div",Me,[a("div",Se,[a("div",null,[a("h3",Ve,y((($=e.value)==null?void 0:$.length)==0?t.__("Delete"):t.__("Delete or unlink linked documents")),1)]),a("div",Ue,[k(m,{variant:"ghost",icon:"x",onClick:n[0]||(n[0]=L=>p.value=!1)})])]),a("div",null,[((F=e.value)==null?void 0:F.length)>0?(s(),f("div",Ae,[a("span",Fe,y(t.__("Delete or unlink these linked documents before deleting this document")),1),k(M,{class:"mt-4",rows:e.value,columns:[{label:"Document",key:"title",width:"19rem"},{label:"Master",key:"reference_doctype",width:"12rem"}],onSelectionsChanged:n[1]||(n[1]=L=>c.value.updateSelections(L)),linkedDocsResource:_(r),unlinkLinkedDoc:l},null,8,["rows","linkedDocsResource"])])):C("",!0),((q=e.value)==null?void 0:q.length)==0?(s(),f("div",qe,y(t.__("Are you sure you want to delete {0} - {1}?",[i.doctype,i.docname])),1)):C("",!0)])]),a("div",ze,[a("div",Be,[((z=e.value)==null?void 0:z.length)>0?(s(),g(m,{key:0,label:((N=(B=c.value)==null?void 0:B.selections)==null?void 0:N.length)==0?t.__("Delete all"):t.__("Delete {0} item(s)",[(I=(T=c.value)==null?void 0:T.selections)==null?void 0:I.length]),theme:"red",variant:"solid","icon-left":"trash-2",onClick:n[2]||(n[2]=L=>d())},null,8,["label"])):C("",!0),((W=e.value)==null?void 0:W.length)>0?(s(),g(m,{key:1,label:((E=(j=c.value)==null?void 0:j.selections)==null?void 0:E.length)==0?t.__("Unlink all"):t.__("Unlink {0} item(s)",[(G=(P=c.value)==null?void 0:P.selections)==null?void 0:G.length]),variant:"subtle",theme:"gray","icon-left":"unlock",onClick:n[3]||(n[3]=L=>x())},null,8,["label"])):C("",!0),((H=e.value)==null?void 0:H.length)==0?(s(),g(m,{key:2,variant:"solid","icon-left":"trash-2",label:t.__("Delete"),loading:t.isDealCreating,onClick:n[4]||(n[4]=L=>D()),theme:"red"},null,8,["label","loading"])):C("",!0)])])]}),key:"0"},o.value.show?{name:"body",fn:v(()=>[a("div",Ne,[a("div",Te,[a("div",null,[a("h3",Ie,y(o.value.title),1)]),a("div",We,[k(m,{variant:"ghost",icon:"x",onClick:n[5]||(n[5]=$=>p.value=!1)})])]),a("div",je,y(o.value.message),1),a("div",Ee,[k(m,{variant:"ghost",onClick:n[6]||(n[6]=$=>u())},{default:v(()=>[de(y(t.__("Cancel")),1)]),_:1}),k(m,{variant:"solid",label:o.value.title,onClick:n[7]||(n[7]=$=>b()),theme:"red"},null,8,["label"])])])]),key:"1"}:void 0]),1032,["modelValue"])}}};export{Ce as _,He as a};
//# sourceMappingURL=DeleteLinkedDocModal-e4ce4082.js.map

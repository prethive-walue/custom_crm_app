import{a as fe}from"./DeleteLinkedDocModal-2f772df1.js";import{_ as ge}from"./ErrorPage-2bedf0d0.js";import{_ as ye}from"./Resizer-a94cd463.js";import{_ as ve}from"./Icon-055466fe.js";import{g as be,S as he}from"./view-762c8038.js";import{_ as we}from"./LayoutHeader-75f767c4.js";import{P as ke}from"./PhoneIcon-4ddbc1c6.js";import{C as Ce}from"./CameraIcon-4a3a6dff.js";import{D as xe}from"./DealsIcon-e125551e.js";import{_ as De}from"./DealsListView-bfd688c4.js";import{_ as ze}from"./CustomActions-d50b282d.js";import{b as U,f as Se,t as $e,a as Q,v as Ie,s as Me}from"./index-f89ab1a2.js";import{u as Ve,s as Te,a as Pe,_ as Re}from"./modals-9de9d8e1.js";import{g as Fe}from"./settings-96940d27.js";import{g as qe}from"./global-70f001c5.js";import{V as Ae,W as Be,$ as Ne,l as S,x as f,Z as Ee,T as W,y as je,r as I,b as l,c as b,u as s,g as m,w as u,A as r,d as _,F as Le,a0 as C,a1 as g,e as c,a2 as M,I as Oe,t as h,Q as Z,n as G}from"./index-cabbcd3b.js";import{o as Ue}from"./organizations-cb7899b2.js";import{s as Qe}from"./statuses-22e0626e.js";import{c as H}from"./DragVerticalIcon-aff1de89.js";import{u as We}from"./pageMeta-0876c8ba.js";import{_ as Ze}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-d58e93c2.js";import{F as Ge}from"./FileUploader-a8afdc15.js";import{D as He}from"./dayjs-5605a8d0.js";import"./ListView-9b64d85d.js";import"./FadedScrollableDiv-89d978f8.js";import"./ArrowUpRightIcon-98a812be.js";import"./Link-a9220984.js";import"./ListBulkActions-a1668bc5.js";import"./MultipleAvatar-40aa338e.js";import"./IndicatorIcon-80bfb72e.js";import"./ListFooter-7455008c.js";import"./TabButtons-1eebf54c.js";import"./description-cb94866a.js";import"./plus-5cd6d2a0.js";import"./fileUploadHandler-0b2042a3.js";const Je={key:1,ref:"parentRef",class:"flex h-full"},Ke={class:"border-b"},Xe={class:"flex flex-col items-start justify-start gap-4 p-5"},Ye={class:"flex gap-4 items-center"},ea={class:"group relative h-15.5 w-15.5"},aa={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},ta={class:"flex flex-col gap-2 truncate text-ink-gray-9"},oa={class:"truncate text-2xl font-medium"},sa={key:0},na={key:0,class:"flex items-center gap-1.5 text-base text-ink-gray-8"},la={class:""},ia={class:"flex gap-1.5"},ra={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},ca={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-ink-gray-4"},da={class:"flex flex-col items-center justify-center space-y-3"},Wa={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(J){const{brand:K}=Fe(),{makeCall:X,$dialog:Y,$socket:ee}=qe(),{getUser:V}=Ae(),{getOrganization:T}=Ue(),{getDealStatus:ae}=Qe(),{doctypeMeta:te}=U("Contact"),w=J,y=Be(),oe=Ne(),P=S(""),se=S(""),{document:a,permissions:ne,scripts:R}=Ve("Contact",w.contactId),le=f(()=>{var e,o;return((o=(e=ne.data)==null?void 0:e.permissions)==null?void 0:o.delete)||!1}),ie=f(()=>{let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(y.query.view||y.query.viewType){let o=be(y.query.view,y.query.viewType,"Contact");o&&e.push({label:__(o.label),icon:o.icon,route:{name:"Contacts",params:{viewType:y.query.viewType},query:{view:y.query.view}}})}return e.push({label:F.value,route:{name:"Contact",params:{contactId:w.contactId}}}),e}),F=f(()=>{var o,n;let e=((o=te.Contact)==null?void 0:o.title_field)||"name";return((n=a.doc)==null?void 0:n[e])||w.contactId});We(()=>({title:F.value,icon:K.favicon}));const x=S(!1);async function q(){x.value=!0}function A(e){a.doc.image=(e==null?void 0:e.file_url)||"",a.save.submit(null,{onSuccess:()=>{g.success(__("Contact image updated"))}})}const B=S(0),re=[{label:"Deals",icon:Ee(xe,{class:"h-4 w-4"}),count:f(()=>{var e;return(e=D.data)==null?void 0:e.length})}],D=W({url:"crm.api.contact.get_linked_deals",cache:["deals",w.contactId],params:{contact:w.contactId},auto:!0}),$=f(()=>!D.data||D.data==[]?[]:D.data.map(e=>ue(e))),z=W({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_sidepanel_sections",cache:["sidePanelSections","Contact"],params:{doctype:"Contact"},auto:!0}),ce=f(()=>z.data?z.data.map(e=>({...e,columns:e.columns.map(o=>({...o,fields:o.fields.map(n=>{var p,k;return n.fieldname==="email_id"?{...n,read_only:!1,fieldtype:"Dropdown",options:(((p=a.doc)==null?void 0:p.email_ids)||[]).map(i=>({name:i.name,value:i.email_id,selected:i.email_id===a.doc.email_id,placeholder:"john@doe.com",onClick:()=>N("email",i.email_id),onSave:(t,d)=>d?E("email",t.value):j("Contact Email",t.name,"email_id",t.value),onDelete:async(t,d)=>{a.doc.email_ids=a.doc.email_ids.filter(v=>v.name!==t.name),d||await L("Contact Email",t.name)}})),create:()=>{a.doc.email_ids=[...a.doc.email_ids||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:n.fieldname==="mobile_no"?{...n,read_only:!1,fieldtype:"Dropdown",options:(((k=a.doc)==null?void 0:k.phone_nos)||[]).map(i=>({name:i.name,value:i.phone,selected:i.phone===a.doc.mobile_no,onClick:()=>N("mobile_no",i.phone),onSave:(t,d)=>d?E("phone",t.value):j("Contact Phone",t.name,"phone",t.value),onDelete:async(t,d)=>{a.doc.phone_nos=a.doc.phone_nos.filter(v=>v.name!==t.name),d||await L("Contact Phone",t.name)}})),create:()=>{a.doc.phone_nos=[...a.doc.phone_nos||[],{name:"new-1",value:"",selected:!1,isNew:!0}]}}:n.fieldname==="address"?{...n,create:(i,t)=>{O(),t&&t()},edit:i=>O(i)}:n})}))})):[]);async function N(e,o){await C("crm.api.contact.set_as_primary",{contact:a.doc.name,field:e,value:o})&&(a.reload(),g.success(__("Contact updated")))}async function E(e,o){if(!o)return;await C("crm.api.contact.create_new",{contact:a.doc.name,field:e,value:o})&&(a.reload(),g.success(__("Contact updated")))}async function j(e,o,n,p){await C("frappe.client.set_value",{doctype:e,name:o,fieldname:n,value:p})&&(a.reload(),g.success(__("Contact updated")))}async function L(e,o){await C("frappe.client.delete",{doctype:e,name:o}),await a.reload(),g.success(__("Contact updated"))}const{getFormattedCurrency:de}=U("CRM Deal"),me=f(()=>_e);function ue(e){var o,n;return{name:e.name,organization:{label:e.organization,logo:(o=T(e.organization))==null?void 0:o.organization_logo},annual_revenue:de("annual_revenue",e),status:{label:e.status,color:(n=ae(e.status))==null?void 0:n.color},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&V(e.deal_owner).full_name,...e.deal_owner&&V(e.deal_owner)},modified:{label:Se(e.modified),timeAgo:__($e(e.modified))}}}const _e=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",align:"right",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];function O(e){Te.value=!0,Pe.value={doctype:"Address",address:e}}return je(()=>a.doc,async e=>{var o;if((o=R.data)!=null&&o.length){let n=await Me(R.data,{doc:e,$dialog:Y,$socket:ee,router:oe,toast:g,updateField:a.setValue.submit,createToast:g.create,deleteDoc:q,call:C});a._actions=n.actions||[]}},{once:!0}),(e,o)=>{const n=I("ErrorMessage"),p=I("Button"),k=I("Badge"),i=fe;return l(),b(Le,null,[s(a).doc?(l(),m(we,{key:0},{"left-header":u(()=>[_(s(Ze),{items:ie.value},{prefix:u(({item:t})=>[t.icon?(l(),m(ve,{key:0,icon:t.icon,class:"mr-2 h-4"},null,8,["icon"])):r("",!0)]),_:1},8,["items"])]),"right-header":u(()=>{var t;return[(t=s(a)._actions)!=null&&t.length?(l(),m(ze,{key:0,actions:s(a)._actions},null,8,["actions"])):r("",!0)]}),_:1})):r("",!0),s(a).doc?(l(),b("div",Je,[s(a).doc?(l(),m(ye,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:u(()=>[c("div",Ke,[_(s(Ge),{onSuccess:A,validateFile:s(Ie)},{default:u(({openFileSelector:t,error:d})=>{var v;return[c("div",Xe,[c("div",Ye,[c("div",ea,[_(s(Q),{size:"3xl",class:"h-15.5 w-15.5",label:s(a).doc.full_name,image:s(a).doc.image},null,8,["label","image"]),(l(),m(M(s(a).doc.image?s(He):"div"),Oe(s(a).doc.image?{options:[{icon:"upload",label:s(a).doc.image?e.__("Change image"):e.__("Upload image"),onClick:t},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>A("")}]}:{onClick:t},{class:"!absolute bottom-0 left-0 right-0"}),{default:u(()=>[c("div",aa,[_(Ce,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:1},16))]),c("div",ta,[c("div",oa,[s(a).doc.salutation?(l(),b("span",sa,h(s(a).doc.salutation+". "),1)):r("",!0),c("span",null,h(s(a).doc.full_name),1)]),s(a).doc.company_name?(l(),b("div",na,[_(s(Q),{size:"xs",label:s(a).doc.company_name,image:(v=s(T)(s(a).doc.company_name))==null?void 0:v.organization_logo},null,8,["label","image"]),c("span",la,h(s(a).doc.company_name),1)])):r("",!0),_(n,{message:e.__(d)},null,8,["message"])])]),c("div",ia,[s(H)&&s(a).doc.mobile_no?(l(),m(p,{key:0,label:e.__("Make Call"),size:"sm",iconLeft:ke,onClick:o[0]||(o[0]=pe=>s(H)&&s(X)(s(a).doc.mobile_no))},null,8,["label"])):r("",!0),le.value?(l(),m(p,{key:1,label:e.__("Delete"),theme:"red",size:"sm",iconLeft:"trash-2",onClick:o[1]||(o[1]=pe=>q())},null,8,["label"])):r("",!0)])])]}),_:1},8,["validateFile"])]),s(z).data?(l(),b("div",ra,[_(he,{sections:ce.value,doctype:"Contact",docname:s(a).doc.name,onReload:s(z).reload},null,8,["sections","docname","onReload"])])):r("",!0)]),_:1},8,["parent"])):r("",!0),_(s(Re),{as:"div",modelValue:B.value,"onUpdate:modelValue":o[2]||(o[2]=t=>B.value=t),tabs:re,class:"flex flex-1 overflow-hidden flex-col [&_[role='tab']]:px-0 [&_[role='tablist']]:px-5 [&_[role='tablist']]:gap-7.5 [&_[role='tabpanel']:not([hidden])]:flex [&_[role='tabpanel']:not([hidden])]:grow"},{"tab-item":u(({tab:t,selected:d})=>[c("button",{class:G(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-ink-gray-5 duration-300 ease-in-out hover:text-ink-gray-9",{"text-ink-gray-9":d}])},[t.icon?(l(),m(M(t.icon),{key:0,class:"h-5"})):r("",!0),Z(" "+h(e.__(t.label))+" ",1),_(k,{class:G(["group-hover:bg-surface-gray-7",[d?"bg-surface-gray-7":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:u(()=>[Z(h(t.count),1)]),_:2},1032,["class"])],2)]),"tab-panel":u(({tab:t})=>[t.label==="Deals"&&$.value.length?(l(),m(De,{key:0,class:"mt-4",rows:$.value,columns:me.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):r("",!0),$.value.length?r("",!0):(l(),b("div",ca,[c("div",da,[(l(),m(M(t.icon),{class:"!h-10 !w-10"})),c("div",null,h(e.__("No {0} Found",[e.__(t.label)])),1)])]))]),_:1},8,["modelValue"])],512)):P.value?(l(),m(ge,{key:2,errorTitle:P.value,errorMessage:se.value},null,8,["errorTitle","errorMessage"])):r("",!0),x.value?(l(),m(i,{key:3,modelValue:x.value,"onUpdate:modelValue":o[3]||(o[3]=t=>x.value=t),doctype:"Contact",docname:s(a).doc.name,name:"Contacts"},null,8,["modelValue","docname"])):r("",!0)],64)}}};export{Wa as default};
//# sourceMappingURL=Contact-c08f1e46.js.map

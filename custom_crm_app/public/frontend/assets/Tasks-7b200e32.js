import{L as Q,M as Z,x as E,X as ne,y as ie,l as L,r as W,b as o,c as d,d as l,w as m,u as v,F as H,f as re,g as b,n as N,A as _,U as P,e as h,t as M,Y,V as ue,$ as de,a0 as pe}from"./index-2806a214.js";import{_ as ce}from"./ViewBreadcrumbs-210172f8.js";import{_ as me}from"./CustomActions-587c3ded.js";import{A as fe}from"./ArrowUpRightIcon-7aa2e409.js";import{f as S,i as j,h as K,a as q,b as ke,t as ve}from"./index-9b4a43f5.js";import{E as ye}from"./Email2Icon-946daaf6.js";import{_ as _e}from"./LayoutHeader-2c6fb6af.js";import{_ as ge}from"./ViewControls-96185e1e.js";import{H as ee,_ as Ce}from"./ListBulkActions-4a774f9d.js";import{C as be}from"./CalendarIcon-3da65990.js";import{_ as we}from"./DeleteLinkedDocModal-e4ce4082.js";import{L as he,a as xe,b as Le,c as Me,d as Ve}from"./ListView-e7793134.js";import{L as Te}from"./ListFooter-8e8d28aa.js";import{D as te}from"./dayjs-40d38903.js";import{_ as $e}from"./KanbanView-47c56ae5.js";import{T as Ue}from"./TaskModal-52bcf7e2.js";import{_ as Re}from"./settings-979c7d03.js";import"./Icon-caaa25f5.js";import"./DragVerticalIcon-c67f7b20.js";import"./Link-472bc4cc.js";import"./FadedScrollableDiv-c128293b.js";import"./RefreshIcon-e544e61b.js";import"./IconPicker-b2b66c61.js";import"./PinIcon-1db1a299.js";import"./DateRangePicker.vue_vue_type_script_setup_true_lang-9e05c0ee.js";import"./DetailsIcon-f1678fde.js";import"./global-675ae1af.js";import"./pageMeta-ec5fe886.js";import"./TabButtons-1c70c2d8.js";import"./description-6463fb61.js";import"./IndicatorIcon-69bb1f75.js";import"./onboarding-d2b14cdb.js";import"./plus-ad0e20b1.js";const Ae={key:0},De={class:"flex items-center gap-2 truncate text-base"},ze={key:0,class:"truncate"},Be={key:0},Pe={key:1},Se={key:2},Fe=["onClick"],Ie=["innerHTML"],Ee={key:2},We={key:3},He=["onClick"],Ye={__name:"TasksListView",props:Q({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:Q(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc","selectionsChanged"],["update:modelValue","update:list"]),setup(g,{expose:F,emit:I}){const w=I,R=Z(g,"modelValue"),z=Z(g,"list"),B=E(()=>{var y,n;return!!((n=(y=z.value.params)==null?void 0:y.filters)!=null&&n._liked_by)}),{user:r}=ne();function A(y){if(y)return JSON.parse(y).includes(r)}ie(R,(y,n)=>{y!==n&&w("updatePageCount",y)});const $=L(null);return F({customListActions:E(()=>{var y;return(y=$.value)==null?void 0:y.customListActions})}),(y,n)=>{const i=W("Button"),V=W("FormControl");return o(),d(H,null,[l(v(Ve),{columns:g.columns,rows:g.rows,options:{onRowClick:c=>w("showTask",c.name),selectable:g.options.selectable,showTooltip:g.options.showTooltip,resizeColumn:g.options.resizeColumn},"row-key":"name","onUpdate:selections":n[2]||(n[2]=c=>w("selectionsChanged",c))},{default:m(()=>[l(v(he),{class:"mx-3 sm:mx-5",onColumnWidthUpdated:n[1]||(n[1]=c=>w("columnWidthUpdated"))},{default:m(()=>[(o(!0),d(H,null,re(g.columns,c=>(o(),b(v(xe),{key:c.key,item:c,onColumnWidthUpdated:f=>w("columnWidthUpdated",c)},{default:m(()=>[c.key=="_liked_by"?(o(),b(i,{key:0,variant:"ghosted",class:N(["!h-4",B.value?"fill-red-500":"fill-white"]),onClick:n[0]||(n[0]=()=>w("applyLikeFilter"))},{default:m(()=>[l(ee,{class:"h-4 w-4"})]),_:1},8,["class"])):_("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),l(we,{class:"mx-3 sm:mx-5",rows:g.rows,doctype:"CRM Task"},{default:m(({idx:c,column:f,item:p})=>[f.key==="due_date"?(o(),d("div",Ae,[l(v(P),{text:p&&v(S)(p,"ddd, MMM D, YYYY | hh:mm a")},{default:m(()=>[h("div",De,[h("div",null,[l(be)]),p?(o(),d("div",ze,M(v(S)(p,"D MMM, hh:mm a")),1)):_("",!0)])]),_:2},1032,["text"])])):(o(),b(v(Le),{key:1,item:p,align:f.align},{prefix:m(()=>[f.key==="status"?(o(),d("div",Be,[l(j,{status:p},null,8,["status"])])):f.key==="priority"?(o(),d("div",Pe,[l(K,{priority:p},null,8,["priority"])])):f.key==="assigned_to"?(o(),d("div",Se,[p.full_name?(o(),b(v(q),{key:0,class:"flex items-center",image:p.user_image,label:p.full_name,size:"sm"},null,8,["image","label"])):_("",!0)])):_("",!0)]),default:m(({label:D})=>[["modified","creation"].includes(f.key)?(o(),d("div",{key:0,class:"truncate text-base",onClick:U=>w("applyFilter",{event:U,idx:c,column:f,item:p,firstColumn:g.columns[0]})},[l(v(P),{text:p.label},{default:m(()=>[h("div",null,M(p.timeAgo),1)]),_:2},1032,["text"])],8,Fe)):f.type==="Text Editor"?(o(),d("div",{key:1,innerHTML:p,class:"truncate text-base h-4 [&>p]:truncate"},null,8,Ie)):f.type==="Check"?(o(),d("div",Ee,[l(V,{type:"checkbox",modelValue:p,disabled:!0,class:"text-ink-gray-9"},null,8,["modelValue"])])):f.key==="_liked_by"?(o(),d("div",We,[f.key=="_liked_by"?(o(),b(i,{key:0,variant:"ghosted",class:N(A(p)?"fill-red-500":"fill-white"),onClick:Y(()=>w("likeDoc",{name:y.row.name,liked:A(p)}),["stop","prevent"])},{default:m(()=>[l(ee,{class:"h-4 w-4"})]),_:1},8,["class","onClick"])):_("",!0)])):(o(),d("div",{key:4,class:"truncate text-base",onClick:U=>w("applyFilter",{event:U,idx:c,column:f,item:p,firstColumn:g.columns[0]})},M(D),9,He))]),_:2},1032,["item","align"]))]),_:1},8,["rows"]),l(v(Me),null,{actions:m(({selections:c,unselectAll:f})=>[l(v(te),{options:$.value.bulkActions(c,f)},{default:m(()=>[l(i,{icon:"more-horizontal",variant:"ghost"})]),_:1},8,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),l(v(Te),{class:"border-t px-3 py-2 sm:px-5",modelValue:R.value,"onUpdate:modelValue":n[3]||(n[3]=c=>R.value=c),options:{rowCount:g.options.rowCount,totalCount:g.options.totalCount},onLoadMore:n[4]||(n[4]=c=>w("loadMore"))},null,8,["modelValue","options"]),l(Ce,{ref_key:"listBulkActionsRef",ref:$,modelValue:z.value,"onUpdate:modelValue":n[5]||(n[5]=c=>z.value=c),doctype:"CRM Task",options:{hideAssign:!0}},null,8,["modelValue"])],64)}}},je={class:"flex items-center gap-2"},Ke={key:0},qe={key:1},Oe={key:2},Je={key:3,class:"truncate text-base"},Xe={key:4,class:"truncate text-base"},Ge={key:5,class:"text-ink-gray-4"},Qe={key:0,class:"truncate flex items-center gap-2"},Ze={key:0},Ne={key:1},et={key:2},tt={key:3,class:"truncate text-base"},ot={key:4,class:"truncate text-base max-h-44"},at={key:5,class:"truncate text-base"},st={class:"flex gap-2 items-center justify-between"},lt={key:2,class:"flex h-full items-center justify-center"},nt={class:"flex flex-col items-center gap-3 text-xl font-medium text-ink-gray-4"},Et={__name:"Tasks",setup(g){const{getFormattedPercent:F,getFormattedFloat:I,getFormattedCurrency:w}=ke("CRM Task"),{getUser:R}=ue(),z=de(),B=L(null),r=L({}),A=L(1),$=L(1),y=L(20),n=L(null);function i(s,t){var e;function u(a){return a&&typeof a=="object"?a:{label:a}}return u((e=V.value)==null?void 0:e.find(a=>a.name==s)[t])}const V=E(()=>{var s,t,u,e;return(t=(s=r.value)==null?void 0:s.data)!=null&&t.data?r.value.data.view_type==="kanban"?c(r.value.data.data,r.value.data.fields):(le(),f((u=r.value)==null?void 0:u.data.data,(e=r.value)==null?void 0:e.data.columns)):[]});function c(s,t){let u=[];return s.forEach(e=>{var a;(a=e.data)==null||a.forEach(C=>{u.push(C)})}),f(u,t)}function f(s,t=[]){let u=r.value.data.view_type,e=u==="kanban"?"fieldname":"key",a=u==="kanban"?"fieldtype":"type";return s.map(C=>{var J;let T={};return(J=r.value)==null||J.data.rows.forEach(k=>{var X;T[k]=C[k];let x=(X=t==null?void 0:t.find(G=>(G[e]||G.value)==k))==null?void 0:X[a];x&&["Date","Datetime"].includes(x)&&!["modified","creation","due_date"].includes(k)&&(T[k]=S(C[k],"",!0,x=="Datetime")),x&&x=="Currency"&&(T[k]=w(k,C)),x&&x=="Float"&&(T[k]=I(k,C)),x&&x=="Percent"&&(T[k]=F(k,C)),["modified","creation"].includes(k)?T[k]={label:S(C[k]),timeAgo:__(ve(C[k]))}:k=="assigned_to"&&(T[k]={label:C.assigned_to&&R(C.assigned_to).full_name,...C.assigned_to&&R(C.assigned_to)})}),T})}const p=L(!1),D=L({name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function U(s){var u,e;let t=(u=V.value)==null?void 0:u.find(a=>a.name===s);D.value={name:t.name,title:t.title,description:t.description,assigned_to:((e=t.assigned_to)==null?void 0:e.email)||"",due_date:t.due_date,status:t.status,priority:t.priority,reference_doctype:t.reference_doctype,reference_docname:t.reference_docname},p.value=!0}function O(s){var t;if(D.value={name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},(t=s.column)!=null&&t.name){let u=r.value.params.column_field;u&&(D.value[u]=s.column.name)}p.value=!0}function oe(s){return[{label:__("Delete"),icon:"trash-2",onClick:()=>{ae(s),r.value.reload()}}]}async function ae(s){await pe("frappe.client.delete",{doctype:"CRM Task",name:s})}function se(s,t){if(!t)return;let u=s=="CRM Deal"?"Deal":"Lead",e={leadId:t};u=="Deal"&&(e={dealId:t}),z.push({name:u,params:e})}const le=()=>{var u;const s=new URLSearchParams(window.location.search),t=s.get("open");t&&((u=V.value)!=null&&u.length)&&(U(parseInt(t)),s.delete("open"),window.history.replaceState(null,"",window.location.pathname))};return(s,t)=>{const u=W("Button");return o(),d(H,null,[l(_e,null,{"left-header":m(()=>[l(ce,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),routeName:"Tasks"},null,8,["modelValue"])]),"right-header":m(()=>{var e;return[(e=B.value)!=null&&e.customListActions?(o(),b(me,{key:0,actions:B.value.customListActions},null,8,["actions"])):_("",!0),l(u,{variant:"solid",label:s.__("Create"),iconLeft:"plus",onClick:O},null,8,["label"])]}),_:1}),l(ge,{ref_key:"viewControls",ref:n,modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e),loadMore:A.value,"onUpdate:loadMore":t[2]||(t[2]=e=>A.value=e),resizeColumn:$.value,"onUpdate:resizeColumn":t[3]||(t[3]=e=>$.value=e),updatedPageCount:y.value,"onUpdate:updatedPageCount":t[4]||(t[4]=e=>y.value=e),doctype:"CRM Task",options:{allowedViews:["list","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),s.$route.params.viewType=="kanban"&&V.value.length?(o(),b($e,{key:0,modelValue:r.value,"onUpdate:modelValue":t[6]||(t[6]=e=>r.value=e),options:{onClick:e=>U(e.name),onNewClick:e=>O(e)},onUpdate:t[7]||(t[7]=e=>n.value.updateKanbanSettings(e)),onLoadMore:t[8]||(t[8]=e=>n.value.loadMoreKanban(e))},{title:m(({titleField:e,itemName:a})=>[h("div",je,[e==="status"?(o(),d("div",Ke,[l(j,{status:i(a,e).label},null,8,["status"])])):e==="priority"?(o(),d("div",qe,[l(K,{priority:i(a,e).label},null,8,["priority"])])):e==="assigned_to"?(o(),d("div",Oe,[i(a,e).full_name?(o(),b(v(q),{key:0,class:"flex items-center",image:i(a,e).user_image,label:i(a,e).full_name,size:"sm"},null,8,["image","label"])):_("",!0)])):_("",!0),["modified","creation"].includes(e)?(o(),d("div",Je,[l(v(P),{text:i(a,e).label},{default:m(()=>[h("div",null,M(i(a,e).timeAgo),1)]),_:2},1032,["text"])])):i(a,e).label?(o(),d("div",Xe,M(i(a,e).label),1)):(o(),d("div",Ge,M(s.__("No Title")),1))])]),fields:m(({fieldName:e,itemName:a})=>[i(a,e).label?(o(),d("div",Qe,[e==="status"?(o(),d("div",Ze,[l(j,{class:"size-3",status:i(a,e).label},null,8,["status"])])):e==="priority"?(o(),d("div",Ne,[l(K,{priority:i(a,e).label},null,8,["priority"])])):e==="assigned_to"?(o(),d("div",et,[i(a,e).full_name?(o(),b(v(q),{key:0,class:"flex items-center",image:i(a,e).user_image,label:i(a,e).full_name,size:"sm"},null,8,["image","label"])):_("",!0)])):_("",!0),["modified","creation"].includes(e)?(o(),d("div",tt,[l(v(P),{text:i(a,e).label},{default:m(()=>[h("div",null,M(i(a,e).timeAgo),1)]),_:2},1032,["text"])])):e=="description"?(o(),d("div",ot,[i(a,e).label?(o(),b(v(Re),{key:0,content:i(a,e).label,editable:!1,"editor-class":"!prose-sm max-w-none focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):_("",!0)])):(o(),d("div",at,M(i(a,e).label),1))])):_("",!0)]),actions:m(({itemName:e})=>[h("div",st,[h("div",null,[i(e,"reference_docname").label?(o(),b(u,{key:0,class:"-ml-2",variant:"ghost",size:"sm",label:i(e,"reference_doctype").label=="CRM Deal"?s.__("Deal"):s.__("Lead"),iconRight:fe,onClick:Y(a=>se(i(e,"reference_doctype").label,i(e,"reference_docname").label),["stop"])},null,8,["label","onClick"])):_("",!0)]),l(v(te),{class:"flex items-center gap-2",options:oe(e),variant:"ghost",onClick:t[5]||(t[5]=Y(()=>{},["stop","prevent"]))},{default:m(()=>[l(u,{icon:"more-horizontal",variant:"ghost"})]),_:1},8,["options"])])]),_:1},8,["modelValue","options"])):r.value.data&&V.value.length?(o(),b(Ye,{key:1,ref_key:"tasksListView",ref:B,modelValue:r.value.data.page_length_count,"onUpdate:modelValue":t[9]||(t[9]=e=>r.value.data.page_length_count=e),list:r.value,"onUpdate:list":t[10]||(t[10]=e=>r.value=e),rows:V.value,columns:r.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:r.value.data.row_count,totalCount:r.value.data.total_count},onLoadMore:t[11]||(t[11]=()=>A.value++),onColumnWidthUpdated:t[12]||(t[12]=()=>$.value++),onUpdatePageCount:t[13]||(t[13]=e=>y.value=e),onShowTask:U,onApplyFilter:t[14]||(t[14]=e=>n.value.applyFilter(e)),onApplyLikeFilter:t[15]||(t[15]=e=>n.value.applyLikeFilter(e)),onLikeDoc:t[16]||(t[16]=e=>n.value.likeDoc(e)),onSelectionsChanged:t[17]||(t[17]=e=>n.value.updateSelections(e))},null,8,["modelValue","list","rows","columns","options"])):r.value.data?(o(),d("div",lt,[h("div",nt,[l(ye,{class:"h-10 w-10"}),h("span",null,M(s.__("No {0} Found",[s.__("Tasks")])),1),l(u,{label:s.__("Create"),iconLeft:"plus",onClick:t[18]||(t[18]=e=>p.value=!0)},null,8,["label"])])])):_("",!0),p.value?(o(),b(Ue,{key:3,modelValue:p.value,"onUpdate:modelValue":t[19]||(t[19]=e=>p.value=e),reloadTasks:r.value,"onUpdate:reloadTasks":t[20]||(t[20]=e=>r.value=e),task:D.value},null,8,["modelValue","reloadTasks","task"])):_("",!0)],64)}}};export{Et as default};
//# sourceMappingURL=Tasks-7b200e32.js.map
